{"posts":[{"title":"OpenWrtå¤šæ‹¨ä½¿ç”¨æ•™ç¨‹","text":"å¤šæ‹¨ç±»å¤šæ‹¨ç›¸å…³çš„æ’ä»¶ä¸»è¦æ˜¯ å¤šçº¿å¤šæ‹¨ å’Œ è´Ÿè½½å‡è¡¡ æ’ä»¶ã€‚ Syncdial å¤šçº¿å¤šæ‹¨ä½¿ç”¨macvlané©±åŠ¨åˆ›å»ºå¤šä¸ªè™šæ‹ŸWANå£ï¼Œæ”¯æŒå¹¶å‘å¤šæ‹¨ 1opkg install luci-app-syncdial MWAN3è´Ÿè½½å‡è¡¡æ”¯æŒå¤šæ ¹ç½‘çº¿æˆ–è€…å¤šä¸ªPPPOEè´¦å·çš„åŒæ—¶æ‹¨å·ä½¿ç”¨å’Œè´Ÿè½½å‡è¡¡ã€‚å¹¶ä¸”è¿˜å¯ä»¥é€šè¿‡Pingæ–¹å¼æ¥æ£€æµ‹ä¸­æ–­çº¿è·¯å¹¶è‡ªåŠ¨å±è”½ä¸­æ–­çº¿è·¯ 1opkg install luci-i18n-mwan3-zh-cn å…¶ä»–å¦‚å‘ç°æ— æ³•å®‰è£…æˆ–æ›´æ–°ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œ æ›´æ–°OPKGè½¯ä»¶åˆ—è¡¨1opkg update","link":"/2023/02/28/OpenWrt%E5%A4%9A%E6%8B%A8%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/"},{"title":"Obsidian å…è´¹çš„å®æ—¶åŒæ­¥æœåŠ¡","text":"ä½¿ç”¨ fly.io å…è´¹è®¡åˆ’éƒ¨ç½²æˆ–è‡ªæ‰˜ç®¡æ•°æ®åº“ï¼Œè¿›è¡Œ LiveSync æ’ä»¶çš„ä¸€ç³»åˆ—é…ç½®åå®ç°å„è®¾å¤‡é—´ Obsidian å®æ—¶å¢é‡ä¿®æ”¹åŒæ­¥ï¼Œå¯ä»¥å’Œå®˜æ–¹åŒæ­¥æœåŠ¡ç›¸åª²ç¾ã€‚ ä½¿ç”¨ fly.ioè¿™æ¬¡ä½¿ç”¨çš„æ˜¯ fly.io çš„å…è´¹è®¡åˆ’ï¼Œfly.io æ˜¯ä¸€ä¸ª SAASï¼ˆæ˜¯ï¼ˆPlatform as a Serviceï¼‰çš„ç¼©å†™ï¼Œæ˜¯æŒ‡å¹³å°å³æœåŠ¡ï¼‰å¹³å°ï¼Œå¯ä»¥æ­å»ºå¦‚é™æ€åšå®¢ã€Nextjsã€Nuxtjsã€Denoã€Goã€Python ç­‰åº•å±‚çš„å„ç§å„æ ·çš„æœåŠ¡ã€‚ä½†é¦–å…ˆéœ€è¦è‡ªå·±æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥ä½¿ç”¨ Github ç™»å½•ã€‚ æ³¨æ„ï¼šfly.io çš„ä½¿ç”¨éœ€è¦ç»‘å¡ï¼Œå¦‚æœæ²¡æœ‰ç»‘å¡ä¼šåœ¨åˆ›å»ºåº”ç”¨ç« èŠ‚å‡ºç° Error æç¤ºã€‚ç»‘å¡è¿‡ç¨‹è¯·åœ¨ fly.io é¢æ¿ä¸­ Billing è¿›è¡Œã€‚æ­£å¸¸ä½¿ç”¨å›½å†…çš„åŒå¸å¡å°±å¯ä»¥ï¼Œæ³¨æ„è¯·å¦‚å®å¡«å†™ä¿¡æ¯ã€‚æ²¡æœ‰å¡çš„æœ‹å‹å¯ä»¥å»å„é“¶è¡ŒåŠä¸€å¼ ï¼ˆè¶…å¥½è¿‡çš„ğŸ˜—ï¼‰æˆ–è¯•è¯•è™šæ‹Ÿå¡ï¼Ÿï¼ˆè™šæ‹Ÿå¡åªæ˜¯åšä¸»æƒ³åˆ°çš„ä¸€ç§æ–¹æ¡ˆï¼Œæ²¡æœ‰è¯•è¿‡ï¼‰ å®‰è£… flyctlWindows ç”¨æˆ·åœ¨æœ¬åœ°æ‰“å¼€ PowerShell æˆ– Windows ç»ˆç«¯ğŸ’»ï¼Œè¾“å…¥ï¼š 1iwr https://fly.io/install.ps1 -useb | iex æ³¨æ„ï¼šCMD ä¸­ä¸æ”¯æŒä¸Šé¢çš„å‘½ä»¤ï¼Œå¦‚æœç”µè„‘ä¸­åªæœ‰ CMDï¼Œæˆ–è®¸ä½ éœ€è¦å®‰è£… PowerShellï¼ˆé€‰æ‹© latest ç‰ˆæœ¬ï¼‰æˆ– Windows ç»ˆç«¯ã€‚ æœ¬åœ°ç™»å½•1flyctl auth signup ä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨è¿›è¡ŒéªŒè¯è´¦æˆ·æ“ä½œã€‚ åˆ›å»ºåº”ç”¨åœ¨æœ¬åœ°ä»»æ„ä½ç½®åˆ›å»ºä¸€ä¸ª fly.io çš„å·¥ä½œç›®å½•ï¼ˆå…¶å®å°±æ˜¯åˆ›å»ºä¸ªèƒ½æ‰¾åˆ°çš„æ–‡ä»¶å¤¹ï¼Œä½ ä¸ä¼šæ”¾æ¡Œé¢ä¸Šäº†å§ğŸ˜‚ï¼Ÿï¼‰ã€‚ 1234mkdir fly.iocd fly.iomkdir couchdbcd couchdb è¿›å…¥ couchdb ç›®å½•åè¾“å…¥å‘½ä»¤ï¼š 1flyctl launch --image couchdb è¿™ä¸€æ­¥å°†ä¼šå¯åŠ¨ä¸€ä¸ªå‘å¯¼ï¼ŒæŒ‰è‡ªå·±çš„éœ€æ±‚è¿›è¡Œé€‰æ‹©ã€‚Select region çš„æ„æ€æ˜¯é€‰æ‹©ä¸€ä¸ªä½ç½®ï¼Œå°½é‡é€‰æ‹©é è¿‘è‡ªå·±çš„ä½ç½®ã€‚ é…ç½®å·å¤§å° æˆ‘è¾“å…¥çš„é…ç½®å·å¤§å°å‘½ä»¤ä¸ºï¼š 1flyctl volumes create --region nrt couchdata --size 1 nrt çš„æ„æ€æ˜¯ä¸œäº¬åœ°åŒºï¼Œä½ éœ€è¦æ”¹å˜ä¸ºå’Œä¸Šé¢é€‰æ‹©çš„ä½ç½®åŒºåŸŸä¸€æ ·çš„ä½ç½®ä»£ç ã€‚è¿™ä¸€è¡Œå‘½ä»¤çš„æ„æ€æ˜¯ï¼šåœ¨ä¸œäº¬åœ°åŒºåˆ›å»ºä¸€ä¸ª 1G å¤§å°çš„å·ã€‚ è°ƒæ•´é…ç½®ä¿¡æ¯æ‰“å¼€åº”ç”¨æ ¹ç›®å½•çš„ fly.toml æ–‡ä»¶ï¼Œæ·»åŠ æˆ–ä¿®æ”¹å¦‚ä¸‹ä¿¡æ¯ï¼š æ ¹ç›®å½•ä¸ºåœ¨åˆ›å»ºåº”ç”¨ç« èŠ‚ä¸­åˆ›å»ºçš„æ–°æ–‡ä»¶å¤¹ couchdb åšä¸»æ˜¯å…¨éƒ¨é…ç½®å®Œæ¯•åå†™è¿™ç¯‡æ–‡ç« çš„ğŸ˜ï¼Œæ‰€æœ‰å¯èƒ½æœ‰é—æ¼æˆ–ä¸€äº›é”™è¯¯ï¼Ÿä¸ºäº†ä¿è¯ä¸¥è°¨æ€§ï¼ŒæŠŠè‡ªå·±çš„é…ç½®å…¨éƒ¨è´´ä¸€ä»½åšå¯¹ç…§å§ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051# fly.toml file generated for couch-db on 2022-09-30T16:06:18+08:00app = &quot;couch-db&quot;kill_signal = &quot;SIGINT&quot;kill_timeout = 5processes = [][build] image = &quot;couchdb:latest&quot;[env] COUCHDB_USER = &quot;yantao&quot;[mounts] source=&quot;couchdata&quot; destination=&quot;/opt/couchdb/data&quot;[experimental] allowed_public_ports = [] auto_rollback = true[[services]] http_checks = [] internal_port = 5984 processes = [&quot;app&quot;] protocol = &quot;tcp&quot; script_checks = [] [services.concurrency] hard_limit = 25 soft_limit = 20 type = &quot;connections&quot; [[services.ports]] force_https = true handlers = [&quot;http&quot;] port = 80 [[services.ports]] handlers = [&quot;tls&quot;, &quot;http&quot;] port = 443 [[services.ports]] handlers = [&quot;tls&quot;, &quot;http&quot;] port = 5984 [[services.tcp_checks]] grace_period = &quot;1s&quot; interval = &quot;15s&quot; restart_limit = 0 timeout = &quot;2s&quot; è¯·å¯¹æ¯”ä¸Šé¢æä¾›çš„é…ç½®æ–‡ä»¶ä¿®æ”¹è‡ªå·±çš„ fly.toml æ–‡ä»¶ã€‚ è®¾ç½®å¯†ç åœ¨ç»ˆç«¯ä¸­è¾“å…¥å‘½ä»¤ï¼š 1flyctl secrets set COUCHDB_PASSWORD=ä½ çš„å¯†ç  æ³¨æ„ï¼šå¯†ç ä½¿ç”¨å¤§å°å†™å­—æ¯ä¸æ•°å­—ï¼Œä¸è¦ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ã€‚å®é™…æµ‹è¯•åå‘ç°ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦æ—¶æ— æ³•è¯†åˆ«å¯†ç ï¼Œä¼šæ— æ³•ç™»å½•æ•°æ®åº“ã€‚ å¦‚æœæƒ³è¦ä¿®æ”¹å¯†ç ï¼Œå¯ä»¥å†æ¬¡è¿è¡Œä¸Šé¢çš„å‘½ä»¤ã€‚ éƒ¨ç½² æ³¨æ„ï¼Œå¦‚æœæç¤º Services defined at indexes: 0 require a dedicated IP address. You currently have no dedicated IPs allocated. Please allocate at least one dedicated IP before deployingï¼Œé‚£ä¹ˆéœ€è¦è¿è¡Œ fly ips allocate-v4ã€‚ åœ¨ç»ˆç«¯ä¸­è¾“å…¥å‘½ä»¤ï¼š 1flyctl deploy ç¨ä½œç­‰å¾…åæç¤ºéƒ¨ç½²æˆåŠŸğŸ‰ã€‚ä½¿ç”¨ä¸‹é¢å‘½ä»¤å¯ä»¥æ‰“å¼€ç½‘é¡µç™»å½•ï¼š 1flyctl open å¦‚æœæ˜¯ fly.io éƒ¨ç½²ï¼Œé‚£ä¹ˆåœ¨ç½‘å€ååŠ  `/_utils/#/setup`ï¼Œè·³è½¬åå¯ä»¥è¾“å…¥ç”¨æˆ·åä¸å¯†ç ã€‚ ç½‘é¡µæˆåŠŸç™»å½•ï¼Œå¥½è€¶ğŸ‰ ç½‘é¡µæ•°æ®åº“é…ç½®è¿™ä¸€å¤§ç« èŠ‚éƒ½åœ¨ç½‘é¡µä¸­è¿›è¡Œã€‚å¦‚æœä¸çŸ¥é“è‡ªå·±çš„åœ°å€ï¼Œå¯ä»¥æ‰“å¼€ fly.io é¢æ¿ï¼Œç‚¹å‡»è‡ªå·±çš„åº”ç”¨ï¼ŒHostname å¤„ä¸ºè‡ªå·±åº”ç”¨çš„ç½‘å€ã€‚ åˆ›å»ºæ•°æ®åº“ ç‚¹å‡»å³ä¸Šè§’çš„ Create Databaseï¼Œåˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼ŒDatabase name ä¸ºæ•°æ®åº“åå­—ï¼ŒPartitioned è¯·ä¸è¦å‹¾é€‰ï¼Œç„¶åç‚¹ Create åˆ›å»ºã€‚ é…ç½®å…¶ä»–ä¿¡æ¯æ‰“å¼€ Setup é€‰é¡¹å¡ï¼Œå¡«å†™ç›¸å…³ä¿¡æ¯ã€‚ ç¬¬ä¸€è¡Œçš„ Specify your Admin credentials ä¸ºä½ åœ¨ä¸Šé¢æ­¥éª¤ä¸­é…ç½®çš„ç”¨æˆ·ä¿¡æ¯ã€‚ç¬¬äºŒè¡Œçš„ Bind address the node will listen on æ„æ€æ˜¯ç›‘å¬çš„è®¿é—®åœ°å€ï¼Œè®¾ç½®ä¸º 0.0.0.0 ä¸ºå…è®¸æ‰€æœ‰ ip è®¿é—®ã€‚ç¬¬ä¸‰è¡Œçš„ Port that the node will use ä¸ºä½ åœ¨ è°ƒæ•´é…ç½®ä¿¡æ¯ è¿™ä¸€æ­¥ä¸­çš„ fly.toml æ–‡ä»¶ä¸­é…ç½®çš„ç«¯å£ï¼Œå¦‚æœå’Œæˆ‘è®¾ç½®çš„ä¸€æ ·ï¼Œé‚£è¿™é‡Œåº”è¯¥æ˜¯ 5984ğŸ˜šã€‚è®¾ç½®å®Œæˆåä¼šæ˜¾ç¤º Apache CouchDB is configured for production usage as a clustered node! Do you want to replicate data?ï¼Œä»£è¡¨é…ç½®æˆåŠŸã€‚ å¯ç”¨ CORS ç„¶åæ‰“å¼€ Configuration é€‰é¡¹å¡ä¸­çš„ CORS æ ‡ç­¾ï¼Œå¯ç”¨ CORSã€‚å®Œæˆç½‘é¡µç«¯æ“ä½œï¼ ä¸‹æ–¹çš„ Origin Domains éœ€è¦è®¾ç½®ä¸º All domainsã€‚ Obsidian è®¾ç½®è¿™ä¸€ç« èŠ‚çš„æ“ä½œéƒ½åœ¨ Obsidian æœ¬ä½“è½¯ä»¶ä¸­è¿›è¡Œã€‚é¦–å…ˆéœ€è¦å…³é—­ Obsidian ä¸­çš„å®‰å…¨æ¨¡å¼ï¼Œåœ¨æ’ä»¶å¸‚åœºä¸­æœç´¢ Self-hosted LiveSync ä¸‹è½½å¹¶å¯ç”¨ã€‚åœ¨ Github ä»“åº“ä¸­æ‰‹åŠ¨ä¸‹è½½å®‰è£…æœ¬æ’ä»¶å¯èƒ½ä¼šå‡ºç°ä¸€äº›é—®é¢˜ã€‚ åœ¨ç§»åŠ¨ç«¯å¯èƒ½ä¼šæ‰“ä¸å¼€æ’ä»¶å¸‚åœºï¼Œæ˜¯ä¼—æ‰€å‘¨çŸ¥çš„ç½‘ç»œåŸå› ï¼Œéœ€è¦è‡ªå·±è§£å†³ğŸ˜‘ã€‚ é…ç½®è¿æ¥ä¿¡æ¯æ‰“å¼€ Remote Database configuration é€‰é¡¹å¡ã€‚è¾“å…¥è‡ªå·±çš„æ•°æ®åº“ç½‘å€ã€ç”¨æˆ·åã€å¯†ç ä¸æ•°æ®åº“åã€‚ æ•°æ®åº“ç½‘å€ URI ä¸º https://ä½ çš„åº”ç”¨.fly.dev çš„å½¢å¼ï¼Œå¦‚æœæ‰¾ä¸åˆ°å¯ä»¥ä½¿ç”¨ flyctl open æˆ–åœ¨ fly.io é¢æ¿ä¸­æ‰“å¼€è‡ªå·±çš„åº”ç”¨æŸ¥çœ‹ Hostname é¡¹ã€‚ ç”¨æˆ·åä¸å¯†ç ä¸ºåœ¨è°ƒæ•´é…ç½®ä¿¡æ¯æ—¶å¡«å†™çš„ç”¨æˆ·åä¸åœ¨è®¾ç½®å¯†ç ä¸­ç”¨å‘½ä»¤è®¾ç½®çš„å¯†ç ã€‚ æ•°æ®åº“åä¸ºåœ¨åˆ›å»ºæ•°æ®åº“æ—¶åˆ›å»ºçš„æ•°æ®åº“åã€‚ ### ä¿®å¤è¿æ¥ ç‚¹å‡» Test Database Connectionï¼Œåœ¨å³ä¸Šè§’å‡ºç° Connect to æ•°æ®åº“åï¼Œåˆ™ä¸ºè¿æ¥æˆåŠŸã€‚ç„¶åç‚¹å‡» Check database configurationï¼Œä¼šå‡ºç°ä¸€å †æ—¥å¿—ï¼Œé€ä¸ªç‚¹å‡»åé¢çš„ fix æŒ‰é’®ä¿®å¤å³å¯ã€‚ ä¿®å¤å®Œæˆåé‡æ–°ç‚¹å‡» Check database configurationï¼Œæ²¡æœ‰å‡ºç° fix æŒ‰é’®å³ä¸ºä¿®å¤æˆåŠŸã€‚ åŒæ­¥è®¾ç½®æ‰“å¼€ Sync Settings é€‰é¡¹å¡ï¼Œå…¶ä¸­æœ‰æ‰€æœ‰çš„åŒæ­¥æ–¹å¼è®¾ç½®ã€‚æ³¨æ„ï¼šå®æ—¶åŒæ­¥ (LiveSync) ä¸å®šæ—¶åŒæ­¥ (Periodic Sync) äº’æ–¥ï¼Œæ— æ³•åŒæ—¶æ‰“å¼€ã€‚ å¯èƒ½æœ‰æœ‹å‹ä¼šçº ç»“ç”¨å“ªä¸ªï¼Œåœ¨è¿™é‡Œå¼ºçƒˆæ¨èä½¿ç”¨ LiveSyncï¼ˆå®æ—¶åŒæ­¥ï¼‰æ–¹å¼ï¼Œæ¯•ç«Ÿç”¨æ­¤æ’ä»¶å°±æ˜¯ä¸ºäº†è¿™ä¸ªã€‚å› ä¸º Periodic Syncï¼ˆå®šæ—¶åŒæ­¥ï¼‰ä¸­åŒ…å«æœ‰ Sync on Save (ä¿å­˜æ—¶åŒæ­¥)ã€Sync on File Open (æ–‡ä»¶æ‰“å¼€æ—¶åŒæ­¥)ã€Sync on Start (æ‰“å¼€è½¯ä»¶æ—¶åŒæ­¥) å„ç§é€‰é¡¹ï¼Œåˆè®¡ä¸€ä¸‹å®Œå…¨å°±æ˜¯å˜ç›¸çš„å®æ—¶åŒæ­¥å˜›ï¼ç¬¬äºŒç‚¹æ˜¯å½“æˆ‘ä½¿ç”¨ hugo server å¼€å¯æœ¬åœ°åšå®¢å˜æ›´ç›‘å¬åå‘ç°ï¼ŒObsidian ä¼šè‡ªåŠ¨åœ¨è¾“å…¥æ–‡å­—åä¿å­˜ä¸€æ¬¡ï¼Œé€ æˆé¢‘ç¹çš„ Sync on Save (ä¿å­˜æ—¶åŒæ­¥) æ“ä½œã€‚æ‰€ä»¥ï¼Œè¿˜æ˜¯ä½¿ç”¨ LiveSyncï¼ˆå®æ—¶åŒæ­¥ï¼‰å§ğŸ‘ã€‚ å…¶ä»–è®¾ç½®åœ¨ Sync Settings é€‰é¡¹å¡ä¸­è¿˜åŒ…å«æœ‰ Use Trash for deleted filesï¼ˆåˆ é™¤æ–‡ä»¶åˆ°å›æ”¶ç«™ï¼‰é…ç½®å¼ºçƒˆå»ºè®®æ‰“å¼€ï¼Œé˜²æ­¢æ–‡ä»¶æ„å¤–ä¸¢å¤±ã€‚ åœ¨ Miscellaneous é€‰é¡¹å¡ï¼ˆä¸€ä¸ªå°æ‰³æ‰‹å›¾æ ‡ï¼‰ä¸­ï¼Œæœ‰é€‰é¡¹ Show staus inside editorï¼ˆåœ¨ç¼–è¾‘å™¨å³ä¸Šè§’æ˜¾ç¤ºå½“å‰åŒæ­¥çŠ¶æ€ï¼‰ï¼Œæ¨èæ‰“å¼€ã€‚ åŒæ­¥çŠ¶æ€å°†æ˜¾ç¤ºåœ¨çŠ¶æ€æ ï¼ŒçŠ¶æ€éƒ½æœ‰ï¼š â¹ï¸ å‡†å¤‡å°±ç»ª ğŸ’¤ LiveSync å·²å¯ç”¨ï¼Œæ­£åœ¨ç­‰å¾…æ›´æ”¹ âš¡ï¸ åŒæ­¥ä¸­ âš ï¸ å‡ºç°é”™è¯¯ ä¿¡æ¯è§£é‡Šï¼š â†‘ ä¸Šä¼ çš„ chunk å’Œå…ƒæ•°æ®æ•°é‡ â†“ ä¸‹è½½çš„ chunk å’Œå…ƒæ•°æ®æ•°é‡ â³ ç­‰å¾…çš„è¿‡ç¨‹çš„æ•°é‡ ğŸ§© æ­£åœ¨ç­‰å¾… chunk çš„æ–‡ä»¶æ•°é‡ å¦‚æœä½ åˆ é™¤æˆ–ä¿®æ”¹äº†æ–‡ä»¶åç§°ï¼Œè¯·ç­‰å¾… â³ å›¾æ ‡æ¶ˆå¤±ã€‚ å®‰è£…äºå…¶ä»–è®¾å¤‡åœ¨æ’ä»¶ Setup wizard é€‰é¡¹å¡ä¸­ï¼Œç‚¹å‡» Copy Setup URIï¼Œå¼¹å‡ºçš„å¯¹è¯æ¡†è¾“å…¥ä½ çš„æ•°æ®åº“å¯†ç ï¼Œå³å¯å¤åˆ¶å½“å‰çš„é…ç½®ä¿¡æ¯ã€‚åœ¨å…¶ä»–å¦‚ Androidã€iOS è®¾å¤‡ä¸Šå®‰è£…æ­¤æ’ä»¶å¹¶ç‚¹å‡» Open Setup URI è¾“å…¥å¤åˆ¶çš„é“¾æ¥å³å¯ã€‚ åœ¨è¿™é‡Œé€‰ç¬¬ä¸€ä¸ªï¼Œæ„æ€ä¸ºå°†æ­¤è®¾å¤‡è®¾ç½®ä¸ºè¾…åŠ©æˆ–åç»­è®¾å¤‡ã€‚ç¨ç­‰ä¸€ä¼šå„¿åå³å¯åŒæ­¥å®Œæˆã€‚è€Œä¸”åŒæ­¥éå¸¸å¿«ï¼Œåªéœ€è¦å‡ ç§’é’Ÿå°±å¥½ã€‚ è¿™é‡Œæ”¾ä¸€å¼ å®˜ç½‘çš„åŒæ­¥åŠ¨æ€å›¾å¯ä»¥æ„Ÿå—ä¸€ä¸‹ã€‚ æ¨èæ–¹æ¡ˆå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸åº”è¯¥åœ¨ Obsidian ä¸­å­˜æ”¾å¤ªå¤šåª’ä½“æ–‡ä»¶ï¼Œå¦‚ï¼šMarkdown æ–‡ä»¶ç›´æ¥å¼•ç”¨æœ¬åœ°å›¾ç‰‡æˆ–éŸ³é¢‘ã€‚ä¸ç„¶ä¼šæ˜¾è‘—æ‹–æ…¢ä»»ä½• WebDAV æˆ– LiveSync çš„åŒæ­¥é€Ÿåº¦ã€‚åšä¸€ä¸ªå¯¹æ¯”ï¼Œæˆ‘çš„ Obsidian ä¸­å¤§æ¦‚æœ‰ 80 ç¯‡å·¦å³ç¬”è®°ä¸åšæ–‡ï¼Œæœ¬åœ°æºæ–‡ä»¶åªæœ‰ 600KBï¼Œæ•°æ®åº“å ç”¨åªæœ‰ 2MB å·¦å³ã€‚å¦‚æœä½¿ç”¨æœ¬åœ°å¼•ç”¨å›¾ç‰‡ï¼Œé‚£ä¹ˆä¸€å¼ å›¾ç‰‡å°±èƒ½æŠµå¾—ä¸Šæˆ‘å…¨éƒ¨ç¬”è®°çš„å¤§å°ï¼ŒåŒæ­¥æ—¶é—´å°†æˆå€çš„å¢é•¿ğŸ™„ã€‚æ‰€ä»¥ï¼Œè¿™äº›åª’ä½“æ–‡ä»¶æ›´åº”è¯¥æ”¾å…¥å›¾åºŠæˆ–å¯¹è±¡å­˜å‚¨ä¸­ï¼Œä½¿ç”¨ ![]() çš„å½¢å¼å¼•ç”¨ã€‚ åè®°fly.io éƒ¨ç½²çš„æœåŠ¡ä½“éªŒå¤ªå¥½äº†ğŸ’–ã€‚Obsidian å„ç«¯åŒæ­¥èµ·æ¥éå¸¸å¿«ï¼Œè™½ç„¶çœ‹é¢æ¿åªæ˜¯ä¸€ä¸ª 256MB çš„å°æœºå™¨ï¼Œä½†æ˜¯è¿™ä¸ªä»»åŠ¡å®Œå…¨å¯ä»¥èƒœä»»ã€‚fly.io æ¯ä¸ªè´¦æˆ·çš„å…è´¹èµ„æºåŒ…æ‹¬ï¼šæ€»å…± 3GB çš„å·ã€æœ€å¤š 3 ä¸ªå…±äº« CPU-1x 256MB è™šæ‹Ÿæœºã€æ¯æœˆ 160GB å‡ºç«™æ•°æ®ä¼ è¾“ã€‚çœ‹èµ·æ¥è¿˜èƒ½åšä¸€äº›æ–°ç©æ³•çš„æ ·å­ã€‚åœ¨å¯¹æ¯”ä½¿ç”¨ Remotely save åŒæ­¥åå‘ç°ï¼ŒåŒæ­¥é€Ÿåº¦é™¤äº†å¿«å°±æ˜¯å¿«ï¼Œåˆšåœ¨ç”µè„‘ä¸Šå†™å®Œä¸€å¥è¯ï¼Œæƒ³èµ·æœ‰äº‹æƒ…å‡†å¤‡èµ°ï¼Œæ‹¿èµ·æ‰‹æœºæ‰“å¼€ Obsidianï¼Œå®Œå…¨å¯ä»¥æ¥ç€ç»§ç»­ç¼–è¾‘ï¼Œæ— ç¼åŒæ­¥çš„ä½“éªŒçœŸæ˜¯å¤ªæ£’äº†ï¼æˆ‘å®£å¸ƒè¿™æ˜¯ Obsidian éå®˜æ–¹åŒæ­¥æœåŠ¡çš„æœ€ä½³æ–¹å¼ã€‚","link":"/2023/03/06/Obsidian%20%E5%85%8D%E8%B4%B9%E7%9A%84%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5%E6%9C%8D%E5%8A%A1/"},{"title":"Python ChatGPT Telegram Bot","text":"æ³¨å†Œè¿™é‡Œå¦‚ä½•æ³¨å†Œæˆ‘å°±ä¸è¯´æ˜äº†ï¼Œå¤§å®¶è‡ªè¡Œå»æ³¨å†Œï¼Œä¸»è¦æ˜¯ç°åœ¨GPTçš„åŸºæœ¬ä¸Šå·²ç»å¤‡ç”¨å¾ˆå¤šäº†ï¼Œå¯¼è‡´äº†æ¥ç çš„ä»·æ ¼ä¹Ÿä¸Šæ¶¨äº†ï¼Œè€Œä¸”ä½¿ç”¨tokençš„è¯ï¼Œå…¶å®è¿˜æ˜¯å¾ˆå¿«å¯ä»¥ç”¨å®Œå…è´¹çš„18ç¾é‡‘ï¼›æ¥ç ï¼šhttps://sms-activate.org/ å‡†å¤‡ææ–™ä¸»è¦æä¾›ä¸‹Pythonçš„å®ç°ä»£ç ï¼Œé¦–å…ˆéœ€è¦å‡†å¤‡ä¸€ä¸‹çš„ä¸œè¥¿ï¼š Telegram Bot çš„ Key ï¼šæ‰¾æœºå™¨äººçˆ¸çˆ¸è·å– ChatGPT çš„ API Key ï¼š https://platform.openai.com/account/api-keys è„šæœ¬ï¼šmain.py >folded123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145# 1. Start by importing the necessary libraries and setting up the API clients import requests import json import os import threading # OpenAI secret Key API_KEY = 'xxxxxxxxx' # Models: text-davinci-003,text-curie-001,text-babbage-001,text-ada-001 MODEL = 'text-davinci-003' # Telegram secret access bot token BOT_TOKEN = 'xxxxxxxxxxxxx' # Defining the bot's personality using adjectives BOT_PERSONALITY = '' # 2a. Function that gets the response from OpenAI's chatbot def openAI(prompt): # Make the request to the OpenAI API response = requests.post( 'https://api.openai.com/v1/completions', headers={'Authorization': f'Bearer {API_KEY}'}, json={'model': MODEL, 'prompt': prompt, 'temperature': 0.4, 'max_tokens': 4000} ) result = response.json() print(result) final_result = ''.join(choice['text'] for choice in result['choices']) return final_result # 2b. Function that gets an Image from OpenAI def openAImage(prompt): # Make the request to the OpenAI API resp = requests.post( 'https://api.openai.com/v1/images/generations', headers={'Authorization': f'Bearer {API_KEY}'}, json={'prompt': prompt, 'n': 1, 'size': '1024x1024'} ) response_text = json.loads(resp.text) return response_text['data'][0]['url'] # 3a. Function that sends a message to a specific telegram group def telegram_bot_sendtext(bot_message, chat_id, msg_id): data = { 'chat_id': chat_id, 'text': bot_message, 'reply_to_message_id': msg_id } response = requests.post( 'https://api.telegram.org/bot' + BOT_TOKEN + '/sendMessage', json=data ) return response.json() # 3b. Function that sends an image to a specific telegram group def telegram_bot_sendimage(image_url, group_id, msg_id): data = { 'chat_id': group_id, 'photo': image_url, 'reply_to_message_id': msg_id } url = 'https://api.telegram.org/bot' + BOT_TOKEN + '/sendPhoto' response = requests.post(url, data=data) return response.json() # 4. Function that retrieves the latest requests from users in a Telegram group, # generates a response using OpenAI, and sends the response back to the group. def Chatbot(): # Retrieve last ID message from text file for ChatGPT update cwd = os.getcwd() filename = cwd + '/chatgpt.txt' if not os.path.exists(filename): with open(filename, &quot;w&quot;) as f: f.write(&quot;1&quot;) else: print(&quot;File Exists&quot;) with open(filename) as f: last_update = f.read() # Check for new messages in Telegram group url = f'https://api.telegram.org/bot{BOT_TOKEN}/getUpdates?offset={last_update}' response = requests.get(url) data = json.loads(response.content) for result in data['result']: try: # Checking for new message if float(result['update_id']) &gt; float(last_update): # Checking for new messages that did not come from chatGPT if not result['message']['from']['is_bot']: last_update = str(int(result['update_id'])) # Retrieving message ID of the sender of the request msg_id = str(int(result['message']['message_id'])) # Retrieving the chat ID chat_id = str(result['message']['chat']['id']) # Checking if user wants an image if '/img' in result['message']['text']: prompt = result['message']['text'].replace(&quot;/img&quot;, &quot;&quot;) bot_response = openAImage(prompt) print(telegram_bot_sendimage(bot_response, chat_id, msg_id)) # Checking that user mentionned chatbot's username in message if '@chatGpt_dandelion_bot' in result['message']['text'] \\ or '/ask' in result['message']['text']: prompt = result['message']['text'].replace(&quot;@chatGpt_dandelion_bot&quot;, &quot;&quot;) # Calling OpenAI API using the bot's personality bot_response = openAI(f&quot;{BOT_PERSONALITY}{prompt}&quot;) # Sending back response to telegram group print(telegram_bot_sendtext(bot_response, chat_id, msg_id)) # Verifying that the user is responding to the ChatGPT bot if 'reply_to_message' in result['message']: if result['message']['reply_to_message']['from']['is_bot']: prompt = result['message']['text'] bot_response = openAI(f&quot;{BOT_PERSONALITY}{prompt}&quot;) print(telegram_bot_sendtext(bot_response, chat_id, msg_id)) except Exception as e: print(e) # Updating file with last update ID with open(filename, 'w') as f: f.write(last_update) return &quot;done&quot; # 5 Running a check every 5 seconds to check for new messages def main(): timertime = 5 Chatbot() # 5 sec timer threading.Timer(timertime, main).start() # Run the main function if __name__ == &quot;__main__&quot;: main()","link":"/2023/02/21/Python%20ChatGPT%20Telegram%20Bot/"},{"title":"é€šè¿‡ Haproxy å®ç° Shadowshadows è´Ÿè½½å‡è¡¡","text":"ä»‹ç»ç¼ºç‚¹ï¼šæ‰€æœ‰çš„SSçš„åŠ å¯†æ–¹å¼å’Œå¯†ç å¿…é¡»ä¸€è‡´ä»‹ç»ï¼šHAProxyæ˜¯ä¸€ä¸ªä½¿ç”¨Cè¯­è¨€ç¼–å†™çš„è‡ªç”±åŠå¼€æ”¾åŸå§‹ç è½¯ä»¶ï¼Œå…¶æä¾›é«˜å¯ç”¨æ€§ã€è´Ÿè½½å‡è¡¡ï¼Œä»¥åŠåŸºäºTCPå’ŒHTTPçš„åº”ç”¨ç¨‹åºä»£ç†ã€‚ å®‰è£…Haproxy1yum install haproxy é…ç½®12345678910111213141516171819202122232425262728293031323334353637global chroot /var/lib/haproxy pidfile /var/run/haproxy.pid user haproxy group haproxydefaults mode tcp #æœåŠ¡å™¨é»˜è®¤çš„å·¥ä½œæ¨¡å¼ balance roundrobin #æœåŠ¡å™¨é»˜è®¤ä½¿ç”¨çš„å‡è¡¡æ¨¡å¼ retries 3 #ä¸‰æ¬¡è¿æ¥å¤±è´¥è¡¨ç¤ºæœåŠ¡å™¨ä¸å¯ç”¨ maxconn 5000 #æœ€å¤§è¿æ¥æ•° timeout connect 500ms #è¿æ¥è¶…æ—¶ timeout client 3s #å®¢æˆ·ç«¯è¶…æ—¶ timeout server 3s #æœåŠ¡å™¨è¶…æ—¶listen WebPanel mode http #è¿™é‡Œä½¿ç”¨HTTPæ¨¡å¼ bind 10.1.1.58:9595 #WEBæœåŠ¡ç«¯å£ stats refresh 5s #è‡ªåŠ¨åˆ·æ–°æ—¶é—´ stats uri / #WEBç®¡ç†åœ°å€ stats auth admin:xxxx #è´¦å·å¯†ç  stats hide-version #éšè—ç‰ˆæœ¬ stats admin if TRUE #éªŒè¯é€šè¿‡åˆ™èµ‹äºˆç®¡ç†æƒfrontend shadowsocks-in bind *:50001 default_backend serversbackend servers mode tcp balance roundrobin # option external-check option tcp-check # external-check command &quot;/etc/haproxy/haproxy-shadowsocks-checker.py&quot; server ss1 43.156.100.84:2195 check inter 500 rise 2 fall 4 weight 100 #SS/SSRæœåŠ¡å™¨åœ°å€ä¸ç«¯å£ server ss2 42.157.192.42:10108 check inter 500 rise 2 fall 4 weight 100 serverï¼šåé¢é¦–å…ˆè·Ÿåå­—ï¼Œåå­—éšä¾¿èµ·å‘—ï¼Œè‡ªå·±èƒ½å¤ŸåŒºåˆ†å°±è¡Œã€‚ç´§æ¥ç€è·ŸSSçš„å…¬ç½‘IP+ç«¯å£ï¼Œç«¯å£ä¹Ÿå°±æ˜¯SS/SSRçš„ç«¯å£ã€‚checkï¼šæ˜¯æ£€æµ‹çš„æ„æ€ï¼Œè¿™æ®µé…ç½®å¾ˆé‡è¦interï¼šå•ä½æ¯«ç§’ï¼Œæˆ‘é…ç½®çš„500ï¼Œå³500æ¯«ç§’æ£€æµ‹ä¸€æ¬¡ç›®æ ‡æœåŠ¡å™¨ã€‚rise2ï¼šè®¾å®šå¥åº·çŠ¶æ€æ£€æŸ¥ä¸­ï¼ŒæŸç¦»çº¿çš„æœåŠ¡å™¨ä»ç¦»çº¿çŠ¶æ€è½¬æ¢è‡³æ­£å¸¸çŠ¶æ€éœ€è¦æˆåŠŸæ£€æŸ¥çš„æ¬¡æ•°ï¼Œè¿™é‡Œæˆ‘è®¾ç½®çš„2æ¬¡ã€‚fall4ï¼šç¡®è®¤æœåŠ¡å™¨ä»æ­£å¸¸çŠ¶æ€è½¬æ¢ä¸ºä¸å¯ç”¨çŠ¶æ€éœ€è¦æ£€æŸ¥çš„æ¬¡æ•°ï¼Œè¿™é‡Œæ˜¯4æ¬¡ã€‚weightï¼šæƒé‡ï¼Œå€¼è¶Šå¤§ä»£è¡¨è¿™å°æœºå™¨å·¥ä½œçš„æœºä¼šè¶Šå¤šï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€å°çº¿è·¯è¾ƒå¥½çš„æœºå™¨çš„æƒé‡è®¾ç½®é«˜ä¸€äº›ã€‚balanceï¼šè´Ÿè½½å‡è¡¡æ–¹å¼ roundrobinï¼šåŸºäºæƒé‡è¿›è¡Œè½®å«ï¼Œåœ¨æœåŠ¡å™¨çš„å¤„ç†æ—¶é—´ä¿æŒå‡åŒ€åˆ†å¸ƒæ—¶ï¼Œè¿™æ˜¯æœ€å¹³è¡¡ã€æœ€å…¬å¹³çš„ç®—æ³•ã€‚æ­¤ç®—æ³•æ˜¯åŠ¨æ€çš„ï¼Œè¿™è¡¨ç¤ºå…¶æƒé‡å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œè°ƒæ•´ï¼Œä¸è¿‡ï¼Œåœ¨è®¾è®¡ä¸Šï¼Œæ¯ä¸ªåç«¯æœåŠ¡å™¨ä»…èƒ½æœ€å¤šæ¥å—4128ä¸ªè¿æ¥ï¼› static-rrï¼šåŸºäºæƒé‡è¿›è¡Œè½®å«ï¼Œä¸roundrobinç±»ä¼¼ï¼Œä½†æ˜¯ä¸ºé™æ€æ–¹æ³•ï¼Œåœ¨è¿è¡Œæ—¶è°ƒæ•´å…¶æœåŠ¡å™¨æƒé‡ä¸ä¼šç”Ÿæ•ˆï¼›ä¸è¿‡ï¼Œå…¶åœ¨åç«¯æœåŠ¡å™¨è¿æ¥æ•°ä¸Šæ²¡æœ‰é™åˆ¶ï¼› leastconnï¼šæ–°çš„è¿æ¥è¯·æ±‚è¢«æ´¾å‘è‡³å…·æœ‰æœ€å°‘è¿æ¥æ•°ç›®çš„åç«¯æœåŠ¡å™¨ï¼›åœ¨æœ‰ç€è¾ƒé•¿æ—¶é—´ä¼šè¯çš„åœºæ™¯ä¸­æ¨èä½¿ç”¨æ­¤ç®—æ³•ï¼Œå¦‚LDAPã€SQLç­‰ï¼Œå…¶å¹¶ä¸å¤ªé€‚ç”¨äºè¾ƒçŸ­ä¼šè¯çš„åº”ç”¨å±‚åè®®ï¼Œå¦‚HTTPï¼›æ­¤ç®—æ³•æ˜¯åŠ¨æ€çš„ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶è°ƒæ•´å…¶æƒé‡ï¼› sourceï¼šå°†è¯·æ±‚çš„æºåœ°å€è¿›è¡Œhashè¿ç®—ï¼Œå¹¶ç”±åç«¯æœåŠ¡å™¨çš„æƒé‡æ€»æ•°ç›¸é™¤åæ´¾å‘è‡³æŸåŒ¹é…çš„æœåŠ¡å™¨ï¼›è¿™å¯ä»¥ä½¿å¾—åŒä¸€ä¸ªå®¢æˆ·ç«¯IPçš„è¯·æ±‚å§‹ç»ˆè¢«æ´¾å‘è‡³æŸç‰¹å®šçš„æœåŠ¡å™¨ï¼›ä¸è¿‡ï¼Œå½“æœåŠ¡å™¨æƒé‡æ€»æ•°å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¦‚æŸæœåŠ¡å™¨å®•æœºæˆ–æ·»åŠ äº†æ–°çš„æœåŠ¡å™¨ï¼Œè®¸å¤šå®¢æˆ·ç«¯çš„è¯·æ±‚å¯èƒ½ä¼šè¢«æ´¾å‘è‡³ä¸æ­¤å‰è¯·æ±‚ä¸åŒçš„æœåŠ¡å™¨ï¼›å¸¸ç”¨äº è´Ÿè½½å‡è¡¡æ— cookieåŠŸèƒ½çš„åŸºäºTCPçš„åè®®ï¼›å…¶é»˜è®¤ä¸ºé™æ€ï¼Œä¸è¿‡ä¹Ÿå¯ä»¥ä½¿ç”¨hash-typeä¿®æ”¹æ­¤ç‰¹æ€§ï¼› ä¿®æ”¹Shadowsocksé…ç½®123456789{ &quot;server&quot;:&quot;127.0.0.1&quot;, # è¿™é‡Œæ”¹æˆHaproxyçš„åœ°å€ &quot;server_port&quot;:50001, # è¿™é‡Œæ”¹æˆHaproxyç›‘å¬çš„ç«¯å£ &quot;local_port&quot;:1080, # è¿™é‡Œæœ¬åœ°ç›‘å¬ç«¯å£ &quot;password&quot;:&quot;qunheadmin&quot;, &quot;timeout&quot;:60, &quot;method&quot;:&quot;aes-256-gcm&quot;, &quot;mode&quot;:&quot;tcp_and_udp&quot;}","link":"/2022/12/13/haproxy-load/"},{"title":"linuxé€šè¿‡SNMPæ£€æµ‹TCP&amp;UDPè¿æ¥æ•°","text":"å…ˆä¸Šå›¾&amp;ä»‹ç»è®°å½•ä¸€æ¬¡å…¨çƒåŒ–ç½‘ç»œç›‘æ§çš„çœ‹æ¿å»ºè®¾ï¼›ä¹‹å‰éƒ½æ˜¯é€šè¿‡zabbixæ¥è¿›è¡Œå»ºè®¾çœ‹æ¿ï¼Œä½†æ˜¯ç”¨äº†ä¸€æ®µæ—¶é—´åæ€»æ˜¯ç¼ºç‚¹æ„Ÿè§‰ï¼›åé¢é€šè¿‡å¤§ä½¬çš„ä»‹ç»ï¼Œè¯•ç”¨äº†Grafanaï¼Œè¿™ä¸è¯•ç”¨è¿˜å¥½ï¼Œä¸€è¯•ç”¨ï¼Œæ•ˆæœçš„å±•ç°è®©æˆ‘æ— æ³•è‡ªæ‹”ï¼Œè¿™å°±æ˜¯æˆ‘æƒ³è¦çš„ç›‘æ§çœ‹æ¿å•Šï¼èƒ½æ ¹æ®æ•°å€¼çš„ä¸åŒè¿›è¡Œé¢œè‰²çš„åŒºåˆ†ï¼Œåœ¨å¤§å±ä¸Šä¸€çœ¼å°±å¯ä»¥çœ‹å‡ºå½“å‰å“ªä¸€å—ç½‘ç»œå‡ºç°äº†é—®é¢˜ï¼ ç¾ä¸­ä¸è¶³çš„æ˜¯ï¼Œä¸Šé¢çš„ä¸¤åˆ—ä¸èƒ½è®¾ç½®æŠ¥è­¦ï¼ŒæŠ¥è­¦è²Œä¼¼å¿…é¡»æ˜¯å›¾è¡¨å½¢å¼çš„æ‰å¯ä»¥ï¼›ä¸è¿‡å¯ä»¥å»ºç«‹ä¸€ä¸ªé€šç”¨çš„æŠ¥è­¦çœ‹æ¿ï¼Œé—®é¢˜ä¸å¤§ï½ å…¶ä»–çš„ä¸€äº›ç›‘æ§é¡¹éƒ½æ˜¯æœ€ç®€å•åŸºç¡€çš„ï¼Œæˆ‘è¿™è¾¹å°±ä¸è¿‡å¤šçš„èµ˜è¿°ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œä¸Šç½‘æœç´¢ï¼Œæˆ–è€…ä¹‹å‰å¼•ç”¨ä¹‹å‰zabbixçš„æ•°æ®ï¼Œä¸»è¦è®²è§£ä¸‹TCPè¿æ¥æ•°å’ŒUDPè¿æ¥æ•°çš„è·å– åˆ«çš„ä¸è¯´ï¼Œè¿™å›¾è¿˜æ˜¯å¾ˆå¥½çœ‹çš„ï¼› ç°åœ¨è®²è®²è·å–TCP/UDPè¿æ¥æ•°çš„å‡†å¤‡ SNMP (yum install snmpd) è‡ªå®šä¹‰OID åˆ›å»ºè·å–è¿æ¥æ•°è„šæœ¬1234#!/bin/bashecho $2echo integerecho $(netstat -an|awk '/^tcp/ {++s[$NF]} END {for(a in s ) print a,s[a]}' | grep ESTABLISHED | awk '{print $2}') è¿™ä¸ªæ˜¯è·å–TCPè¿æ¥æ•°çš„è„šæœ¬ï¼Œå¦‚æœè¦è·å–UDPçš„ï¼Œè¯·æŠŠtcpæ”¹æˆudpè®¾ç½®è„šæœ¬æƒé™ 1chmod 766 zabbix.tcp.sh ä¿®æ”¹SNMPé…ç½®æ–‡ä»¶æ–‡ä»¶è·¯å¾„ï¼š/etc/snmp/snmpd.conf 1pass .1.3.6.1.4.1.2021.21 /etc/snmp/shell/zabbix.tcp.sh åœ¨æœ€åº•ä¸‹åŠ å…¥è¿™æ¡å‘½ä»¤ï¼Œåé¢çš„shellè„šæœ¬å°±æ˜¯ä¸Šä¼ åˆ›å»ºçš„è„šæœ¬è·¯å¾„ é‡å¯SNMPæœåŠ¡1service snmpd restart åè®°é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥åšæ›´å¤šçš„æ‰©å±•ï¼Œæ¯”å¦‚ è·å–è¿æ¥äººæ•° å½“å‰è®¿é—®æƒ…å†µ â€¦","link":"/2023/03/11/linux%E9%80%9A%E8%BF%87SNMP%E6%A3%80%E6%B5%8BTCP&UDP%E8%BF%9E%E6%8E%A5%E6%95%B0/"},{"title":"curl æ£€æµ‹ä»£ç†çš„å¯ç”¨æ€§ä»¥åŠå»¶è¿Ÿ","text":"èƒŒæ™¯åœ¨åŠå…¬ç½‘çš„ä»£ç†ç¿»å¢™çš„è¿‡ç¨‹ä¸­ï¼Œç»å¸¸æ²¡åŠæ³•ç¬¬ä¸€æ—¶é—´çŸ¥é“ä»£ç†å¤±æ•ˆäº†ï¼Œå› ä¸ºæˆ‘ä»¬è‡ªèº«ä¸æ˜¯é«˜ç”¨çš„ç”¨æˆ·ï¼Œæ¯æ¬¡æŒ‚äº†éƒ½éœ€è¦å‘˜å·¥æ¥åé¦ˆï¼Œä½“æ„Ÿéå¸¸çš„ä¸å¥½ï¼Œå› æ­¤æƒ³ç€å¯ä»¥é€šè¿‡zabbixå¦‚æœæŠŠå½“å‰çš„å»¶è¿Ÿã€å¯ç”¨æ€§æ£€æµ‹èµ·æ¥ é€šè¿‡Curl æ£€æµ‹Googleçš„å»¶è¿Ÿè¿™é‡Œä¸ºå•¥æ˜¯curlè€Œä¸æ˜¯pingï¼Œå› ä¸ºé»˜è®¤pingäº‹ä¸æ”¯æŒä»£ç†çš„ï¼Œç„¶è€Œcurlä¹Ÿå¯ä»¥åšåˆ°çœŸæ­£çš„æ˜¯å¦å¯ç”¨ 1curl -o /dev/null -x socks5h://127.0.0.1:12126 -s --connect-timeout 5 -w %{time_starttransfer}&quot;\\n&quot; $1 socks5hçš„åœ°å€éœ€è¦æ”¹æˆä½ çš„ä»£ç†åœ°å€ 12345678910# è·å–å½“å‰ä»£ç†çš„å¯ç”¨æ€§```bashurl=$1result=($(curl -x socks5h://localhost:12126 -I -s --connect-timeout 5 ${url} | head -1 | tr &quot;\\r&quot; &quot;\\n&quot;))if [ &quot;${result[1]}&quot; == $2 -a &quot;${result[2]}&quot; == 'OK' ]then echo 1else echo 0fi zabbixæ“ä½œè„šæœ¬12345# å»¶è¿ŸUserParameter=googleTime[*],/etc/zabbix/script/googleTime.sh $1# å¯ç”¨UserParameter=googleCheck[*],/etc/zabbix/script/googleCheck.sh $1 $2","link":"/2023/02/20/curl%20%E6%A3%80%E6%B5%8B%E4%BB%A3%E7%90%86%E7%9A%84%E5%8F%AF%E7%94%A8%E6%80%A7%E4%BB%A5%E5%8F%8A%E5%BB%B6%E8%BF%9F/"},{"title":"ss-tproxy é€æ˜ä»£ç†çš„è®¾ç½®æ–¹æ³•","text":"ä¸€ã€ä»‹ç»1ã€ä»€ä¹ˆæ˜¯é€æ˜ä»£ç†åœ¨æ­£å‘ä»£ç†ä¸­ï¼Œä¸€ä¸ªè½¯ä»¶å¦‚æœæƒ³èµ° client çš„ä»£ç†æœåŠ¡ï¼Œæˆ‘ä»¬å¿…é¡»æ˜¾å¼é…ç½®è¯¥è½¯ä»¶ï¼Œå¯¹è¯¥è½¯ä»¶æ¥è¯´ï¼Œæœ‰æ²¡æœ‰èµ°ä»£ç†æ˜¯å¾ˆæ˜ç¡®çš„ï¼Œå¤§å®¶éƒ½â€œå¿ƒçŸ¥è‚šæ˜â€ã€‚è€Œé€æ˜ä»£ç†åˆ™ä¸æ­£å‘ä»£ç†ç›¸åï¼Œå½“æˆ‘ä»¬è®¾ç½®å¥½åˆé€‚çš„é˜²ç«å¢™è§„åˆ™ï¼ˆä»…ä»¥ Linux çš„ iptables ä¸ºä¾‹ï¼‰ï¼Œæˆ‘ä»¬å°†ä¸å†éœ€è¦æ˜¾å¼é…ç½®è¿™äº›è½¯ä»¶æ¥è®©å…¶ç»è¿‡ä»£ç†æˆ–è€…ä¸ç»è¿‡ä»£ç†ï¼ˆç›´è¿ï¼‰ï¼Œå› ä¸ºè¿™äº›è½¯ä»¶å‘å‡ºçš„æµé‡ä¼šè‡ªåŠ¨è¢« iptables è§„åˆ™æ‰€å¤„ç†ï¼Œé‚£äº›æˆ‘ä»¬è®¤ä¸ºéœ€è¦ä»£ç†çš„æµé‡ï¼Œä¼šè¢«é€šè¿‡åˆé€‚çš„æ–¹æ³•å‘é€åˆ° client è¿›ç¨‹ï¼Œè€Œé‚£äº›æˆ‘ä»¬ä¸éœ€è¦ä»£ç†çš„æµé‡ï¼Œåˆ™ç›´æ¥æ”¾è¡Œï¼ˆç›´è¿ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹å¯¹äºæˆ‘ä»¬ä½¿ç”¨çš„è½¯ä»¶æ¥è¯´æ˜¯å®Œå…¨é€æ˜çš„ï¼Œè½¯ä»¶è‡ªèº«å¯¹å…¶ä¸€æ— æ‰€çŸ¥ã€‚è¿™å°±å«åš é€æ˜ä»£ç†ã€‚æ³¨æ„ï¼Œæ‰€è°“é€æ˜æ˜¯å¯¹æˆ‘ä»¬ä½¿ç”¨çš„è½¯ä»¶é€æ˜ï¼Œè€Œéå¯¹ clientã€server æˆ–ç›®æ ‡ç½‘ç«™é€æ˜ï¼Œç†è§£è¿™ä¸€ç‚¹éå¸¸é‡è¦ã€‚ 2ã€é€æ˜ä»£ç†çš„å·¥ä½œåŸç†åœ¨æ­£å‘ä»£ç†ä¸­ï¼ŒæœŸæœ›ä½¿ç”¨ä»£ç†çš„è½¯ä»¶ä¼šé€šè¿‡ httpã€socks5 åè®®ä¸ client è¿›ç¨‹è¿›è¡Œäº¤äº’ï¼Œä»¥æ­¤å®Œæˆä»£ç†æ“ä½œã€‚è€Œåœ¨é€æ˜ä»£ç†ä¸­ï¼Œæˆ‘ä»¬çš„è½¯ä»¶å‘å‡ºçš„æµé‡æ˜¯å®Œå…¨æ­£å¸¸çš„æµé‡ï¼Œå¹¶æ²¡æœ‰åƒæ­£å‘ä»£ç†é‚£æ ·ï¼Œä½¿ç”¨ httpã€socks5 ç­‰ä¸“ç”¨åè®®ï¼Œè¿™äº›æµé‡ç»è¿‡ iptables è§„åˆ™çš„å¤„ç†åï¼Œä¼šè¢«é€šè¿‡â€œåˆé€‚çš„æ–¹æ³•â€å‘é€ç»™ client è¿›ç¨‹ï¼ˆå½“ç„¶æ˜¯æŒ‡é‚£äº›æˆ‘ä»¬è®¤ä¸ºéœ€è¦èµ°ä»£ç†çš„æµé‡ï¼‰ã€‚æ³¨æ„ï¼Œæ­¤æ—¶ client è¿›ç¨‹æ¥æ”¶åˆ°ä¸å†æ˜¯ httpã€socks5 åè®®æ•°æ®ï¼Œè€Œæ˜¯ç»è¿‡ iptables å¤„ç†çš„â€œé€æ˜ä»£ç†æ•°æ®â€ï¼Œâ€œé€æ˜ä»£ç†æ•°æ®â€ä»æœ¬è´¨ä¸Šæ¥è¯´ä¸æ­£å¸¸æ•°æ®æ²¡æœ‰åŒºåˆ«ï¼Œåªæ˜¯å¤šäº†ä¸€äº›â€œå…ƒæ•°æ®â€åœ¨é‡Œé¢ï¼Œä½¿å¾— client è¿›ç¨‹å¯ä»¥é€šè¿‡ netfilter æˆ–æ“ä½œç³»ç»Ÿæä¾›çš„ API æ¥å£æ¥è·å–è¿™äº›å…ƒæ•°æ®ï¼ˆå…ƒæ•°æ®å…¶å®å°±æ˜¯åŸå§‹ç›®çš„åœ°å€å’ŒåŸå§‹ç›®çš„ç«¯å£ï¼‰ã€‚é‚£ä¹ˆè¿™ä¸ªâ€œåˆé€‚çš„æ–¹æ³•â€æ˜¯ä»€ä¹ˆï¼Ÿç›®å‰æ¥è¯´æœ‰ä¸¤ç§ï¼š REDIRECTï¼šåªæ”¯æŒ TCP åè®®çš„é€æ˜ä»£ç†ã€‚ TPROXYï¼šæ”¯æŒ TCP å’Œ UDP åè®®çš„é€æ˜ä»£ç†ã€‚ å› æ­¤ï¼Œå¯¹äº TCP é€æ˜ä»£ç†ï¼Œæœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼Œä¸€ç§æ˜¯ REDIRECTï¼Œä¸€ç§æ˜¯ TPROXYï¼›è€Œå¯¹äº UDP é€æ˜ä»£ç†ï¼Œåªèƒ½é€šè¿‡ TPROXY æ–¹å¼æ¥å®ç°ã€‚ä¸ºæ–¹ä¾¿å™è¿°ï¼Œæœ¬æ–‡ä»¥ çº¯ TPROXY æ¨¡å¼ æŒ‡ä»£ TCP å’Œ UDP éƒ½ä½¿ç”¨ TPROXY æ¥å®ç°ï¼Œä»¥ REDIRECT + TPROXY æ¨¡å¼ æŒ‡ä»£ TCP ä½¿ç”¨ REDIRECT å®ç°ï¼Œè€Œ UDP ä½¿ç”¨ TPROXY æ¥å®ç°ï¼Œæœ‰æ—¶å€™ç®€ç§° REDIRECT æ¨¡å¼ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸€ä¸ªæ„æ€ã€‚ äºŒã€Openvpnæµé‡è½¬å‘é‡‡ç”¨ï¼šhttps://github.com/zfl9/ss-tproxyåŸç†ï¼šopenvpn â†’ iptables â†’ ss-redir ä¸‰ã€éƒ¨ç½²æ–¹å¼1ã€ä¾èµ–æ£€æŸ¥åœ¨éƒ¨ç½²ä¹‹å‰ï¼Œéœ€è¦æ£€æŸ¥ä¸‹å½“å‰è‡ªå·±çš„æœåŠ¡å™¨ä¾èµ–æ˜¯å¦å®Œæ•´ï¼šä¾èµ–å®‰è£…åœ°å€ï¼šhttps://github.com/zfl9/ss-tproxy/wiki/Linux-%E9%80%8F%E6%98%8E%E4%BB%A3%E7%90%86#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96 2ã€è„šæœ¬å®‰è£…123git clone https:``//github.com/zfl9/ss-tproxycd ss-tproxychmod +x ss-tproxy install å¯ç”¨çš„æƒ…å†µä¸‹ï¼ˆæ¨èï¼‰1234install ss-tproxy /usr/local/bininstall -d /etc/ss-tproxyinstall -m` `644` `ss-tproxy.conf gfwlist* chnroute* ignlist* /etc/ss-tproxyinstall -m` `644` `ss-tproxy.service /etc/systemd/system # å¯é€‰ï¼Œå®‰è£… service æ–‡ä»¶ install ä¸å¯ç”¨1234cp -af ss-tproxy /usr/local/binmkdir -p /etc/ss-tproxycp -af ss-tproxy.conf gfwlist* chnroute* ignlist* /etc/ss-tproxycp -af ss-tproxy.service /etc/systemd/system # å¯é€‰ï¼Œå®‰è£… service æ–‡ä»¶ é…ç½®æ–‡ä»¶ï¼š /etc/ss-tproxy/ss-tproxy.conf >folded123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101# mode#mode='global' # global æ¨¡å¼ (ä¸åˆ†æµ)mode='gfwlist' # gfwlist æ¨¡å¼ (é»‘åå•)#mode='chnroute' # chnroute æ¨¡å¼ (ç™½åå•) # ipv4/6ipv4='true' # true:å¯ç”¨ipv4é€æ˜ä»£ç†; false:å…³é—­ipv4é€æ˜ä»£ç†ipv6='false' # true:å¯ç”¨ipv6é€æ˜ä»£ç†; false:å…³é—­ipv6é€æ˜ä»£ç† # tproxytproxy='false' # true:TPROXY+TPROXY; false:REDIRECT+TPROXY # tcponlytcponly='false' # true:ä»…ä»£ç†TCPæµé‡; false:ä»£ç†TCPå’ŒUDPæµé‡ # selfonlyselfonly='false' # true:ä»…ä»£ç†æœ¬æœºæµé‡; false:ä»£ç†æœ¬æœºåŠ&quot;å†…ç½‘&quot;æµé‡ # proxy# user/group(#1,æ¨è) vs svraddr+port(#2), user/groupé€‰å…¶ä¸­ä¸€ä¸ªå¡«å†™(ä¸å»ºè®®éƒ½å¡«)proxy_procuser='proxy' # æœ¬æœºä»£ç†è¿›ç¨‹çš„ user/uidï¼Œç”¨æ¥æ”¾è¡Œæœ¬æœºä»£ç†è¿›ç¨‹ä¼ å‡ºçš„æµé‡proxy_procgroup='' # æœ¬æœºä»£ç†è¿›ç¨‹çš„ group/gidï¼Œç”¨æ¥æ”¾è¡Œæœ¬æœºä»£ç†è¿›ç¨‹ä¼ å‡ºçš„æµé‡proxy_svraddr4=() # æœåŠ¡å™¨çš„ IPv4 åœ°å€æˆ–åŸŸåï¼Œå…è®¸å¡«å†™å¤šä¸ªæœåŠ¡å™¨åœ°å€ï¼Œç©ºæ ¼éš”å¼€proxy_svraddr6=() # æœåŠ¡å™¨çš„ IPv6 åœ°å€æˆ–åŸŸåï¼Œå…è®¸å¡«å†™å¤šä¸ªæœåŠ¡å™¨åœ°å€ï¼Œç©ºæ ¼éš”å¼€proxy_svrport='' # æœåŠ¡å™¨çš„ç›‘å¬ç«¯å£ï¼Œå¯å¡«å¤šä¸ªç«¯å£ï¼Œæ ¼å¼åŒ ipts_proxy_dst_portproxy_tcpport='12121' # ss/ssr/v2ray ç­‰æœ¬æœºè¿›ç¨‹çš„ TCP ç›‘å¬ç«¯å£ï¼Œè¯¥ç«¯å£æ”¯æŒé€æ˜ä»£ç†proxy_udpport='12121' # ss/ssr/v2ray ç­‰æœ¬æœºè¿›ç¨‹çš„ UDP ç›‘å¬ç«¯å£ï¼Œè¯¥ç«¯å£æ”¯æŒé€æ˜ä»£ç†proxy_startcmd='(ss-redir -c /etc/shadowsocks-libev/config.json -u &lt;/dev/null &amp;&gt;&gt;/var/log/ss-redir.log &amp;)' # ç”¨äºå¯åŠ¨æœ¬æœºä»£ç†è¿›ç¨‹çš„ shell å‘½ä»¤ï¼Œè¯¥å‘½ä»¤åº”è¯¥èƒ½ç«‹å³æ‰§è¡Œå®Œæ¯•proxy_stopcmd='kill -9 $(pidof ss-redir)' # ç”¨äºå…³é—­æœ¬æœºä»£ç†è¿›ç¨‹çš„ shell å‘½ä»¤ï¼Œè¯¥å‘½ä»¤åº”è¯¥èƒ½ç«‹å³æ‰§è¡Œå®Œæ¯• # dnsdns_direct='223.5.5.5' # æœ¬åœ° IPv4 DNSï¼Œä¸èƒ½æŒ‡å®šç«¯å£ï¼Œä¹Ÿå¯ä»¥å¡«ç»„ç»‡ã€å…¬å¸å†…éƒ¨ DNSdns_direct6='240C::6666' # æœ¬åœ° IPv6 DNSï¼Œä¸èƒ½æŒ‡å®šç«¯å£ï¼Œä¹Ÿå¯ä»¥å¡«ç»„ç»‡ã€å…¬å¸å†…éƒ¨ DNSdns_remote='8.8.8.8#53' # è¿œç¨‹ IPv4 DNSï¼Œå¿…é¡»æŒ‡å®šç«¯å£ï¼Œæç¤ºï¼šè®¿é—®è¿œç¨‹ DNS ä¼šèµ°ä»£ç†dns_remote6='2001:4860:4860::8888#53' # è¿œç¨‹ IPv6 DNSï¼Œå¿…é¡»æŒ‡å®šç«¯å£ï¼Œæç¤ºï¼šè®¿é—®è¿œç¨‹ DNS ä¼šèµ°ä»£ç† # dnsmasqdnsmasq_bind_port='53' # dnsmasq æœåŠ¡å™¨ç›‘å¬ç«¯å£ï¼Œè§ READMEdnsmasq_cache_size='4096' # DNS ç¼“å­˜å¤§å°ï¼Œå¤§å°ä¸º 0 è¡¨ç¤ºç¦ç”¨ç¼“å­˜dnsmasq_cache_time='3600' # DNS ç¼“å­˜æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ï¼Œæœ€å¤§ 3600 ç§’dnsmasq_query_maxcnt='1024' # è®¾ç½®å¹¶å‘ DNS æŸ¥è¯¢çš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º 150dnsmasq_log_enable='false' # è®°å½•è¯¦ç»†æ—¥å¿—ï¼Œé™¤éè¿›è¡Œè°ƒè¯•ï¼Œå¦åˆ™ä¸å»ºè®®å¯ç”¨dnsmasq_log_file='/var/log/dnsmasq.log' # æ—¥å¿—æ–‡ä»¶ï¼Œå¦‚æœä¸æƒ³ä¿å­˜æ—¥å¿—å¯ä»¥æ”¹ä¸º /dev/nulldnsmasq_conf_dir=() # `--conf-dir` é€‰é¡¹çš„å‚æ•°ï¼Œå¯ä»¥å¡«å¤šä¸ªï¼Œç©ºæ ¼éš”å¼€dnsmasq_conf_file=() # `--conf-file` é€‰é¡¹çš„å‚æ•°ï¼Œå¯ä»¥å¡«å¤šä¸ªï¼Œç©ºæ ¼éš”å¼€dnsmasq_conf_string=() # è‡ªå®šä¹‰é…ç½®ï¼Œä¸€ä¸ªæ•°ç»„å…ƒç´ å°±æ˜¯ä¸€è¡Œé…ç½®ï¼Œç©ºæ ¼éš”å¼€ # chinadnschinadns_bind_port='65353' # chinadns-ng æœåŠ¡å™¨ç›‘å¬ç«¯å£ï¼Œé€šå¸¸ä¸ç”¨æ”¹åŠ¨chinadns_timeout='5' # ç­‰å¾…ä¸Šæ¸¸ DNS è¿”å›å“åº”çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºç§’chinadns_repeat='1' # å‘å¯ä¿¡ DNS å‘é€å‡ æ¬¡ DNS æŸ¥è¯¢è¯·æ±‚ï¼Œé»˜è®¤ä¸º 1chinadns_fairmode='true' # ä½¿ç”¨å…¬å¹³æ¨¡å¼ï¼Œå…·ä½“çœ‹ chinadns-ng çš„ READMEchinadns_gfwlist_mode='true' # gfwlist æ¨¡å¼ï¼ŒåŠ è½½ gfwlist.txt/gfwlist.extchinadns_noip_as_chnip='false' # å¯ç”¨ chinadns-ng çš„ `--noip-as-chnip` é€‰é¡¹chinadns_verbose='false' # è®°å½•è¯¦ç»†æ—¥å¿—ï¼Œé™¤éè¿›è¡Œè°ƒè¯•ï¼Œå¦åˆ™ä¸å»ºè®®å¯ç”¨chinadns_logfile='/var/log/chinadns.log' # æ—¥å¿—æ–‡ä»¶ï¼Œå¦‚æœä¸æƒ³ä¿å­˜æ—¥å¿—å¯ä»¥æ”¹ä¸º /dev/nullchinadns_privaddr4=() # IPv4 ç§æœ‰åœ°å€æ®µï¼Œå¤šä¸ªç”¨ç©ºæ ¼éš”å¼€ï¼Œå…·ä½“è§ READMEchinadns_privaddr6=() # IPv6 ç§æœ‰åœ°å€æ®µï¼Œå¤šä¸ªç”¨ç©ºæ ¼éš”å¼€ï¼Œå…·ä½“è§ README # dns2tcpdns2tcp_bind_port='65454' # dns2tcp è½¬å‘æœåŠ¡å™¨ç›‘å¬ç«¯å£ï¼Œå¦‚æœ‰å†²çªè¯·ä¿®æ”¹dns2tcp_tcp_syncnt='' # dns2tcp çš„ `-s` é€‰é¡¹ï¼Œç•™ç©ºè¡¨ç¤ºä¸è®¾ç½®æ­¤é€‰é¡¹dns2tcp_tcp_quickack='false' # dns2tcp çš„ `-a` é€‰é¡¹ï¼Œé€‰é¡¹å–å€¼ä¸ºtrue/falsedns2tcp_tcp_fastopen='false' # dns2tcp çš„ `-f` é€‰é¡¹ï¼Œé€‰é¡¹å–å€¼ä¸ºtrue/falsedns2tcp_verbose='false' # è®°å½•è¯¦ç»†æ—¥å¿—ï¼Œé™¤éè¿›è¡Œè°ƒè¯•ï¼Œå¦åˆ™ä¸å»ºè®®å¯ç”¨dns2tcp_logfile='/var/log/dns2tcp.log' # æ—¥å¿—æ–‡ä»¶ï¼Œå¦‚æœä¸æƒ³ä¿å­˜æ—¥å¿—å¯ä»¥æ”¹ä¸º /dev/null # iptsipts_if_lo='lo' # ç¯å›æ¥å£çš„åç§°ï¼Œåœ¨æ ‡å‡†å‘è¡Œç‰ˆä¸­ï¼Œé€šå¸¸ä¸º loï¼Œå¦‚æœä¸æ˜¯è¯·ä¿®æ”¹ipts_rt_tab='233' # iproute2 è·¯ç”±è¡¨åæˆ–è¡¨ IDï¼Œé™¤éäº§ç”Ÿå†²çªï¼Œå¦åˆ™ä¸å»ºè®®æ”¹åŠ¨è¯¥é€‰é¡¹ipts_rt_mark='0x2333' # iproute2 ç­–ç•¥è·¯ç”±çš„é˜²ç«å¢™æ ‡è®°ï¼Œé™¤éäº§ç”Ÿå†²çªï¼Œå¦åˆ™ä¸å»ºè®®æ”¹åŠ¨è¯¥é€‰é¡¹ipts_set_snat='true' # è®¾ç½® iptables çš„ MASQUERADE è§„åˆ™ï¼Œå¸ƒå°”å€¼ï¼Œ`true/false`ï¼Œè¯¦è§ READMEipts_set_snat6='false' # è®¾ç½® ip6tables çš„ MASQUERADE è§„åˆ™ï¼Œå¸ƒå°”å€¼ï¼Œ`true/false`ï¼Œè¯¦è§ READMEipts_reddns_onstop='true' # ss-tproxy stop åï¼Œæ˜¯å¦å°†å…¶å®ƒä¸»æœºå‘è‡³æœ¬æœºçš„ DNS é‡å®šå‘è‡³ç›´è¿ DNSï¼Œè¯¦è§ READMEipts_proxy_dst_port='1:65535' # é»‘åå• IP çš„å“ªäº›ç«¯å£èµ°ä»£ç†ï¼Œå¤šä¸ªç”¨é€—å·éš”å¼€ï¼Œå†’å·ä¸ºç«¯å£èŒƒå›´(å«è¾¹ç•Œ)ï¼Œè¯¦è§ README # optsopts_ss_netstat='auto' # auto/ss/netstatï¼Œç”¨å“ªä¸ªç«¯å£æ£€æµ‹å·¥å…·ï¼Œè§ READMEopts_ping_cmd_to_use='auto' # auto/standalone/parameterï¼Œping ç›¸å…³ï¼Œè§ READMEopts_hostname_resolver='auto' # auto/dig/getent/pingï¼Œç”¨å“ªä¸ªè§£æå·¥å…·ï¼Œè§ READMEopts_overwrite_resolv='false' # true/false/ç•™ç©ºï¼Œå¦‚ä½•æ“ä½œ resolv.confï¼Œè§ READMEopts_ip_for_check_net='223.5.5.5' # æ£€æµ‹å¤–ç½‘æ˜¯å¦å¯è®¿é—®çš„ IPï¼Œpingï¼Œç•™ç©ºè¡¨ç¤ºè·³è¿‡æ­¤æ£€æŸ¥ # filefile_gfwlist_txt='/etc/ss-tproxy/gfwlist.txt' # gfwlist/chnlist æ¨¡å¼é¢„ç½®æ–‡ä»¶file_gfwlist_ext='/etc/ss-tproxy/gfwlist.ext' # gfwlist/chnlist æ¨¡å¼æ‰©å±•æ–‡ä»¶file_ignlist_ext='/etc/ss-tproxy/ignlist.ext' # global/chnroute æ¨¡å¼æ‰©å±•æ–‡ä»¶file_chnroute_set='/etc/ss-tproxy/chnroute.set' # chnroute åœ°å€æ®µæ–‡ä»¶ (iptables)file_chnroute6_set='/etc/ss-tproxy/chnroute6.set' # chnroute6 åœ°å€æ®µæ–‡ä»¶ (ip6tables)file_dnsserver_pid='/etc/ss-tproxy/.dnsserver.pid' # dns æœåŠ¡å™¨è¿›ç¨‹çš„ pid æ–‡ä»¶ (shell) # ä¸»è¦æ”¾é€šä¸‹å†…ç½‘çš„è®¿é—®ï¼Œç„¶åæŠŠMASQUERADEæå‰å‡ºæ¥ï¼Œè¦ä¸ç„¶tcpçš„è¿æ¥ä¼šå›ä¸æ¥post_start(){iptables -t nat -I PREROUTING -s 10.207.0.0/16 -d 10.0.0.0/8 -j ACCEPTiptables -t nat -I SSTP_POSTROUTING -s 10.207.0.0/16 -j MASQUERADE} post_stop(){iptables -t nat -D PREROUTING -s 10.207.0.0/16 -d 10.0.0.0/8 -j ACCEPTiptables -t nat -D SSTP_POSTROUTING -s 10.207.0.0/16 -j MASQUERADE} ä»¥ä¸‹é…ç½®éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œå¦‚æœä¸çŸ¥é“å¦‚ä½•é…ç½®çš„ï¼Œé‚£ä¹ˆå°±æŒ‰ç…§æˆ‘è¿™ä¹ˆé»˜è®¤é…ç½®å³å¯å…·ä½“é…ç½®ä»‹ç»ï¼šhttps://github.com/zfl9/ss-tproxy#%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E 3ã€è®¾ç½®ss-libevä»£ç†12345678910#æ–°ç‰ˆæœ¬(v4.``6.1``åŠä»¥ä¸Š)#ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶ï¼Œè¯·æ‰§è¡Œä¸‹é¢è¿™ä¸¤ä¸ªæ“ä½œ#``1``.åˆ›å»ºproxyç”¨æˆ·å’Œç»„: useradd -Mr -d/tmp -s/bin/bash proxy#``2``.æˆäºˆé€æ˜ä»£ç†ç›¸å…³æƒé™: setcap cap_net_bind_service,cap_net_admin+ep /path/to/ss-redir#&gt;&gt; è‹¥setcapä¸å¯ç”¨ï¼Œå¯ä½¿ç”¨suidæƒé™ä½ï¼Œæ­¤æ—¶éœ€é…ç½®ï¼šproxy_procuser=``''``ã€proxy_procgroup=``'proxy'#&gt;&gt; å°†æ‰€æœ‰è€…(ç»„)æ”¹ä¸ºrootï¼Œå¹¶æˆäºˆsuidæƒé™ï¼šchown root:root /path/to/ss-redir &amp;&amp; chmod` `4755` `/path/to/ss-redirproxy_procuser=``'proxy'#proxy_startcmd=``'su proxy -c&quot;(ss-redir -c /etc/ss.json -u -v &lt;/dev/null &amp;&gt;&gt;/tmp/ss-redir.log &amp;)&quot;'` `# -v è¡¨ç¤ºè®°å½•è¯¦ç»†æ—¥å¿—proxy_startcmd=``'su proxy -c&quot;(ss-redir -c /etc/ss.json -u &lt;/dev/null &amp;&gt;&gt;/tmp/ss-redir.log &amp;)&quot;'` `# è¿™é‡Œå°±ä¸è®°å½•è¯¦ç»†æ—¥å¿—äº†proxy_stopcmd=``'kill -9 $(pidof ss-redir)' é»‘åå•ã€ç™½åå•è¯´æ˜ å¯¹äº global æ¨¡å¼ï¼Œç™½åå•æ–‡ä»¶ä¸º ignlist.extï¼Œæ²¡æœ‰é»‘åå•æ–‡ä»¶ï¼Œå› ä¸ºé»˜è®¤éƒ½èµ°ä»£ç†ã€‚ å¯¹äº gfwlist æ¨¡å¼ï¼Œé»‘åå•æ–‡ä»¶ä¸º gfwlist.txt/extï¼Œæ²¡æœ‰ç™½åå•æ–‡ä»¶ï¼Œå› ä¸ºå…¶å®ƒéƒ½èµ°ç›´è¿ã€‚ å¯¹äº chnroute æ¨¡å¼ï¼Œç™½åå•æ–‡ä»¶ä¸º ignlist.extï¼Œæ²¡æœ‰é»‘åå•æ–‡ä»¶ï¼Œä½†å…è®¸å¼€å¯æ­¤åŠŸèƒ½ï¼Œè§ä¸‹ã€‚å¦‚æœæƒ³è®© chnroute æ¨¡å¼æ”¯æŒé»‘åå•æ‰©å±•ï¼Œè¯·æ‰“å¼€ chinadns-ng çš„ gfwlist æ¨¡å¼ï¼ˆchinadns_gfwlist_modeï¼‰ï¼›å¼€å¯ gfwlist æ¨¡å¼åï¼Œchinadns-ng ä¼šè¯»å– gfwlist.txt/ext é»‘åå•æ–‡ä»¶ä¸­çš„åŸŸåæ¨¡å¼ï¼›å½“ chinadns-ng æ”¶åˆ°åŸŸåè§£æè¯·æ±‚æ—¶ï¼Œä¼šå…ˆæ£€æŸ¥ç»™å®šåŸŸåæ˜¯å¦åœ¨é»‘åå•ä¸­ï¼Œå¦‚æœæ˜¯åˆ™åªå‘å¯ä¿¡ DNS å‘å‡ºè§£æè¯·æ±‚ï¼ˆä¹Ÿå°±æ˜¯ dns_remote/dns_remote6ï¼‰ï¼Œå› æ­¤è§£æå‡ºæ¥çš„ä¼šæ˜¯å›½å¤– IPï¼ˆä¸ä¸€å®šï¼Œå…·ä½“è¦çœ‹ç»™å®šåŸŸåçš„A/AAAAè®°å½•ä»¥åŠå…¶dnsè§£æè®¾å®šï¼‰ï¼Œç„¶åå½“å®¢æˆ·ç«¯è®¿é—®è¯¥ IP æ—¶å°±ä¼šèµ°ä»£ç†å‡ºå»äº†ï¼ˆå¦‚æœè§£æçš„åœ°å€æ˜¯å›½å¤–åœ°å€ï¼‰ã€‚ chinadns_gfwlist_modeçš„æœ¬æ„å…¶å®å¹¶ä¸æ˜¯ä¸ºäº†æ”¯æŒâ€™é»‘åå•â€™ï¼Œè€Œæ˜¯ä¸ºäº†æé«˜ chinadns-ng çš„å‡†ç¡®æ€§ï¼Œé™ä½ dns æ±¡æŸ“çš„å¯èƒ½æ€§ å¯åŠ¨åï¼Œss-tproxyä¼šè‡ªåŠ¨å¸®ä½ åšé€æ˜ä»£ç†ï¼Œä¼šè®¾ç½®å¥½iptablesçš„é…ç½®ï¼Œä¸éœ€è¦åœ¨æ‰‹å·¥é…ç½®åŒæ—¶ss-tproxyè¿˜æä¾›å‹¾å­çš„å½¢å¼ï¼Œæ¥å¸®åŠ©è§£å†³åˆ†æµæˆ–è€…å†…ç½‘è®¿é—®çš„ä¸€ä¸ªæ–¹æ¡ˆï¼Œå…·ä½“å‚è€ƒï¼š https://github.com/zfl9/ss-tproxy#%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0 https://github.com/zfl9/ss-tproxy#%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0%E5%B0%8F%E6%8A%80%E5%B7%A7","link":"/2023/02/16/ssTproxyTransparentAgent/"},{"title":"è®°å½•ä¸€æ¬¡åŠå…¬ç½‘å…¨çƒåŒ–çš„æ”¹é€ è®¡åˆ’","text":"èƒŒæ™¯åŠå…¬ç½‘æ¯æ¬¡å»æµ·å¤–æ‰¾èµ„æ–™éƒ½éœ€è¦é‡æ–°è¿æ¥VPNï¼Œæˆ–è€…è‡ªå·±è¿æ¥è‡ªå·±ä¹°çš„å°é£æœºä¹‹ç±»çš„æ‰å¯ä»¥ã€‚ä½†æ˜¯è¿™ç§åœ¨äº’è”ç½‘å…¬å¸å†…çš„è¯ï¼Œéå¸¸çš„ä¸å‹å¥½ï¼›ä¸ºå…¬å¸å·¥ä½œè¿˜è¦è‡ªå·±èŠ±é’±ä¹°å°é£æœºï½ ä¹‹å‰å°è¯•è¿‡ä¸‹é¢è¿™ç§æ–¹å¼ï¼šæ–°å¢ä¸€å°æµ·å¤–çš„æœºå™¨ï¼ˆæ–°åŠ å¡ã€é¦™æ¸¯ï¼‰æ­å»ºSS/v2ray/trojanä¹‹ç±»çš„åè®®ï¼Œç„¶ååŠå…¬ç½‘æ–°å¢ä¸€ä¸ªè½¯è·¯ç”±å»è¿æ¥ï¼Œé€šè¿‡ACLæŠŠéƒ¨åˆ†IPçš„ç”¨æˆ·è·³è½¬è¿‡å»ï¼›ä½†æ˜¯è¿™ç§æ–¹å¼è‡ªå·±å®¶é‡Œç”¨ç”¨è¿˜è¡Œï¼Œå¦‚æœæƒ³è¦åœ¨ä¼ä¸šçš„åŠå…¬ç½‘æ¥ä½¿ç”¨çš„è¯ï¼Œäººä¸€å¤šå°±ä¸è¡Œï¼Œå› ä¸ºæ‰€æœ‰äººéƒ½ä»è¿™ä¸ªIPå‡ºå»äº†ï¼Œè€Œä¸”æ¯æ¬¡éƒ½éœ€è¦å‘½ä»¤è¡Œå»æ“ä½œACLå¢åŠ ç”¨æˆ·ï¼Œéå¸¸çš„éº»çƒ¦ï¼› åè¯ä»‹ç» åè¯ ä»‹ç» Panabit Panabitæ˜¯å›½å†…X86å¹³å°å•æ¿å¤„ç†èƒ½åŠ›æœ€é«˜ï¼ˆåŒå‘40Gï¼‰ã€åœ¨è¿è¥å•†å’Œé«˜æ ¡ç­‰è¡Œä¸šæ¡ˆä¾‹è¿‡åƒï¼ˆXè¿è¥å•†åƒå…†ä»¥ä¸Šè§„æ ¼å…±è®¡400ä½™å°å·²æ™®éè¿ç»­ç¨³å®šè¿è¡Œè‡³ç¬¬7å¹´ï¼‰ï¼Œå®æ—¶å¯¹è¶…è¿‡3TBçš„ç½‘ç»œå¸¦å®½è¿›è¡ŒDPIè¯†åˆ«ä¸ä¼˜åŒ–æœåŠ¡ã€å¹¶é’ˆå¯¹ä¸­å°ä¼ä¸šæä¾›å…è´¹ç‰ˆæœ¬ï¼ˆè½¯ä»¶å½¢æ€ï¼‰ï¼Œæ˜¯ä»¥DPIä¸ºæ ¸å¿ƒä¼˜åŠ¿å¹¶å‘å±•èµ·æ¥çš„ä¸“ä¸šã€ä¸Šçº¿æ•ˆæœå¥½ã€æ€§ä»·æ¯”é«˜çš„æ–°ä¸€ä»£åº”ç”¨ç½‘å…³ã€‚è¿›å…¥2014å¹´ï¼Œå®é™…æ”¯æŒå›½å†…åº”ç”¨åè®®è¶…è¿‡800ç§ï¼Œå¹¶å·²é›†æˆè·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€è®¤è¯ã€ä¸€æ‹–Næ£€æµ‹ã€ç§»åŠ¨ç»ˆç«¯è¯†åˆ«ã€DNSç®¡æ§ã€HTTPç®¡æ§ã€æ—¥å¿—å®¡è®¡ç­‰å®ç”¨åŠŸèƒ½äºä¸€ä½“ã€‚ Panabit çš„ Iwanä¸ºäº†è§£å†³å‰é¢çš„è¿™ç§æ–¹å¼ï¼Œå†³å®šæµ‹è¯•ä½¿ç”¨ Panabit çš„ Iwan çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ Panabit çš„ SD-WANï¼› é‡è¿é€Ÿåº¦å¾ˆå¿«ï¼š æ¯”L2TPçš„è¦å¿«ä¸€ä¸ªæ•°é‡çº§ï¼ŒL2TPè¦é‡è¿ï¼Œéœ€è¦æœ‰å‡ åæ¬¡äº¤äº’ï¼Œè€Œæˆ‘ä»¬åªéœ€è¦ä¸€æ¬¡å³å¯ å®¢æˆ·ç«¯ä¸å—åº•å±‚æ‰¿è½½çº¿è·¯IPå˜åŒ–å½±å“ï¼š å½“åº•å±‚æ‰¿è½½çº¿è·¯ï¼ˆæ¯”å¦‚PPPOEæ‹¨å·çº¿è·¯ï¼‰çš„IPåœ°å€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¸ä¼šå½±å“iWANéš§é“ï¼ŒiWANéš§é“ä¸ä¼šä¸­æ–­ï¼Œä¿è¯é€šä¿¡æ­£å¸¸è¿›è¡Œï¼› å› ä¸ºå¾ˆå¤šç”¨æˆ·æ˜¯é€šè¿‡PPPOEæ‹¨å·çº¿è·¯å‡ºå»çš„ï¼ŒPPPOEæ‹¨å·çº¿è·¯é‡æ‹¨æ—¶ä¸€èˆ¬ä¼šæ”¹å˜IPåœ°å€ï¼Œå¦‚æœç”¨L2TPçš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªL2TPä¼šè¯å°±è¦é‡å»ºï¼› è€Œç”¨iWANçš„è¯ï¼Œç°æœ‰çš„ä¼šè¯å¯ä»¥ç…§å¸¸ä½¿ç”¨ï¼Œä¸éœ€è¦åšä»»ä½•æ”¹å˜ï¼› ä¼ è¾“æ•ˆç‡é«˜ï¼š iWANçš„åŒ…å¤´å¾ˆå°ï¼Œåªæœ‰8ä¸ªå­—èŠ‚ï¼Œè€Œä¸”åœ¨åç»­ç‰ˆæœ¬é‡Œï¼Œæˆ‘ä»¬ä¼šå‹ç¼©IPæŠ¥æ–‡å¤´ï¼Œè¿™æ ·å¯ä»¥ç»§ç»­å‡å°‘é¢å¤–æŠ¥æ–‡å¤´çš„å¤§å°ï¼Œæ‰€ä»¥èƒ½å¤§å¹…åº¦æå‡ä¼ è¾“æ•ˆç‡ï¼› å¦‚æœç”¨å›½é™…çº¿è·¯çš„è¯ï¼ŒèŠ‚çœä¸‹æ¥çš„æµé‡è´¹ç”¨éƒ½æ˜¯å¾ˆå¯è§‚çš„ï¼› æŠ—å¹²æ‰°ï¼š ä¸åƒL2TPï¼Œä¸­é—´äººå¯ä»¥ç›´æ¥å‘åŒ…TERMINATEï¼ŒiWANæ§åˆ¶å‘½ä»¤æœ‰å®Œæ•´æ€§æ£€æŸ¥ï¼Œå¯ä»¥é¿å…ä¸­é—´äººæ”»å‡»ã€‚ éƒ¨ç½²1ã€æ­å»ºpanabitè®°å¾—æœåŠ¡å™¨ç”³è¯·2Hçš„ï¼Œ1Héœ€è¦éœ€æ”¹æ ¸å¿ƒï¼Œéå¸¸éº»çƒ¦ä¸‹è½½Linuxç³»ç»Ÿæ–‡ä»¶ï¼šæ–‡æœ«ä¸Šä¼ æ–‡ä»¶åˆ°rootæ ¹ç›®å½•ä¸‹ 1234tar -xzf PanabitFREE_SUIr2p3_20220413_Linux3.tar.gzcd PanabitFREE_SUIr2p3_20220413_Linux3# è¾“å…¥ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…./ipeinstall ä¿®æ”¹/etc/PG.confæ–‡ä»¶å› ä¸ºæ˜¯å•ç½‘å£ï¼Œæ‰€ä»¥æ•°æ®å£å’Œç®¡ç†å£éƒ½éœ€è¦é…ç½®æˆeth0ï¼Œåé¢ä¸è¦åŠ ä»»ä½•ä¸œè¥¿ 1DATA_PORTS ä¿®æ”¹æˆï¼šDATA_PORTS=&quot;eth0&quot; ä¿®æ”¹ç«¯å£ä¸Šä¼ æ–‡ä»¶ï¼Œä¿®æ”¹é…ç½®éœ€è¦ä¸Šä¼ ä¸€ä¸ªjoskmcæ–‡ä»¶ï¼ˆæ–‡ä»¶åœ¨æ–‡æœ«ï¼‰åœ¨/etc/PG.confä¸­æ–°å¢ä¸€ä¸‹ä¸€è¡Œ 1HTTPS_PORT=2194 æ‰§è¡Œjoskmc1/root/joskmc tcp 2194 ä¿®æ”¹ï¼š/etc/rc.localï¼Œå¢åŠ ä¸€ä¸‹ä¸‰è¡Œ12sleep 10/root/joskmc tcp 2194 2ã€è¿›è¡Œéš§é“é…ç½®ï¼ˆæµ·å¤–ï¼‰(1)ã€ç™»å½•WEBé¡µé¢ï¼Œä¿®æ”¹ç½‘å¡æ–¹å‘é»˜è®¤è´¦å·å¯†ç ï¼šadmin/panabitç³»ç»Ÿæ¦‚å†µ â†’ ç½‘ç»œæ¥å£ï¼šeth0ï¼Œä¿®æ”¹æˆå¯¹å¤–ï¼Œåªæœ‰å¯¹å¤–æ‰å¯ä»¥åˆ›å»ºWANçº¿è·¯ (2)ã€åˆ›å»ºWANçº¿è·¯åº”ç”¨è·¯ç”± â†’ æ¥å£çº¿è·¯ï¼šéœ€è¦æ³¨æ„ï¼ŒMacåœ°å€å¿…é¡»å…‹éš† (3)ã€åˆ›å»ºIWANè¿æ¥è´¦å·å¯¹è±¡ç®¡ç† â†’ è´¦å·ç®¡ç† â†’ ç»„ç»‡æ¶æ„ï¼šåœ°å€èŒƒå›´ï¼šè¿™ä¸€å—å¯ä»¥è‡ªå·±å®šä¸€ä¸ªå†…ç½‘çš„IPæ®µå°±å¯ä»¥ï¼Œä¸è¦å†²çªå°±å¥½åœ°å€èŒƒå›´éœ€è¦æŠŠç½‘å…³åœ°å€ç•™å‡ºæ¥ï¼ï¼ï¼ï¼ï¼å¯¹è±¡ç®¡ç† â†’ è´¦å·ç®¡ç† â†’ æœ¬åœ°è´¦å·ï¼šå¤„ç†ç”¨æˆ·ç»„éœ€è¦é€‰æ‹©å‰é¢åˆ›å»ºçš„ç”¨æˆ·ç»„ï¼Œå…¶ä»–çš„æ ¹æ®å®é™…æƒ…å†µå¡«å†™ (4)ã€åˆ›å»ºiWANæœåŠ¡åº”ç”¨è·¯ç”± â†’ iWANæœåŠ¡ â†’ æœåŠ¡åˆ—è¡¨ï¼šæ³¨æ„ï¼šæœåŠ¡å™¨ç½‘å…³åœ°å€è¦å’Œä½ å‰é¢è®¾ç½®çš„åœ°å€èŒƒå›´è¦åœ¨ä¸€å—ï¼Œå¹¶ä¸”éœ€è¦æ’é™¤è¿™ä¸ªåœ°å€çš„ä¸‹å‘åº”ç”¨è·¯ç”± â†’ iWANæœåŠ¡ â†’ æœåŠ¡æ˜ å°„ï¼šæ ¹æ®é…ç½®æƒ…å†µé€‰æ‹©å³å¯iWANä½¿ç”¨çš„æ˜¯UDPè¿æ¥ï¼Œå› æ­¤ç«¯å£éœ€è¦å¼€æ”¾UDP (5)ã€åˆ›å»ºç­–ç•¥è·¯ç”±åº”ç”¨è·¯ç”± â†’ ç­–ç•¥è·¯ç”±ï¼šéœ€è¦æ·»åŠ ä¸€æ¡å›ç¨‹çš„å…¨ç¨‹è·¯ç”±ï¼Œè¦ä¸ç„¶DNSç‰µå¼•ã€FQéƒ½ä¼šå¤±è´¥è¿™é‡Œé€‰æ‹©iWANçš„çº¿è·¯ 3ã€å®¢æˆ·ç«¯é…ç½®ï¼ˆåŠå…¬ç½‘ï¼‰(1)ã€æ–°å»ºWANçº¿è·¯åº”ç”¨è·¯ç”± â†’ æ¥å£çº¿è·¯ â†’ WANçº¿è·¯ï¼šæŒ‰ç…§ä¿¡æ¯æç¤ºå¡«å†™å³å¯å®ŒæˆiWANçº¿è·¯é…ç½®æ³¨æ„ï¼šå¿…é¡»æœ‰ä¸€ä¸ªå¤–ç½‘çš„ç½‘å¡ï¼Œå¹¶ä¸”æœ€å¥½æŠŠåŠ å¯†å¼€èµ·æ¥ (2)ã€è®¾ç½®DNSç‰µå¼•åº”ç”¨è·¯ç”± â†’ DNSç®¡æ§ï¼šæµ·å¤–åŸŸåæ˜¯ä¸€ä¸ªåŸŸåç¾¤ç»„ï¼Œå¯ä»¥è‡ªå·±ä¿®æ”¹ä¸»è¦è§£å†³DNSæ±¡æŸ“é—®é¢˜ï¼Œè¦ä¸ç„¶å¯èƒ½éƒ¨åˆ†ç½‘ç«™ä¼šæ— æ³•è®¿é—®è¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆæ³¨æ„çš„ç‚¹ï¼Œå°±æ˜¯ä½ çš„DNSï¼Œè®¿é—®DNSçš„é“¾è·¯å¿…é¡»ç»è¿‡PAï¼Œå¦åˆ™ç‰µå¼•ä¸ä¼šç”Ÿæ•ˆ (3)ã€è®¾ç½®ç­–ç•¥è·¯ç”±åº”ç”¨è·¯ç”± â†’ ç­–ç•¥è·¯ç”±ï¼šæˆ‘è¿™è¾¹ç›´æ¥æ‹¿äº†é£è¿çš„609æµ·å¤–åˆ†æµIPæ®µè¿›è¡Œåˆ†æµï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±ä¿®æ”¹ï¼ˆæ–‡æœ«ä¸‹è½½ï¼‰ä¸»è¦ä¸ºäº†åªæœ‰éœ€è¦æµ·å¤–çš„æ‰å‡ºå»ï¼Œä¸èƒ½æŠŠæ‰€æœ‰çš„æµé‡å…¨éƒ¨å¯¼å‡ºå» é™„ä»¶169IPæ®µï¼š https://www.123pan.com/s/cRk7Vv-frSsH æå–ç :NzAFLinuxæ“ä½œç³»ç»Ÿï¼š https://www.123pan.com/s/cRk7Vv-arSsH æå–ç :A5MCjoskmcï¼š https://www.123pan.com/s/cRk7Vv-BrSsH æå–ç :kTu9","link":"/2023/02/17/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E5%8A%9E%E5%85%AC%E7%BD%91Panabit%E5%85%A8%E7%90%83%E5%8C%96%E7%9A%84%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/"},{"title":"å®‰è£…&amp;ç ´è§£Openvpn Access Server","text":"åœ¨çº¿å®‰è£…ï¼ˆéœ€è¦ç¿»å¢™ï¼‰12yum -y install https://as-repository.openvpn.net/as-repo-centos7.rpmyum -y install openvpn-as ç®¡ç†å‘˜ç™»å½•é¦–å…ˆéœ€è¦ä¿®æ”¹ç®¡ç†å‘˜å¯†ç  1passwd openvpn è¾“å…¥ä¹‹åå¯ä»¥ç™»å½•ç®¡ç†å‘˜é¡µé¢äº†ã€‚ å¦‚æœå¯†ç ä¸€ç›´é”™è¯¯çš„è¯ï¼Œè¯´æ˜ä¿®æ”¹å¤±è´¥äº†ï¼Œå¯ä»¥æŸ¥çœ‹ä¸‹åŸæ¥çš„å¯†ç æ˜¯ä»€ä¹ˆ 1cat /usr/local/openvpn_as/init.log ç™»å½•åç‚¹å‡»User Managementâ€“&gt;User Permissions æ·»åŠ ç”¨æˆ· ç ´è§£ç”¨æˆ·æ•° ä¸»è¦æ“ä½œçš„æ–‡ä»¶æ˜¯ä¸€ä¸ªåå« pyovpn-2.0-pyx.x.egg çš„æ–‡ä»¶ï¼Œä»¥æˆ‘äº†è§£çš„æƒ…å†µæ¥çœ‹ï¼Œä» 2.5.0 åˆ° 2.9.x æ–‡ä»¶åä¸€ç›´éƒ½æ˜¯è¿™ä¸ªï¼Œåªæ˜¯ä¸åŒç‰ˆæœ¬é‡Œé¢çš„å†…å®¹ä¸ä¸€æ ·. è¿™ä¸ªæ–‡ä»¶æœ‰ç‚¹ç±»ä¼¼ Java å½“ä¸­çš„ jar åº“æ–‡ä»¶ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª zip å‹ç¼©æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«äº†ä¸€äº› Python çš„å­—èŠ‚ç æ–‡ä»¶. ç ´è§£çš„åŸç†å¤§æ¦‚æ˜¯åœ¨ Python ä¸­é‡‡ç”¨ç±»ä¼¼ Java åŠ¨æ€ä»£ç†çš„æŠ€æœ¯ï¼Œå°†åŸæœ¬è¯»å–ç”¨æˆ·å±æ€§çš„è°ƒç”¨è¿”å›å€¼æ‹¦æˆªï¼Œä¿®æ”¹ç”¨æˆ·é™åˆ¶æ•°é‡å†è¿”å›. æ–¹æ³•2.9.0 ä»¥ä¸‹ç‰ˆæœ¬ç ´è§£çš„ç›®æ ‡æ–‡ä»¶æ˜¯ /pyovpn/lic/uprop.pyo, 2.9.0 åŠä»¥ä¸Šæ˜¯ /pyovpn/lic/uprop.pyc; æŒ‰ç…§ç½‘ä¸Šæµè¡Œçš„ç ´è§£æ–¹æ³•ï¼ŒæŠŠè¿™ä¸ªæ–‡ä»¶è§£å‹å‡ºæ¥å¹¶æ”¹åä¸º uprop2.pyo æˆ– uprop2.pyc, ç„¶åæ–°å»ºä¸€ä¸ª uprop.py æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹: **2.9.0**ä»¥ä¸‹ç‰ˆæœ¬å†…å®¹: 12345678910111213141516import uprop2old_figure = Nonedef new_figure(self, licdict): ret = old_figure(self, licdict) ret['concurrent_connections'] = 1024 return retfor x in dir(uprop2): if x[:2] == '__': continue if x == 'UsageProperties': exec('old_figure = uprop2.UsageProperties.figure') exec('uprop2.UsageProperties.figure = new_figure') exec('%s = uprop2.%s' % (x, x)) **2.9.0**åŠä»¥ä¸Šç‰ˆæœ¬å†…å®¹: 12345678910111213141516from pyovpn.lic import uprop2old_figure = Nonedef new_figure(self, licdict): ret = old_figure(self, licdict) ret['concurrent_connections'] = 1024 return retfor x in dir(uprop2): if x[:2] == '__': continue if x == 'UsageProperties': exec('old_figure = uprop2.UsageProperties.figure') exec('uprop2.UsageProperties.figure = new_figure') exec('%s = uprop2.%s' % (x, x)) å†å°†ä¸Šé¢çš„ uprop.py ç¼–è¯‘ä¸ºåº“æ–‡ä»¶ uprop.pyo æˆ– uprop.pyc: 1234# &lt;2.9.0python2 -O -m compileall uprop.py# &gt;=2.9.0python3 -O -m compileall uprop.py &amp;&amp; mv __pycache__/uprop.cpython-37.opt-1.pyc uprop.pyc æ³¨æ„ uprop.cpython-37.opt-1.pyc æ–‡ä»¶åä¼šéšç€ python ç‰ˆæœ¬å˜åŒ–è€Œå˜åŒ–. ç°åœ¨æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªæ”¹æ–‡ä»¶åçš„æ–‡ä»¶ uprop2.pyo æˆ– uprop2.pyc, å’Œä¸€ä¸ªç¼–è¯‘å‡ºæ¥çš„ uprop.pyo æˆ– uprop.pyc; æŠŠè¿™ä¸¤ä¸ªæ–‡ä»¶å‹ç¼©åˆ° pyovpn-2.0-pyx.x.egg çš„ /pyovpn/lic/ ç›®å½•ä¸‹ï¼Œç„¶åå»æœåŠ¡å™¨æ›¿æ¢ç›®æ ‡æ–‡ä»¶ï¼Œé‡å¯æœåŠ¡å°± OK äº†. æ‰€æœ‰çš„æ“ä½œå‘½ä»¤12345678910111213141516# æŠŠæ“ä½œçš„æ–‡ä»¶å¤åˆ¶å‡ºæ¥åˆ°å¦å¤–çš„ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢æ“ä½œcd /usr/local/openvpn_as/lib/python &amp; mkdir pojie &amp; cp python/pyovpn-2.0-py3.6.egg ./pojie &amp; cd pojie/# æ”¹ä¸€ä¸ªæ–‡ä»¶åï¼Œé˜²æ­¢åé¢æ‰“åŒ…çš„æ—¶å€™æŠŠæºæ–‡ä»¶è¦†ç›–äº†mv pyovpn-2.0-py3.6.egg pyovpn-2.0-py3.6.egg.bak &amp; unzip pyovpn-2.0-py3.6.egg.bak# è¿›å…¥åˆ°éœ€è¦ä¿®æ”¹çš„ç›®å½•cd pyovpn/lic# å¤åˆ¶æºæ–‡ä»¶æ”¹åmv uprop.pyc uprop2.pyc# æ–°å¢ä¸€ä¸ªpyæ–‡ä»¶ï¼Œç„¶åæŠŠæ–‡ä»¶å†…å®¹å¤åˆ¶è¿›å»ï¼Œå¹¶ä¿å­˜vi uprop.py# é€€åˆ° pojie æ–‡ä»¶å¤¹ï¼Œè¿›è¡Œæ‰“åŒ…zip -r pyovpn-2.0-py3.6.egg EGG-INFO/ common/ pyovpn/# å¤åˆ¶æ–‡ä»¶åˆ°è¿è¡Œç›®å½•ï¼Œè¦†ç›–cp pyovpn-2.0-py3.6.egg /usr/local/openvpn_as/lib/python# é‡å¯æœåŠ¡systemctl restart openvpnas","link":"/2022/12/13/openvpn/openvpn-access-server/"},{"title":"openvpn-authï¼ˆæ”¯æŒä¼ä¸šå¾®ä¿¡è®¤è¯&amp;LDAPï¼‰","text":"æ–¹æ¡ˆä»‹ç»æ—¶åºå›¾ å…¶ä¸­æœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦ä¿®æ”¹ corpid: ä¼ä¸šå¾®ä¿¡çš„ä¼ä¸šID corpsecret: æ‹¥æœ‰é€šè®¯å½•çš„ä¼ä¸šå¾®ä¿¡çš„Secret ä»£ç å¦‚ä¸‹123456789101112131415161718192021222324252627282930313233343536373839404142434445464748package authimport ( &quot;io/ioutil&quot; &quot;log&quot; &quot;net/http&quot; &quot;strconv&quot; &quot;github.com/tidwall/gjson&quot;)func GetAccessToken() string { return GetWecomToken()}// ä»ä¼ä¸šå¾®ä¿¡è·å–Tokenfunc GetWecomToken() string { //åˆ›å»ºä¸€ä¸ªè¯·æ±‚ req, err := http.NewRequest(&quot;GET&quot;, &quot;https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=corpid&amp;corpsecret=corpsecret&quot;, nil) if err != nil { log.Println(&quot;NewRquest:&quot;, err) } client := &amp;http.Client{} //è®¾ç½®è¯·æ±‚å¤´ req.Header.Set(&quot;Content-Type&quot;, &quot;application/json; charset=utf-8&quot;) //å‘é€è¯·æ±‚ resp, err := client.Do(req) //å…³é—­è¯·æ±‚ defer resp.Body.Close() body, err := ioutil.ReadAll(resp.Body) access_token := gjson.Get(string(body), &quot;access_token&quot;) return access_token.Str}// è·å–å‘˜å·¥ä¿¡æ¯func WeComAuth(userId string) bool { //åˆ›å»ºä¸€ä¸ªè¯·æ±‚ req, err := http.NewRequest(&quot;GET&quot;, `https://qyapi.weixin.qq.com/cgi-bin/user/get?access_token=`+GetAccessToken()+`&amp;userid=`+userId, nil) if err != nil { log.Println(&quot;NewRquest:&quot;, err) } client := &amp;http.Client{} //è®¾ç½®è¯·æ±‚å¤´ req.Header.Set(&quot;Content-Type&quot;, &quot;application/json; charset=utf-8&quot;) //å‘é€è¯·æ±‚ resp, err := client.Do(req) //å…³é—­è¯·æ±‚ defer resp.Body.Close() body, err := ioutil.ReadAll(resp.Body) errcode := gjson.Get(string(body), &quot;errcode&quot;) int, err := strconv.Atoi(errcode.Str) return int == 0} ä½¿ç”¨æ–¹å¼ä¿®æ”¹/etc/openvpn/server.confçš„éªŒè¯æ–¹å¼ï¼Œå¯ä»¥å§å…¶ä»–çš„éªŒè¯å»æ‰ 1auth-user-pass-verify /etc/openvpn/openvpn-wecom-password via-file åŠ è§£å¯†æ–¹å¼å› ä¸ºç”¨åˆ°äº†å®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„æ—¶å€™çš„åŠ å¯†æ–¹å¼ï¼Œå› æ­¤ä¸¤è¾¹çš„åŠ å¯†æ–¹å¼å¿…é¡»ä¸€è‡´ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475package utilimport ( &quot;bytes&quot; basicAES &quot;crypto/aes&quot; &quot;crypto/cipher&quot; &quot;encoding/base64&quot;)type Aes struct { securityKey []byte iv []byte}/** * constructor */func AesTool() *Aes { return &amp;Aes{[]byte(&quot;123&quot;), []byte(&quot;123&quot;)}}/** * åŠ å¯† * @param string $plainText æ˜æ–‡ * @return bool|string */func (a Aes) Encrypt(plainText string) (string, error) { block, err := basicAES.NewCipher(a.securityKey) if err != nil { return &quot;&quot;, err } plainTextByte := []byte(plainText) blockSize := block.BlockSize() plainTextByte = AddPKCS7Padding(plainTextByte, blockSize) cipherText := make([]byte, len(plainTextByte)) mode := cipher.NewCBCEncrypter(block, a.iv) mode.CryptBlocks(cipherText, plainTextByte) return base64.StdEncoding.EncodeToString(cipherText), nil}/** * è§£å¯† * @param string $cipherText å¯†æ–‡ * @return bool|string */func (a Aes) Decrypt(cipherText string) (string, error) { block, err := basicAES.NewCipher(a.securityKey) if err != nil { return &quot;&quot;, err } cipherDecodeText, decodeErr := base64.StdEncoding.DecodeString(cipherText) if decodeErr != nil { return &quot;&quot;, decodeErr } mode := cipher.NewCBCDecrypter(block, a.iv) originCipherText := make([]byte, len(cipherDecodeText)) mode.CryptBlocks(originCipherText, cipherDecodeText) originCipherText = StripPKSC7Padding(originCipherText) return string(originCipherText), nil}/** * å¡«å……ç®—æ³• * @param string $source * @return string */func AddPKCS7Padding(ciphertext []byte, blockSize int) []byte { padding := blockSize - len(ciphertext)%blockSize paddingText := bytes.Repeat([]byte{byte(padding)}, padding) return append(ciphertext, paddingText...)}/** * ç§»å»å¡«å……ç®—æ³• * @param string $source * @return string */func StripPKSC7Padding(cipherText []byte) []byte { length := len(cipherText) unpadding := int(cipherText[length-1]) return cipherText[:(length - unpadding)]}","link":"/2022/12/13/openvpn/openvpn-auth/"},{"title":"openvpnåŠ¨æ€ä¸‹å‘æƒé™","text":"é¦–å…ˆäº†è§£æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦åŠ¨æ€ä¸‹å‘ å¼€æºçš„openvpnå¹¶ä¸æ”¯æŒæƒé™ç®¡ç†ï¼Œå¤§éƒ¨åˆ†åœ¨åšæƒé™ç®¡ç†çš„æ—¶å€™ä½¿ç”¨çš„éƒ½æ˜¯æ ¹æ®æ¥æºIPæˆ–IPæ®µé€šè¿‡iptables/äº¤æ¢æœºæ¥è¿›è¡Œæƒé™æ§åˆ¶ æƒé™æ§åˆ¶å¤ªå¹¿äº†ï¼Œæ ¹æœ¬æ— æ³•å¾ˆå¥½çš„å»åšç®¡ç†åå°çš„é…ç½®ï¼Œç‰¹åˆ«æ˜¯éœ€è¦ç”¨æˆ·ç»„æ¥è¿›è¡ŒåŒºåˆ†çš„æ—¶å€™ï¼Œé‚£å°±æ›´å›°éš¾äº† æƒé™ä¸‹å‘çš„é€»è¾‘ ç”¨åˆ°çš„æŠ€æœ¯ ipset iptables ä¸»è¦è„šæœ¬å†…å®¹è¿æ¥è„šæœ¬1234567891011121314/sbin/ipset create ${common_name}-${common_ip} hash:ip/sbin/ipset create ${common_name}-${common_ip}-drop hash:ip# è¿™é‡Œæ˜¯åŠ¨æ€å»ä½ çš„åç«¯è·å–å‡ºæ¥çš„å…è®¸è®¿é—®çš„åˆ—è¡¨ï¼Œæ¥å£è‡ªå·±å»å®ç°for index in `seq 0 $permissionsAcceptLength`; do /sbin/ipset add ${common_name}-${common_ip} ${permissionsAccept[$index]//\\&quot;/}donefor index in `seq 0 $permissionsDropLength`; do /sbin/ipset add ${common_name}-${common_ip}-drop ${permissionsDrop[$index]//\\&quot;/}done# è®¾ç½®iptables/sbin/iptables -A FORWARD -s $common_ip -m set --match-set ${common_name}-${common_ip} dst -j ACCEPT/sbin/iptables -A FORWARD -s $common_ip -m set --match-set ${common_name}-${common_ip}-drop dst -j DROP/sbin/iptables -A FORWARD -s $common_ip -j DROP æ–­å¼€è„šæœ¬12345/sbin/iptables -D FORWARD -s $ifconfig_pool_remote_ip -m set --match-set ${common_name}-${ifconfig_pool_remote_ip} dst -j ACCEPT/sbin/iptables -D FORWARD -s $ifconfig_pool_remote_ip -m set --match-set ${common_name}-${ifconfig_pool_remote_ip}-drop dst -j DROP/sbin/iptables -D FORWARD -s $ifconfig_pool_remote_ip -j DROP/sbin/ipset destroy ${common_name}-${ifconfig_pool_remote_ip}/sbin/ipset destroy ${common_name}-${ifconfig_pool_remote_ip}-drop å¦‚æœåœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­å‡ºç°è„šæœ¬æƒé™ä¸è¶³123chmod 766 connect.sh disconnect.shchmod a+x connect.sh disconnect.shchmod +s connect.sh disconnect.sh","link":"/2022/12/14/openvpn/openvpn-dynamic-route-permissions/"},{"title":"æ¸…ç†è‡ªå®šä¹‰DHCPä¸‹å‘ï¼Œå¼‚å¸¸æ–­å¼€å¯¼è‡´IPåœ°å€å ç”¨çš„é—®é¢˜","text":"èƒŒæ™¯å› ä¸ºOpenVpnå­˜åœ¨æ–­å¼€é‡è¿çš„æœºåˆ¶ï¼Œå¦‚æœçªç„¶å‡ºç°ç½‘ç»œæŠ–åŠ¨ï¼Œç”¨æˆ·ç«¯æ²¡æœ‰è§¦å‘æ–­å¼€å‘½ä»¤ï¼Œä½†æ˜¯åŒæ—¶åˆè§¦å‘äº†é‡æ–°è¿æ¥çš„å‘½ä»¤ï¼Œè¿™æ—¶å€™VPNè¿™é‡Œå°±ä¼šé‡æ–°ç»™ä¸‹å‘ä¸€ä¸ªæ–°çš„åœ°å€ï¼Œä½†æ˜¯è€çš„åœ°å€ä¸ä¼šå›æ”¶æ‰ï¼Œè¿™ä¸ªä¹Ÿæ˜¯å¾ˆæ—©ä¹‹å‰DHCPè¢«ç”¨å®Œçš„çœŸæ­£åŸå›  å¤„ç†æ–¹å¼åœ¨æ¯ä¸€å°openvpnçš„æœºå™¨ä¸Šæ–°å¢ä¸€ä¸ªshellè„šæœ¬åšå®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©ä¸´æ™¨2ç‚¹å¼€å§‹å¾ªç¯éå† 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556#!/bin/bashIFS=$'\\n' # ä¿®æ”¹é»˜è®¤åˆ†éš”ç¬¦OLDIFS=&quot;$IFS&quot; # æ¸…ç†æ— æ•ˆçš„IPåœ°å€function clearIp(){ # å–å‡ºå½“å‰å·²ç»åˆ†é…ä¸‹å»çš„æ‰€æœ‰IPåœ°å€ result=$(curl -s &quot;åç«¯è·å–å½“å‰ä½¿ç”¨IPçš„æ¥å£åœ°å€&quot;); ipList=`echo $result | jq '.d.result'`; ipListLength=`echo $ipList | jq '.|length'`; date=`date &quot;+%Y-%m-%d %H:%M:%S&quot;` # å¾ªç¯æ‰€æœ‰çš„æ•°æ® for index in `seq 0 $ipListLength` do ip=`echo $ipList | jq -r &quot;.[$index].ip&quot;`; common_name=`echo $ipList | jq -r &quot;.[$index].user&quot;` # æ‹¿åˆ°å½“å‰çœŸæ­£åœ¨ä½¿ç”¨çš„IPåœ°å€ useIp=`cat /var/log/openvpn/status.log | grep CLIENT_LIST | awk '{if (NR&gt;1){print $1}}' | cut -d ',' -f 4` # å¦‚æœå½“å‰IPå·²ç»ä¸åœ¨ä½¿ç”¨äº†ï¼Œé‚£ä¹ˆå°±éœ€è¦é‡Šæ”¾ï¼Œé˜²æ­¢åæœŸåœ°å€æ± ä¸å¤Ÿç”¨çš„æƒ…å†µ if [[ &quot;${useIp[@]}&quot; =~ &quot;${ip}&quot; ]]; then echo &quot;${date} | ${ip} | å½“å‰IPå±äºä½¿ç”¨çŠ¶æ€ï¼Œæ— éœ€é‡Šæ”¾&quot;; else curl -s &quot;é‡Šæ”¾IPçš„æ¥å£åœ°å€&quot; &gt;&gt; /var/log/openvpn/disconnect.log echo &quot;${date} | ${ip} | ${common_name} | å½“å‰IPéœ€è¦é‡Šæ”¾&quot; fi done} # æ¸…ç†Iptableçš„è§„åˆ™function clearIptable(){ iptableResult=($(iptables -L | grep 10.207 | grep ACCEPT | awk '{print $7}')) iptableResultCount=($(iptables -L | grep 10.207 | grep ACCEPT | awk '{print $7}' | wc -l)) date=`date &quot;+%Y-%m-%d %H:%M:%S&quot;` for item in ${iptableResult[@]} do ip=`echo $item | cut -d '-' -f 2` common_name=`echo $item | cut -d '-' -f 1` ifconfig_pool_remote_ip=$ip useIp=`cat /var/log/openvpn/status.log | grep CLIENT_LIST | awk '{if (NR&gt;1){print $1}}' | cut -d ',' -f 4` # å¦‚æœå½“å‰IPå·²ç»ä¸åœ¨ä½¿ç”¨äº†ï¼Œé‚£ä¹ˆå°±éœ€è¦é‡Šæ”¾ï¼Œé˜²æ­¢åæœŸåœ°å€æ± ä¸å¤Ÿç”¨çš„æƒ…å†µ if [[ &quot;${useIp[@]}&quot; =~ &quot;${ip}&quot; ]]; then echo &quot;${date} | ${ip} | å½“å‰IPå±äºä½¿ç”¨çŠ¶æ€ï¼Œæ— éœ€é‡Šæ”¾&quot;; else echo &quot;${date} | ${ifconfig_pool_remote_ip} | ${common_name} | å½“å‰IPéœ€è¦é‡Šæ”¾&quot; /sbin/iptables -D FORWARD -s $ifconfig_pool_remote_ip -m set --match-set ${common_name}-${ifconfig_pool_remote_ip} dst -j ACCEPT /sbin/iptables -D FORWARD -s $ifconfig_pool_remote_ip -m set --match-set ${common_name}-${ifconfig_pool_remote_ip}-drop dst -j DROP /sbin/iptables -D FORWARD -s $ifconfig_pool_remote_ip -j DROP /sbin/ipset destroy ${common_name}-${ifconfig_pool_remote_ip} /sbin/ipset destroy ${common_name}-${ifconfig_pool_remote_ip}-drop fi done} clearIp()clearIptable()","link":"/2023/02/16/openvpn/clearOpenvpnInvalidIp/"},{"title":"zabbix è­¦æŠ¥æ¨é€è‡³ä¼ä¸šå¾®ä¿¡ï¼ˆå›¾æ–‡ç‰ˆï¼‰","text":"æ–°å¢Pythonè„šæœ¬ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131# encoding: utf-8import sysimport requestsimport jsonimport osimport timeimport re url = 'http://10.1.1.59/zabbix/api_jsonrpc.php'headers = {'Content-Type': 'application/json-rpc'}graph_path = '/data/zabbix/images/' # å®šä¹‰å›¾ç‰‡å­˜å‚¨è·¯å¾„graph_url = 'http://10.1.1.59/zabbix/chart.php' # å®šä¹‰å›¾è¡¨çš„urlloginurl = &quot;http://10.1.1.59/zabbix/index.php&quot; # å®šä¹‰ç™»å½•çš„url def uploadImg(path,accessToken): #img_url = &quot;https://qyapi.weixin.qq.com/cgi-bin/webhook/upload_media?key=&quot; + key + &quot;&amp;type=file&quot; img_url = &quot;https://qyapi.weixin.qq.com/cgi-bin/media/uploadimg?access_token=&quot;+accessToken files = {'media': open(path, 'rb')} r = requests.post(img_url, files=files) re = json.loads(r.text) print(re) return re['url'] def get_itemid(message): #print(message) itemid = re.search(r'ITEMID:(\\d+)', message).group(1) #itemid = 1 return itemid def get_imgUrl(itemid): session = requests.Session() try: loginheaders = { &quot;Host&quot;: &quot;10.1.1.59&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot; } # å®šä¹‰è¯·æ±‚æ¶ˆæ¯å¤´ payload = { &quot;name&quot;: 'yantao', &quot;password&quot;: 'xxxxxxx', &quot;autologin&quot;: &quot;1&quot;, &quot;enter&quot;: &quot;Sign in&quot;, } # å®šä¹‰ä¼ å…¥çš„data login = session.post(url=loginurl, headers=loginheaders, data=payload) print(login) graph_params = { &quot;from&quot;: &quot;now-10m&quot;, &quot;to&quot;: &quot;now&quot;, &quot;itemids&quot;: itemid, &quot;width&quot;: &quot;400&quot;, } # å®šä¹‰è·å–å›¾ç‰‡çš„å‚æ•° graph_req = session.get(url=graph_url, params=graph_params) # å‘é€getè¯·æ±‚è·å–å›¾ç‰‡æ•°æ® time_tag = time.strftime(&quot;%Y%m%d%H%M%S&quot;, time.localtime()) graph_name = 'baojing_' + time_tag + '.png' # ç”¨æŠ¥è­¦æ—¶é—´æ¥ä½œä¸ºå›¾ç‰‡åè¿›è¡Œä¿å­˜ graph_name = os.path.join(graph_path, graph_name) # ä½¿ç”¨ç»å¯¹è·¯å¾„ä¿å­˜å›¾ç‰‡ with open(graph_name, 'wb', ) as f: f.write(graph_req.content) # å°†è·å–åˆ°çš„å›¾ç‰‡æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­å» return graph_name except Exception as e: print(e) return False def getAccessToken(): api_url = &quot;https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=corpid&amp;corpsecret=corpsecret&quot; content = requests.get(api_url) #print(content.json()) return content.json().get(&quot;access_token&quot;) def getImgUrl(mediaId,accessToken): api_url = &quot;https://qyapi.weixin.qq.com/cgi-bin/media/get?access_token=&quot;+accessToken+&quot;&amp;media_id=&quot;+mediaId content = requests.get(api_url) print(mediaId) print(content.json()) return content.json().get(&quot;url&quot;) def send_message(imgUrl,title,desc,openUrl,key): # å‘é€æ¶ˆæ¯ url = &quot;https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=&quot; + key # message = title # sys.argv[3] params = { &quot;msgtype&quot;: &quot;template_card&quot;, &quot;template_card&quot;: { &quot;card_type&quot;: &quot;news_notice&quot;, &quot;source&quot;: { &quot;desc&quot;: &quot;Zabbixç½‘ç»œè­¦æŠ¥&quot;, &quot;desc_color&quot;: 0 }, &quot;main_title&quot;:{ &quot;title&quot;:&quot;Zabbixç½‘ç»œè­¦æŠ¥&quot;, }, &quot;quote_area&quot;:{ &quot;type&quot;:0, &quot;quote_text&quot;:desc }, &quot;card_image&quot;: { &quot;url&quot;: imgUrl }, &quot;card_action&quot;: { &quot;type&quot;: 1, &quot;url&quot;: openUrl, &quot;appid&quot;: &quot;APPID&quot;, &quot;pagepath&quot;: &quot;PAGEPATH&quot; } } } req = requests.post(url, data=json.dumps(params)) print(req.json()) if __name__ == '__main__': message = sys.argv[1] print(message) itemid = get_itemid(message) imgpath = get_imgUrl(itemid) accessToken = getAccessToken(); imgUrl = uploadImg(imgpath,accessToken) #print(itemid) #print(imgpath) print(imgUrl) send_message(imgUrl,sys.argv[2],sys.argv[3],imgUrl,sys.argv[4]) #accessToken = getAccessToken() æ–°å¢SHè„šæœ¬123#!/bin/bashecho $1 &gt;&gt; /data/zabbix/log.logpython /usr/lib/zabbix/alertscripts/wxcom.py $1 $2 $3 $4 æŠŠä¸¤ä¸ªæ–‡ä»¶éƒ½æ”¾åˆ°è¿™ä¸ªç›®å½•ä¸‹ï¼š/usr/lib/zabbix/alertscripts/ é…ç½®åª’ä»‹","link":"/2022/12/13/zabbix/zabbix-wecom/"}],"tags":[{"name":"openwrt","slug":"openwrt","link":"/tags/openwrt/"},{"name":"å¤šæ‹¨","slug":"å¤šæ‹¨","link":"/tags/%E5%A4%9A%E6%8B%A8/"},{"name":"Obsidian","slug":"Obsidian","link":"/tags/Obsidian/"},{"name":"python","slug":"python","link":"/tags/python/"},{"name":"chatgpt","slug":"chatgpt","link":"/tags/chatgpt/"},{"name":"gpt","slug":"gpt","link":"/tags/gpt/"},{"name":"telegram","slug":"telegram","link":"/tags/telegram/"},{"name":"zabbix","slug":"zabbix","link":"/tags/zabbix/"},{"name":"tcp","slug":"tcp","link":"/tags/tcp/"},{"name":"udp","slug":"udp","link":"/tags/udp/"},{"name":"curl","slug":"curl","link":"/tags/curl/"},{"name":"ä»£ç†","slug":"ä»£ç†","link":"/tags/%E4%BB%A3%E7%90%86/"},{"name":"æ£€æµ‹","slug":"æ£€æµ‹","link":"/tags/%E6%A3%80%E6%B5%8B/"},{"name":"é€æ˜ä»£ç†","slug":"é€æ˜ä»£ç†","link":"/tags/%E9%80%8F%E6%98%8E%E4%BB%A3%E7%90%86/"},{"name":"vpn","slug":"vpn","link":"/tags/vpn/"},{"name":"æµé‡è½¬å‘","slug":"æµé‡è½¬å‘","link":"/tags/%E6%B5%81%E9%87%8F%E8%BD%AC%E5%8F%91/"},{"name":"åŠå…¬ç½‘","slug":"åŠå…¬ç½‘","link":"/tags/%E5%8A%9E%E5%85%AC%E7%BD%91/"},{"name":"å…¨çƒåŒ–","slug":"å…¨çƒåŒ–","link":"/tags/%E5%85%A8%E7%90%83%E5%8C%96/"},{"name":"å…¨çƒåŠå…¬","slug":"å…¨çƒåŠå…¬","link":"/tags/%E5%85%A8%E7%90%83%E5%8A%9E%E5%85%AC/"},{"name":"å›½é™…åŒ–","slug":"å›½é™…åŒ–","link":"/tags/%E5%9B%BD%E9%99%85%E5%8C%96/"},{"name":"Panabit","slug":"Panabit","link":"/tags/Panabit/"},{"name":"iwan","slug":"iwan","link":"/tags/iwan/"},{"name":"sd-wan","slug":"sd-wan","link":"/tags/sd-wan/"},{"name":"2.9.0","slug":"2-9-0","link":"/tags/2-9-0/"},{"name":"openvpn","slug":"openvpn","link":"/tags/openvpn/"},{"name":"openvpn access server","slug":"openvpn-access-server","link":"/tags/openvpn-access-server/"},{"name":"ç ´è§£","slug":"ç ´è§£","link":"/tags/%E7%A0%B4%E8%A7%A3/"},{"name":"openvpn-auth","slug":"openvpn-auth","link":"/tags/openvpn-auth/"},{"name":"wecom","slug":"wecom","link":"/tags/wecom/"},{"name":"ä¼ä¸šå¾®ä¿¡","slug":"ä¼ä¸šå¾®ä¿¡","link":"/tags/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1/"},{"name":"è®¤è¯","slug":"è®¤è¯","link":"/tags/%E8%AE%A4%E8%AF%81/"},{"name":"ldap","slug":"ldap","link":"/tags/ldap/"},{"name":"æƒé™","slug":"æƒé™","link":"/tags/%E6%9D%83%E9%99%90/"},{"name":"åŠ¨æ€ä¸‹å‘","slug":"åŠ¨æ€ä¸‹å‘","link":"/tags/%E5%8A%A8%E6%80%81%E4%B8%8B%E5%8F%91/"},{"name":"dhcp","slug":"dhcp","link":"/tags/dhcp/"},{"name":"æŠ¥è­¦","slug":"æŠ¥è­¦","link":"/tags/%E6%8A%A5%E8%AD%A6/"}],"categories":[],"pages":[]}