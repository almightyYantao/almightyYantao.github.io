<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>linuxé€šè¿‡SNMPæ£€æµ‹TCP&amp;UDPè¿æ¥æ•°</title>
      <link href="/2023/03/11/linux%E9%80%9A%E8%BF%87SNMP%E6%A3%80%E6%B5%8BTCP&amp;UDP%E8%BF%9E%E6%8E%A5%E6%95%B0/"/>
      <url>/2023/03/11/linux%E9%80%9A%E8%BF%87SNMP%E6%A3%80%E6%B5%8BTCP&amp;UDP%E8%BF%9E%E6%8E%A5%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="å…ˆä¸Šå›¾-amp-ä»‹ç»"><a href="#å…ˆä¸Šå›¾-amp-ä»‹ç»" class="headerlink" title="å…ˆä¸Šå›¾&amp;ä»‹ç»"></a>å…ˆä¸Šå›¾&amp;ä»‹ç»</h1><p>è®°å½•ä¸€æ¬¡å…¨çƒåŒ–ç½‘ç»œç›‘æ§çš„çœ‹æ¿å»ºè®¾ï¼›<br>ä¹‹å‰éƒ½æ˜¯é€šè¿‡zabbixæ¥è¿›è¡Œå»ºè®¾çœ‹æ¿ï¼Œä½†æ˜¯ç”¨äº†ä¸€æ®µæ—¶é—´åæ€»æ˜¯ç¼ºç‚¹æ„Ÿè§‰ï¼›åé¢é€šè¿‡å¤§ä½¬çš„ä»‹ç»ï¼Œè¯•ç”¨äº†<code>Grafana</code>ï¼Œè¿™ä¸è¯•ç”¨è¿˜å¥½ï¼Œä¸€è¯•ç”¨ï¼Œæ•ˆæœçš„å±•ç°è®©æˆ‘æ— æ³•è‡ªæ‹”ï¼Œè¿™å°±æ˜¯æˆ‘æƒ³è¦çš„ç›‘æ§çœ‹æ¿å•Šï¼èƒ½æ ¹æ®æ•°å€¼çš„ä¸åŒè¿›è¡Œé¢œè‰²çš„åŒºåˆ†ï¼Œåœ¨å¤§å±ä¸Šä¸€çœ¼å°±å¯ä»¥çœ‹å‡ºå½“å‰å“ªä¸€å—ç½‘ç»œå‡ºç°äº†é—®é¢˜ï¼</p><p>ç¾ä¸­ä¸è¶³çš„æ˜¯ï¼Œä¸Šé¢çš„ä¸¤åˆ—ä¸èƒ½è®¾ç½®æŠ¥è­¦ï¼ŒæŠ¥è­¦è²Œä¼¼å¿…é¡»æ˜¯å›¾è¡¨å½¢å¼çš„æ‰å¯ä»¥ï¼›ä¸è¿‡å¯ä»¥å»ºç«‹ä¸€ä¸ªé€šç”¨çš„æŠ¥è­¦çœ‹æ¿ï¼Œé—®é¢˜ä¸å¤§ï½</p><p>å…¶ä»–çš„ä¸€äº›ç›‘æ§é¡¹éƒ½æ˜¯æœ€ç®€å•åŸºç¡€çš„ï¼Œæˆ‘è¿™è¾¹å°±ä¸è¿‡å¤šçš„èµ˜è¿°ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œä¸Šç½‘æœç´¢ï¼Œæˆ–è€…ä¹‹å‰å¼•ç”¨ä¹‹å‰<code>zabbix</code>çš„æ•°æ®ï¼Œä¸»è¦è®²è§£ä¸‹<code>TCPè¿æ¥æ•°</code>å’Œ<code>UDPè¿æ¥æ•°</code>çš„è·å–</p><p>åˆ«çš„ä¸è¯´ï¼Œè¿™å›¾è¿˜æ˜¯å¾ˆå¥½çœ‹çš„ï¼›<br><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/202303112218722.png"/></p><h1 id="ç°åœ¨è®²è®²è·å–TCP-x2F-UDPè¿æ¥æ•°çš„å‡†å¤‡"><a href="#ç°åœ¨è®²è®²è·å–TCP-x2F-UDPè¿æ¥æ•°çš„å‡†å¤‡" class="headerlink" title="ç°åœ¨è®²è®²è·å–TCP&#x2F;UDPè¿æ¥æ•°çš„å‡†å¤‡"></a>ç°åœ¨è®²è®²è·å–TCP&#x2F;UDPè¿æ¥æ•°çš„å‡†å¤‡</h1><ul><li>SNMP (yum install snmpd)</li><li>è‡ªå®šä¹‰OID</li></ul><h1 id="åˆ›å»ºè·å–è¿æ¥æ•°è„šæœ¬"><a href="#åˆ›å»ºè·å–è¿æ¥æ•°è„šæœ¬" class="headerlink" title="åˆ›å»ºè·å–è¿æ¥æ•°è„šæœ¬"></a>åˆ›å»ºè·å–è¿æ¥æ•°è„šæœ¬</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$2</span></span><br><span class="line"><span class="built_in">echo</span> <span class="built_in">integer</span></span><br><span class="line"><span class="built_in">echo</span> $(netstat -an|awk <span class="string">&#x27;/^tcp/ &#123;++s[$NF]&#125; END &#123;for(a in s ) print a,s[a]&#125;&#x27;</span> | grep ESTABLISHED | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ˜¯è·å–<code>TCP</code>è¿æ¥æ•°çš„è„šæœ¬ï¼Œå¦‚æœè¦è·å–UDPçš„ï¼Œè¯·æŠŠ<code>tcp</code>æ”¹æˆ<code>udp</code><br>è®¾ç½®è„šæœ¬æƒé™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 766 zabbix.tcp.sh</span><br></pre></td></tr></table></figure><h1 id="ä¿®æ”¹SNMPé…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹SNMPé…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹SNMPé…ç½®æ–‡ä»¶"></a>ä¿®æ”¹SNMPé…ç½®æ–‡ä»¶</h1><p>æ–‡ä»¶è·¯å¾„ï¼š<code>/etc/snmp/snmpd.conf</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pass .1.3.6.1.4.1.2021.21 /etc/snmp/shell/zabbix.tcp.sh</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨æœ€åº•ä¸‹åŠ å…¥è¿™æ¡å‘½ä»¤ï¼Œåé¢çš„<code>shell</code>è„šæœ¬å°±æ˜¯ä¸Šä¼ åˆ›å»ºçš„è„šæœ¬è·¯å¾„</p></blockquote><h1 id="é‡å¯SNMPæœåŠ¡"><a href="#é‡å¯SNMPæœåŠ¡" class="headerlink" title="é‡å¯SNMPæœåŠ¡"></a>é‡å¯SNMPæœåŠ¡</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service snmpd restart</span><br></pre></td></tr></table></figure><h1 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h1><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥åšæ›´å¤šçš„æ‰©å±•ï¼Œæ¯”å¦‚</p><ul><li>è·å–è¿æ¥äººæ•°</li><li>å½“å‰è®¿é—®æƒ…å†µ</li><li>â€¦</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> zabbix </tag>
            
            <tag> tcp </tag>
            
            <tag> udp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Obsidian å…è´¹çš„å®æ—¶åŒæ­¥æœåŠ¡</title>
      <link href="/2023/03/06/Obsidian%20%E5%85%8D%E8%B4%B9%E7%9A%84%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5%E6%9C%8D%E5%8A%A1/"/>
      <url>/2023/03/06/Obsidian%20%E5%85%8D%E8%B4%B9%E7%9A%84%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<p>ä½¿ç”¨ fly.io å…è´¹è®¡åˆ’éƒ¨ç½²æˆ–è‡ªæ‰˜ç®¡æ•°æ®åº“ï¼Œè¿›è¡Œ LiveSync æ’ä»¶çš„ä¸€ç³»åˆ—é…ç½®åå®ç°å„è®¾å¤‡é—´ Obsidian å®æ—¶å¢é‡ä¿®æ”¹åŒæ­¥ï¼Œå¯ä»¥å’Œå®˜æ–¹åŒæ­¥æœåŠ¡ç›¸åª²ç¾ã€‚</p><span id="more"></span><h2 id="ä½¿ç”¨-fly-io"><a href="#ä½¿ç”¨-fly-io" class="headerlink" title="ä½¿ç”¨ fly.io"></a>ä½¿ç”¨ fly.io</h2><p>è¿™æ¬¡ä½¿ç”¨çš„æ˜¯Â <a href="https://fly.io/"><strong>fly.io</strong></a>Â çš„å…è´¹è®¡åˆ’ï¼Œfly.io æ˜¯ä¸€ä¸ª SAASï¼ˆæ˜¯ï¼ˆPlatform as a Serviceï¼‰çš„ç¼©å†™ï¼Œæ˜¯æŒ‡å¹³å°å³æœåŠ¡ï¼‰å¹³å°ï¼Œå¯ä»¥æ­å»ºå¦‚é™æ€åšå®¢ã€Nextjsã€Nuxtjsã€Denoã€Goã€Python ç­‰åº•å±‚çš„å„ç§å„æ ·çš„æœåŠ¡ã€‚ä½†é¦–å…ˆéœ€è¦è‡ªå·±æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥ä½¿ç”¨ Github ç™»å½•ã€‚<br><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/202303061259670.png"/></p><blockquote><p><strong>æ³¨æ„</strong>ï¼šfly.io çš„ä½¿ç”¨éœ€è¦ç»‘å¡ï¼Œå¦‚æœæ²¡æœ‰ç»‘å¡ä¼šåœ¨<a href="#%E5%88%9B%E5%BB%BA%E5%BA%94%E7%94%A8"><strong>åˆ›å»ºåº”ç”¨</strong></a>ç« èŠ‚å‡ºç°Â <strong>Error</strong>Â æç¤ºã€‚ç»‘å¡è¿‡ç¨‹è¯·åœ¨Â <a href="https://fly.io/dashboard"><strong>fly.io é¢æ¿</strong></a>ä¸­Â <strong>Billing</strong>Â è¿›è¡Œã€‚æ­£å¸¸ä½¿ç”¨å›½å†…çš„åŒå¸å¡å°±å¯ä»¥ï¼Œæ³¨æ„è¯·<strong>å¦‚å®</strong>å¡«å†™ä¿¡æ¯ã€‚æ²¡æœ‰å¡çš„æœ‹å‹å¯ä»¥å»å„é“¶è¡ŒåŠä¸€å¼ ï¼ˆè¶…å¥½è¿‡çš„ğŸ˜—ï¼‰æˆ–è¯•è¯•è™šæ‹Ÿå¡ï¼Ÿï¼ˆè™šæ‹Ÿå¡åªæ˜¯åšä¸»æƒ³åˆ°çš„ä¸€ç§æ–¹æ¡ˆï¼Œ<strong>æ²¡æœ‰</strong>è¯•è¿‡ï¼‰</p></blockquote><h3 id="å®‰è£…-flyctl"><a href="#å®‰è£…-flyctl" class="headerlink" title="å®‰è£… flyctl"></a>å®‰è£… flyctl</h3><p>Windows ç”¨æˆ·åœ¨æœ¬åœ°æ‰“å¼€ PowerShell æˆ– Windows ç»ˆç«¯ğŸ’»ï¼Œè¾“å…¥ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">iwr</span> https://fly.io/install.ps1 <span class="literal">-useb</span> | <span class="built_in">iex</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šCMD ä¸­ä¸æ”¯æŒä¸Šé¢çš„å‘½ä»¤ï¼Œå¦‚æœç”µè„‘ä¸­åªæœ‰ CMDï¼Œæˆ–è®¸ä½ éœ€è¦å®‰è£…Â <a href="https://github.com/PowerShell/PowerShell/releases"><strong>PowerShell</strong></a>ï¼ˆé€‰æ‹© latest ç‰ˆæœ¬ï¼‰æˆ–Â <a href="https://aka.ms/terminal"><strong>Windows ç»ˆç«¯</strong></a>ã€‚</p></blockquote><h3 id="æœ¬åœ°ç™»å½•"><a href="#æœ¬åœ°ç™»å½•" class="headerlink" title="æœ¬åœ°ç™»å½•"></a>æœ¬åœ°ç™»å½•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flyctl auth signup</span><br></pre></td></tr></table></figure><p>ä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨è¿›è¡ŒéªŒè¯è´¦æˆ·æ“ä½œã€‚</p><h3 id="åˆ›å»ºåº”ç”¨"><a href="#åˆ›å»ºåº”ç”¨" class="headerlink" title="åˆ›å»ºåº”ç”¨"></a>åˆ›å»ºåº”ç”¨</h3><p>åœ¨æœ¬åœ°ä»»æ„ä½ç½®åˆ›å»ºä¸€ä¸ª fly.io çš„å·¥ä½œç›®å½•ï¼ˆå…¶å®å°±æ˜¯åˆ›å»ºä¸ªèƒ½æ‰¾åˆ°çš„æ–‡ä»¶å¤¹ï¼Œä½ ä¸ä¼šæ”¾æ¡Œé¢ä¸Šäº†å§ğŸ˜‚ï¼Ÿï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> fly.io</span><br><span class="line"><span class="built_in">cd</span> fly.io</span><br><span class="line"><span class="built_in">mkdir</span> couchdb</span><br><span class="line"><span class="built_in">cd</span> couchdb</span><br></pre></td></tr></table></figure><p>è¿›å…¥ couchdb ç›®å½•åè¾“å…¥å‘½ä»¤ï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flyctl launch --image couchdb</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ­¥å°†ä¼šå¯åŠ¨ä¸€ä¸ªå‘å¯¼ï¼ŒæŒ‰è‡ªå·±çš„éœ€æ±‚è¿›è¡Œé€‰æ‹©ã€‚<br><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/202303061301932.png"/><br><strong>Select region</strong>Â çš„æ„æ€æ˜¯é€‰æ‹©ä¸€ä¸ªä½ç½®ï¼Œå°½é‡é€‰æ‹©<strong>é è¿‘</strong>è‡ªå·±çš„ä½ç½®ã€‚</p><h3 id="é…ç½®å·å¤§å°"><a href="#é…ç½®å·å¤§å°" class="headerlink" title="é…ç½®å·å¤§å°"></a>é…ç½®å·å¤§å°</h3><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/202303061301125.png"/>æˆ‘è¾“å…¥çš„é…ç½®å·å¤§å°å‘½ä»¤ä¸ºï¼š<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flyctl volumes create --region nrt couchdata --size <span class="number">1</span></span><br></pre></td></tr></table></figure><p><strong>nrt</strong>Â çš„æ„æ€æ˜¯ä¸œäº¬åœ°åŒºï¼Œä½ éœ€è¦æ”¹å˜ä¸ºå’Œ<a href="#%E5%88%9B%E5%BB%BA%E5%BA%94%E7%94%A8"><strong>ä¸Šé¢é€‰æ‹©çš„ä½ç½®åŒºåŸŸ</strong></a>ä¸€æ ·çš„ä½ç½®ä»£ç ã€‚è¿™ä¸€è¡Œå‘½ä»¤çš„æ„æ€æ˜¯ï¼šåœ¨ä¸œäº¬åœ°åŒºåˆ›å»ºä¸€ä¸ª 1G å¤§å°çš„å·ã€‚</p><h3 id="è°ƒæ•´é…ç½®ä¿¡æ¯"><a href="#è°ƒæ•´é…ç½®ä¿¡æ¯" class="headerlink" title="è°ƒæ•´é…ç½®ä¿¡æ¯"></a>è°ƒæ•´é…ç½®ä¿¡æ¯</h3><p>æ‰“å¼€åº”ç”¨æ ¹ç›®å½•çš„Â <code>fly.toml</code>Â æ–‡ä»¶ï¼Œæ·»åŠ æˆ–ä¿®æ”¹å¦‚ä¸‹ä¿¡æ¯ï¼š</p><blockquote><p>æ ¹ç›®å½•ä¸ºåœ¨<a href="#%E5%88%9B%E5%BB%BA%E5%BA%94%E7%94%A8"><strong>åˆ›å»ºåº”ç”¨</strong></a>ç« èŠ‚ä¸­åˆ›å»ºçš„æ–°æ–‡ä»¶å¤¹Â <strong>couchdb</strong></p></blockquote><p>åšä¸»æ˜¯å…¨éƒ¨é…ç½®å®Œæ¯•åå†™è¿™ç¯‡æ–‡ç« çš„ğŸ˜ï¼Œæ‰€æœ‰å¯èƒ½æœ‰é—æ¼æˆ–ä¸€äº›é”™è¯¯ï¼Ÿä¸ºäº†ä¿è¯ä¸¥è°¨æ€§ï¼ŒæŠŠè‡ªå·±çš„é…ç½®å…¨éƒ¨è´´ä¸€ä»½åšå¯¹ç…§å§ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># fly.toml file generated for couch-db on 2022-09-30T16:06:18+08:00</span></span><br><span class="line"></span><br><span class="line">app = <span class="string">&quot;couch-db&quot;</span></span><br><span class="line">kill_signal = <span class="string">&quot;SIGINT&quot;</span></span><br><span class="line">kill_timeout = 5</span><br><span class="line">processes = []</span><br><span class="line"></span><br><span class="line">[build]</span><br><span class="line">  image = <span class="string">&quot;couchdb:latest&quot;</span></span><br><span class="line"></span><br><span class="line">[<span class="built_in">env</span>]</span><br><span class="line">  COUCHDB_USER = <span class="string">&quot;yantao&quot;</span></span><br><span class="line"></span><br><span class="line">[mounts]</span><br><span class="line">  <span class="built_in">source</span>=<span class="string">&quot;couchdata&quot;</span></span><br><span class="line">  destination=<span class="string">&quot;/opt/couchdb/data&quot;</span></span><br><span class="line"></span><br><span class="line">[experimental]</span><br><span class="line">  allowed_public_ports = []</span><br><span class="line">  auto_rollback = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[[services]]</span><br><span class="line">  http_checks = []</span><br><span class="line">  internal_port = 5984</span><br><span class="line">  processes = [<span class="string">&quot;app&quot;</span>]</span><br><span class="line">  protocol = <span class="string">&quot;tcp&quot;</span></span><br><span class="line">  script_checks = []</span><br><span class="line">  [services.concurrency]</span><br><span class="line">    hard_limit = 25</span><br><span class="line">    soft_limit = 20</span><br><span class="line">    <span class="built_in">type</span> = <span class="string">&quot;connections&quot;</span></span><br><span class="line"></span><br><span class="line">  [[services.ports]]</span><br><span class="line">    force_https = <span class="literal">true</span></span><br><span class="line">    handlers = [<span class="string">&quot;http&quot;</span>]</span><br><span class="line">    port = 80</span><br><span class="line"></span><br><span class="line">  [[services.ports]]</span><br><span class="line">    handlers = [<span class="string">&quot;tls&quot;</span>, <span class="string">&quot;http&quot;</span>]</span><br><span class="line">    port = 443</span><br><span class="line"></span><br><span class="line">  [[services.ports]]</span><br><span class="line">    handlers = [<span class="string">&quot;tls&quot;</span>, <span class="string">&quot;http&quot;</span>]</span><br><span class="line">    port = 5984</span><br><span class="line"></span><br><span class="line">  [[services.tcp_checks]]</span><br><span class="line">    grace_period = <span class="string">&quot;1s&quot;</span></span><br><span class="line">    interval = <span class="string">&quot;15s&quot;</span></span><br><span class="line">    restart_limit = 0</span><br><span class="line">    <span class="built_in">timeout</span> = <span class="string">&quot;2s&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¯·å¯¹æ¯”ä¸Šé¢æä¾›çš„é…ç½®æ–‡ä»¶ä¿®æ”¹è‡ªå·±çš„Â <strong>fly.toml</strong>Â æ–‡ä»¶ã€‚</p><h3 id="è®¾ç½®å¯†ç "><a href="#è®¾ç½®å¯†ç " class="headerlink" title="è®¾ç½®å¯†ç "></a>è®¾ç½®å¯†ç </h3><p>åœ¨ç»ˆç«¯ä¸­è¾“å…¥å‘½ä»¤ï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flyctl secrets <span class="built_in">set</span> COUCHDB_PASSWORD=ä½ çš„å¯†ç </span><br></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„</strong>ï¼šå¯†ç ä½¿ç”¨å¤§å°å†™å­—æ¯ä¸æ•°å­—ï¼Œ<strong>ä¸è¦</strong>ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ã€‚å®é™…æµ‹è¯•åå‘ç°ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦æ—¶æ— æ³•è¯†åˆ«å¯†ç ï¼Œä¼šæ— æ³•ç™»å½•æ•°æ®åº“ã€‚</p></blockquote><p>å¦‚æœæƒ³è¦ä¿®æ”¹å¯†ç ï¼Œå¯ä»¥å†æ¬¡è¿è¡Œä¸Šé¢çš„å‘½ä»¤ã€‚</p><h3 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h3><blockquote><p>æ³¨æ„ï¼Œå¦‚æœæç¤ºÂ <strong>Services defined at indexes: 0 require a dedicated IP address. You currently have no dedicated IPs allocated. Please allocate at least one dedicated IP before deploying</strong>ï¼Œé‚£ä¹ˆéœ€è¦è¿è¡ŒÂ <code>fly ips allocate-v4</code>ã€‚</p></blockquote><p>åœ¨ç»ˆç«¯ä¸­è¾“å…¥å‘½ä»¤ï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flyctl deploy</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/202303061303907.png"/>ç¨ä½œç­‰å¾…åæç¤ºéƒ¨ç½²æˆåŠŸğŸ‰ã€‚ä½¿ç”¨ä¸‹é¢å‘½ä»¤å¯ä»¥æ‰“å¼€ç½‘é¡µç™»å½•ï¼š<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flyctl open</span><br></pre></td></tr></table></figure>å¦‚æœæ˜¯ fly.io éƒ¨ç½²ï¼Œé‚£ä¹ˆåœ¨ç½‘å€ååŠ Â `/_utils/#/setup`ï¼Œè·³è½¬åå¯ä»¥è¾“å…¥ç”¨æˆ·åä¸å¯†ç ã€‚ç½‘é¡µæˆåŠŸç™»å½•ï¼Œå¥½è€¶ğŸ‰<h2 id="ç½‘é¡µæ•°æ®åº“é…ç½®"><a href="#ç½‘é¡µæ•°æ®åº“é…ç½®" class="headerlink" title="ç½‘é¡µæ•°æ®åº“é…ç½®"></a>ç½‘é¡µæ•°æ®åº“é…ç½®</h2><p>è¿™ä¸€å¤§ç« èŠ‚éƒ½åœ¨ç½‘é¡µä¸­è¿›è¡Œã€‚å¦‚æœä¸çŸ¥é“è‡ªå·±çš„åœ°å€ï¼Œå¯ä»¥æ‰“å¼€Â <a href="https://fly.io/dashboard"><strong>fly.io é¢æ¿</strong></a>ï¼Œç‚¹å‡»è‡ªå·±çš„åº”ç”¨ï¼Œ<code>Hostname</code>Â å¤„ä¸ºè‡ªå·±åº”ç”¨çš„ç½‘å€ã€‚<br><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/202303061303825.png"/></p><h3 id="åˆ›å»ºæ•°æ®åº“"><a href="#åˆ›å»ºæ•°æ®åº“" class="headerlink" title="åˆ›å»ºæ•°æ®åº“"></a>åˆ›å»ºæ•°æ®åº“</h3><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/202303061304360.png"/><p>ç‚¹å‡»å³ä¸Šè§’çš„Â <code>Create Database</code>ï¼Œåˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œ<code>Database name</code>Â ä¸ºæ•°æ®åº“åå­—ï¼Œ<code>Partitioned</code>Â è¯·<strong>ä¸è¦</strong>å‹¾é€‰ï¼Œç„¶åç‚¹Â <code>Create</code>Â åˆ›å»ºã€‚</p><h3 id="é…ç½®å…¶ä»–ä¿¡æ¯"><a href="#é…ç½®å…¶ä»–ä¿¡æ¯" class="headerlink" title="é…ç½®å…¶ä»–ä¿¡æ¯"></a>é…ç½®å…¶ä»–ä¿¡æ¯</h3><p>æ‰“å¼€Â <code>Setup</code>Â é€‰é¡¹å¡ï¼Œå¡«å†™ç›¸å…³ä¿¡æ¯ã€‚<br><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/202303061304896.png"/></p><p>ç¬¬ä¸€è¡Œçš„Â <code>Specify your Admin credentials</code>Â ä¸ºä½ åœ¨ä¸Šé¢æ­¥éª¤ä¸­é…ç½®çš„ç”¨æˆ·ä¿¡æ¯ã€‚ç¬¬äºŒè¡Œçš„Â <code>Bind address the node will listen on</code>Â æ„æ€æ˜¯ç›‘å¬çš„è®¿é—®åœ°å€ï¼Œè®¾ç½®ä¸ºÂ <code>0.0.0.0</code>Â ä¸ºå…è®¸æ‰€æœ‰ ip è®¿é—®ã€‚ç¬¬ä¸‰è¡Œçš„Â <code>Port that the node will use</code>Â ä¸ºä½ åœ¨ <a href="#%E8%B0%83%E6%95%B4%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF"><strong>è°ƒæ•´é…ç½®ä¿¡æ¯</strong></a> è¿™ä¸€æ­¥ä¸­çš„Â <code>fly.toml</code>Â æ–‡ä»¶ä¸­é…ç½®çš„ç«¯å£ï¼Œå¦‚æœå’Œæˆ‘è®¾ç½®çš„ä¸€æ ·ï¼Œé‚£è¿™é‡Œåº”è¯¥æ˜¯Â <code>5984</code>ğŸ˜šã€‚è®¾ç½®å®Œæˆåä¼šæ˜¾ç¤ºÂ <code>Apache CouchDB is configured for production usage as a clustered node! Do you want to replicate data?</code>ï¼Œä»£è¡¨é…ç½®æˆåŠŸã€‚</p><h3 id="å¯ç”¨-CORS"><a href="#å¯ç”¨-CORS" class="headerlink" title="å¯ç”¨ CORS"></a>å¯ç”¨ CORS</h3><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/202303061304975.png"/><p>ç„¶åæ‰“å¼€Â <code>Configuration</code>Â é€‰é¡¹å¡ä¸­çš„Â <code>CORS</code>Â æ ‡ç­¾ï¼Œå¯ç”¨Â <strong>CORS</strong>ã€‚å®Œæˆç½‘é¡µç«¯æ“ä½œï¼</p><blockquote><p>ä¸‹æ–¹çš„Â <strong>Origin Domains</strong>Â éœ€è¦è®¾ç½®ä¸ºÂ <code>All domains</code>ã€‚</p></blockquote><h2 id="Obsidian-è®¾ç½®"><a href="#Obsidian-è®¾ç½®" class="headerlink" title="Obsidian è®¾ç½®"></a>Obsidian è®¾ç½®</h2><p>è¿™ä¸€ç« èŠ‚çš„æ“ä½œéƒ½åœ¨ Obsidian æœ¬ä½“è½¯ä»¶ä¸­è¿›è¡Œã€‚é¦–å…ˆéœ€è¦å…³é—­ Obsidian ä¸­çš„å®‰å…¨æ¨¡å¼ï¼Œåœ¨<strong>æ’ä»¶å¸‚åœº</strong>ä¸­æœç´¢Â <code>Self-hosted LiveSync</code>Â ä¸‹è½½å¹¶å¯ç”¨ã€‚åœ¨ Github ä»“åº“ä¸­æ‰‹åŠ¨ä¸‹è½½å®‰è£…æœ¬æ’ä»¶å¯èƒ½ä¼šå‡ºç°ä¸€äº›é—®é¢˜ã€‚</p><blockquote><p>åœ¨ç§»åŠ¨ç«¯å¯èƒ½ä¼š<strong>æ‰“ä¸å¼€</strong>æ’ä»¶å¸‚åœºï¼Œæ˜¯ä¼—æ‰€å‘¨çŸ¥çš„ç½‘ç»œåŸå› ï¼Œéœ€è¦è‡ªå·±è§£å†³ğŸ˜‘ã€‚</p></blockquote><h3 id="é…ç½®è¿æ¥ä¿¡æ¯"><a href="#é…ç½®è¿æ¥ä¿¡æ¯" class="headerlink" title="é…ç½®è¿æ¥ä¿¡æ¯"></a>é…ç½®è¿æ¥ä¿¡æ¯</h3><p>æ‰“å¼€Â <code>Remote Database configuration</code>Â é€‰é¡¹å¡ã€‚è¾“å…¥è‡ªå·±çš„æ•°æ®åº“ç½‘å€ã€ç”¨æˆ·åã€å¯†ç ä¸æ•°æ®åº“åã€‚</p><ol><li><strong>æ•°æ®åº“ç½‘å€ URI</strong>Â ä¸ºÂ <code>https://ä½ çš„åº”ç”¨.fly.dev</code>Â çš„å½¢å¼ï¼Œå¦‚æœæ‰¾ä¸åˆ°å¯ä»¥ä½¿ç”¨Â <code>flyctl open</code>Â æˆ–åœ¨Â <a href="https://fly.io/dashboard"><strong>fly.io é¢æ¿</strong></a>ä¸­æ‰“å¼€è‡ªå·±çš„åº”ç”¨æŸ¥çœ‹Â <strong>Hostname</strong>Â é¡¹ã€‚</li><li><strong>ç”¨æˆ·å</strong>ä¸<strong>å¯†ç </strong>ä¸ºåœ¨<a href="#%E8%B0%83%E6%95%B4%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF"><strong>è°ƒæ•´é…ç½®ä¿¡æ¯</strong></a>æ—¶å¡«å†™çš„ç”¨æˆ·åä¸åœ¨<a href="#%E8%AE%BE%E7%BD%AE%E5%AF%86%E7%A0%81"><strong>è®¾ç½®å¯†ç </strong></a>ä¸­ç”¨å‘½ä»¤è®¾ç½®çš„å¯†ç ã€‚</li><li><strong>æ•°æ®åº“å</strong>ä¸ºåœ¨<a href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><strong>åˆ›å»ºæ•°æ®åº“</strong></a>æ—¶åˆ›å»ºçš„æ•°æ®åº“åã€‚</li></ol><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/202303061305937.png"/>### ä¿®å¤è¿æ¥<p>ç‚¹å‡»Â <code>Test Database Connection</code>ï¼Œåœ¨å³ä¸Šè§’å‡ºç°Â <strong>Connect to æ•°æ®åº“å</strong>ï¼Œåˆ™ä¸ºè¿æ¥æˆåŠŸã€‚ç„¶åç‚¹å‡»Â <code>Check database configuration</code>ï¼Œä¼šå‡ºç°ä¸€å †æ—¥å¿—ï¼Œé€ä¸ªç‚¹å‡»åé¢çš„Â <code>fix</code>Â æŒ‰é’®ä¿®å¤å³å¯ã€‚</p><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/202303061305723.png"/><p>ä¿®å¤å®Œæˆåé‡æ–°ç‚¹å‡»Â <code>Check database configuration</code>ï¼Œæ²¡æœ‰å‡ºç°Â <code>fix</code>Â æŒ‰é’®å³ä¸ºä¿®å¤æˆåŠŸã€‚</p><h3 id="åŒæ­¥è®¾ç½®"><a href="#åŒæ­¥è®¾ç½®" class="headerlink" title="åŒæ­¥è®¾ç½®"></a>åŒæ­¥è®¾ç½®</h3><p>æ‰“å¼€Â <strong>Sync Settings</strong>Â é€‰é¡¹å¡ï¼Œå…¶ä¸­æœ‰æ‰€æœ‰çš„åŒæ­¥æ–¹å¼è®¾ç½®ã€‚<strong>æ³¨æ„</strong>ï¼šå®æ—¶åŒæ­¥ (LiveSync) ä¸å®šæ—¶åŒæ­¥ (Periodic Sync) äº’æ–¥ï¼Œæ— æ³•åŒæ—¶æ‰“å¼€ã€‚</p><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/202303061305828.png"/><p>å¯èƒ½æœ‰æœ‹å‹ä¼šçº ç»“ç”¨å“ªä¸ªï¼Œåœ¨è¿™é‡Œå¼ºçƒˆæ¨èä½¿ç”¨Â <strong>LiveSync</strong>ï¼ˆå®æ—¶åŒæ­¥ï¼‰æ–¹å¼ï¼Œæ¯•ç«Ÿç”¨æ­¤æ’ä»¶å°±æ˜¯ä¸ºäº†è¿™ä¸ªã€‚å› ä¸º Periodic Syncï¼ˆå®šæ—¶åŒæ­¥ï¼‰ä¸­åŒ…å«æœ‰ Sync on Save (ä¿å­˜æ—¶åŒæ­¥)ã€Sync on File Open (æ–‡ä»¶æ‰“å¼€æ—¶åŒæ­¥)ã€Sync on Start (æ‰“å¼€è½¯ä»¶æ—¶åŒæ­¥) å„ç§é€‰é¡¹ï¼Œåˆè®¡ä¸€ä¸‹å®Œå…¨å°±æ˜¯å˜ç›¸çš„å®æ—¶åŒæ­¥å˜›ï¼ç¬¬äºŒç‚¹æ˜¯å½“æˆ‘ä½¿ç”¨Â <code>hugo server</code>Â å¼€å¯æœ¬åœ°åšå®¢å˜æ›´ç›‘å¬åå‘ç°ï¼ŒObsidian ä¼šè‡ªåŠ¨åœ¨è¾“å…¥æ–‡å­—åä¿å­˜ä¸€æ¬¡ï¼Œé€ æˆ<strong>é¢‘ç¹</strong>çš„ Sync on Save (ä¿å­˜æ—¶åŒæ­¥) æ“ä½œã€‚æ‰€ä»¥ï¼Œè¿˜æ˜¯ä½¿ç”¨ LiveSyncï¼ˆå®æ—¶åŒæ­¥ï¼‰å§ğŸ‘ã€‚</p><h3 id="å…¶ä»–è®¾ç½®"><a href="#å…¶ä»–è®¾ç½®" class="headerlink" title="å…¶ä»–è®¾ç½®"></a>å…¶ä»–è®¾ç½®</h3><p>åœ¨Â <strong>Sync Settings</strong>Â é€‰é¡¹å¡ä¸­è¿˜åŒ…å«æœ‰Â <code>Use Trash for deleted files</code>ï¼ˆåˆ é™¤æ–‡ä»¶åˆ°å›æ”¶ç«™ï¼‰é…ç½®å¼ºçƒˆå»ºè®®æ‰“å¼€ï¼Œé˜²æ­¢æ–‡ä»¶æ„å¤–ä¸¢å¤±ã€‚</p><p>åœ¨Â <strong>Miscellaneous</strong>Â é€‰é¡¹å¡ï¼ˆä¸€ä¸ªå°æ‰³æ‰‹å›¾æ ‡ï¼‰ä¸­ï¼Œæœ‰é€‰é¡¹Â <code>Show staus inside editor</code>ï¼ˆåœ¨ç¼–è¾‘å™¨å³ä¸Šè§’æ˜¾ç¤ºå½“å‰åŒæ­¥çŠ¶æ€ï¼‰ï¼Œæ¨èæ‰“å¼€ã€‚</p><p>åŒæ­¥çŠ¶æ€å°†æ˜¾ç¤ºåœ¨çŠ¶æ€æ ï¼ŒçŠ¶æ€éƒ½æœ‰ï¼š</p><ul><li>â¹ï¸Â å‡†å¤‡å°±ç»ª</li><li>ğŸ’¤Â LiveSync å·²å¯ç”¨ï¼Œæ­£åœ¨ç­‰å¾…æ›´æ”¹</li><li>âš¡ï¸Â åŒæ­¥ä¸­</li><li>âš ï¸Â å‡ºç°é”™è¯¯</li></ul><p>ä¿¡æ¯è§£é‡Šï¼š</p><ul><li>â†‘ ä¸Šä¼ çš„ chunk å’Œå…ƒæ•°æ®æ•°é‡</li><li>â†“ ä¸‹è½½çš„ chunk å’Œå…ƒæ•°æ®æ•°é‡</li><li>â³Â ç­‰å¾…çš„è¿‡ç¨‹çš„æ•°é‡</li><li>ğŸ§©Â æ­£åœ¨ç­‰å¾… chunk çš„æ–‡ä»¶æ•°é‡ å¦‚æœä½ åˆ é™¤æˆ–ä¿®æ”¹äº†æ–‡ä»¶åç§°ï¼Œè¯·ç­‰å¾…Â â³Â å›¾æ ‡æ¶ˆå¤±ã€‚</li></ul><h3 id="å®‰è£…äºå…¶ä»–è®¾å¤‡"><a href="#å®‰è£…äºå…¶ä»–è®¾å¤‡" class="headerlink" title="å®‰è£…äºå…¶ä»–è®¾å¤‡"></a>å®‰è£…äºå…¶ä»–è®¾å¤‡</h3><p>åœ¨æ’ä»¶Â <strong>Setup wizard</strong>Â é€‰é¡¹å¡ä¸­ï¼Œç‚¹å‡»Â <code>Copy Setup URI</code>ï¼Œå¼¹å‡ºçš„å¯¹è¯æ¡†è¾“å…¥ä½ çš„æ•°æ®åº“å¯†ç ï¼Œå³å¯å¤åˆ¶å½“å‰çš„é…ç½®ä¿¡æ¯ã€‚åœ¨å…¶ä»–å¦‚ Androidã€iOS è®¾å¤‡ä¸Šå®‰è£…æ­¤æ’ä»¶å¹¶ç‚¹å‡»Â <code>Open Setup URI</code>Â è¾“å…¥å¤åˆ¶çš„é“¾æ¥å³å¯ã€‚<br><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/202303061306999.png"/></p><p>åœ¨è¿™é‡Œé€‰ç¬¬ä¸€ä¸ªï¼Œæ„æ€ä¸º<strong>å°†æ­¤è®¾å¤‡è®¾ç½®ä¸ºè¾…åŠ©æˆ–åç»­è®¾å¤‡</strong>ã€‚ç¨ç­‰ä¸€ä¼šå„¿åå³å¯åŒæ­¥å®Œæˆã€‚è€Œä¸”åŒæ­¥éå¸¸å¿«ï¼Œåªéœ€è¦å‡ ç§’é’Ÿå°±å¥½ã€‚</p><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/202303061306269.png"/><p>è¿™é‡Œæ”¾ä¸€å¼ å®˜ç½‘çš„åŒæ­¥åŠ¨æ€å›¾å¯ä»¥æ„Ÿå—ä¸€ä¸‹ã€‚</p><h2 id="æ¨èæ–¹æ¡ˆ"><a href="#æ¨èæ–¹æ¡ˆ" class="headerlink" title="æ¨èæ–¹æ¡ˆ"></a>æ¨èæ–¹æ¡ˆ</h2><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<strong>ä¸åº”è¯¥</strong>åœ¨ Obsidian ä¸­å­˜æ”¾å¤ªå¤šåª’ä½“æ–‡ä»¶ï¼Œå¦‚ï¼šMarkdown æ–‡ä»¶ç›´æ¥å¼•ç”¨æœ¬åœ°å›¾ç‰‡æˆ–éŸ³é¢‘ã€‚ä¸ç„¶ä¼šæ˜¾è‘—æ‹–æ…¢<strong>ä»»ä½•</strong>Â WebDAV æˆ– LiveSync çš„åŒæ­¥é€Ÿåº¦ã€‚åšä¸€ä¸ªå¯¹æ¯”ï¼Œæˆ‘çš„ Obsidian ä¸­å¤§æ¦‚æœ‰ 80 ç¯‡å·¦å³ç¬”è®°ä¸åšæ–‡ï¼Œæœ¬åœ°æºæ–‡ä»¶åªæœ‰ 600KBï¼Œæ•°æ®åº“å ç”¨åªæœ‰ 2MB å·¦å³ã€‚å¦‚æœä½¿ç”¨æœ¬åœ°å¼•ç”¨å›¾ç‰‡ï¼Œé‚£ä¹ˆä¸€å¼ å›¾ç‰‡å°±èƒ½æŠµå¾—ä¸Šæˆ‘å…¨éƒ¨ç¬”è®°çš„å¤§å°ï¼ŒåŒæ­¥æ—¶é—´å°†æˆå€çš„å¢é•¿ğŸ™„ã€‚æ‰€ä»¥ï¼Œè¿™äº›åª’ä½“æ–‡ä»¶<strong>æ›´åº”è¯¥æ”¾å…¥å›¾åºŠæˆ–å¯¹è±¡å­˜å‚¨ä¸­</strong>ï¼Œä½¿ç”¨Â <code>![]()</code>Â çš„å½¢å¼å¼•ç”¨ã€‚</p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>fly.io éƒ¨ç½²çš„æœåŠ¡ä½“éªŒå¤ªå¥½äº†ğŸ’–ã€‚Obsidian å„ç«¯åŒæ­¥èµ·æ¥éå¸¸å¿«ï¼Œè™½ç„¶çœ‹é¢æ¿åªæ˜¯ä¸€ä¸ª 256MB çš„å°æœºå™¨ï¼Œä½†æ˜¯è¿™ä¸ªä»»åŠ¡å®Œå…¨å¯ä»¥èƒœä»»ã€‚fly.io æ¯ä¸ªè´¦æˆ·çš„å…è´¹èµ„æºåŒ…æ‹¬ï¼šæ€»å…± 3GB çš„å·ã€æœ€å¤š 3 ä¸ªå…±äº« CPU-1x 256MB è™šæ‹Ÿæœºã€æ¯æœˆ 160GB å‡ºç«™æ•°æ®ä¼ è¾“ã€‚çœ‹èµ·æ¥è¿˜èƒ½åšä¸€äº›æ–°ç©æ³•çš„æ ·å­ã€‚åœ¨å¯¹æ¯”ä½¿ç”¨ Remotely save åŒæ­¥åå‘ç°ï¼ŒåŒæ­¥é€Ÿåº¦é™¤äº†å¿«å°±æ˜¯å¿«ï¼Œåˆšåœ¨ç”µè„‘ä¸Šå†™å®Œä¸€å¥è¯ï¼Œæƒ³èµ·æœ‰äº‹æƒ…å‡†å¤‡èµ°ï¼Œæ‹¿èµ·æ‰‹æœºæ‰“å¼€ Obsidianï¼Œå®Œå…¨å¯ä»¥æ¥ç€ç»§ç»­ç¼–è¾‘ï¼Œæ— ç¼åŒæ­¥çš„ä½“éªŒçœŸæ˜¯å¤ªæ£’äº†ï¼æˆ‘å®£å¸ƒè¿™æ˜¯ Obsidian éå®˜æ–¹åŒæ­¥æœåŠ¡çš„<strong>æœ€ä½³æ–¹å¼</strong>ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Obsidian </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenWrtå¤šæ‹¨ä½¿ç”¨æ•™ç¨‹</title>
      <link href="/2023/02/28/OpenWrt%E5%A4%9A%E6%8B%A8%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/"/>
      <url>/2023/02/28/OpenWrt%E5%A4%9A%E6%8B%A8%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="å¤šæ‹¨ç±»"><a href="#å¤šæ‹¨ç±»" class="headerlink" title="å¤šæ‹¨ç±»"></a>å¤šæ‹¨ç±»</h1><p>å¤šæ‹¨ç›¸å…³çš„æ’ä»¶ä¸»è¦æ˜¯Â <strong>å¤šçº¿å¤šæ‹¨</strong>Â å’ŒÂ <strong>è´Ÿè½½å‡è¡¡</strong>Â æ’ä»¶ã€‚</p><span id="more"></span><h2 id="Syncdial-å¤šçº¿å¤šæ‹¨"><a href="#Syncdial-å¤šçº¿å¤šæ‹¨" class="headerlink" title="SyncdialÂ å¤šçº¿å¤šæ‹¨"></a>SyncdialÂ <strong>å¤šçº¿å¤šæ‹¨</strong></h2><p>ä½¿ç”¨macvlané©±åŠ¨åˆ›å»ºå¤šä¸ªè™šæ‹ŸWANå£ï¼Œæ”¯æŒå¹¶å‘å¤šæ‹¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opkg install luci-app-syncdial</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/202302281925038.png"/><h2 id="MWAN3è´Ÿè½½å‡è¡¡"><a href="#MWAN3è´Ÿè½½å‡è¡¡" class="headerlink" title="MWAN3è´Ÿè½½å‡è¡¡"></a>MWAN3è´Ÿè½½å‡è¡¡</h2><p>æ”¯æŒå¤šæ ¹ç½‘çº¿æˆ–è€…å¤šä¸ªPPPOEè´¦å·çš„åŒæ—¶æ‹¨å·ä½¿ç”¨å’Œè´Ÿè½½å‡è¡¡ã€‚å¹¶ä¸”è¿˜å¯ä»¥é€šè¿‡Pingæ–¹å¼æ¥æ£€æµ‹ä¸­æ–­çº¿è·¯å¹¶è‡ªåŠ¨å±è”½ä¸­æ–­çº¿è·¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opkg install luci-i18n-mwan3-zh-cn</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/202302281926379.png"/><h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><p>å¦‚å‘ç°æ— æ³•å®‰è£…æˆ–æ›´æ–°ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œ</p><h2 id="æ›´æ–°OPKGè½¯ä»¶åˆ—è¡¨"><a href="#æ›´æ–°OPKGè½¯ä»¶åˆ—è¡¨" class="headerlink" title="æ›´æ–°OPKGè½¯ä»¶åˆ—è¡¨"></a>æ›´æ–°OPKGè½¯ä»¶åˆ—è¡¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opkg update</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> openwrt </tag>
            
            <tag> å¤šæ‹¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python ChatGPT Telegram Bot</title>
      <link href="/2023/02/21/Python%20ChatGPT%20Telegram%20Bot/"/>
      <url>/2023/02/21/Python%20ChatGPT%20Telegram%20Bot/</url>
      
        <content type="html"><![CDATA[<h1 id="æ³¨å†Œ"><a href="#æ³¨å†Œ" class="headerlink" title="æ³¨å†Œ"></a>æ³¨å†Œ</h1><p>è¿™é‡Œå¦‚ä½•æ³¨å†Œæˆ‘å°±ä¸è¯´æ˜äº†ï¼Œå¤§å®¶è‡ªè¡Œå»æ³¨å†Œï¼Œä¸»è¦æ˜¯ç°åœ¨GPTçš„åŸºæœ¬ä¸Šå·²ç»å¤‡ç”¨å¾ˆå¤šäº†ï¼Œå¯¼è‡´äº†æ¥ç çš„ä»·æ ¼ä¹Ÿä¸Šæ¶¨äº†ï¼Œè€Œä¸”ä½¿ç”¨tokençš„è¯ï¼Œå…¶å®è¿˜æ˜¯å¾ˆå¿«å¯ä»¥ç”¨å®Œå…è´¹çš„18ç¾é‡‘ï¼›<br>æ¥ç ï¼š<a href="https://sms-activate.org/">https://sms-activate.org/</a></p><h1 id="å‡†å¤‡ææ–™"><a href="#å‡†å¤‡ææ–™" class="headerlink" title="å‡†å¤‡ææ–™"></a>å‡†å¤‡ææ–™</h1><p>ä¸»è¦æä¾›ä¸‹Pythonçš„å®ç°ä»£ç ï¼Œé¦–å…ˆéœ€è¦å‡†å¤‡ä¸€ä¸‹çš„ä¸œè¥¿ï¼š</p><ul><li>Telegram Bot çš„ Key ï¼šæ‰¾æœºå™¨äººçˆ¸çˆ¸è·å–</li><li>ChatGPT çš„ API Key  ï¼š <a href="https://platform.openai.com/account/api-keys">https://platform.openai.com/account/api-keys</a><span id="more"></span></li></ul><h1 id="è„šæœ¬ï¼š"><a href="#è„šæœ¬ï¼š" class="headerlink" title="è„šæœ¬ï¼š"></a>è„šæœ¬ï¼š</h1><figure class="highlight python"><figcaption><span>main.py >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. Start by importing the necessary libraries and setting up the API clients  </span></span><br><span class="line"><span class="keyword">import</span> requests  </span><br><span class="line"><span class="keyword">import</span> json  </span><br><span class="line"><span class="keyword">import</span> os  </span><br><span class="line"><span class="keyword">import</span> threading  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># OpenAI secret Key  </span></span><br><span class="line">API_KEY = <span class="string">&#x27;xxxxxxxxx&#x27;</span>  </span><br><span class="line"><span class="comment"># Models: text-davinci-003,text-curie-001,text-babbage-001,text-ada-001  </span></span><br><span class="line">MODEL = <span class="string">&#x27;text-davinci-003&#x27;</span>  </span><br><span class="line"><span class="comment"># Telegram secret access bot token  </span></span><br><span class="line">BOT_TOKEN = <span class="string">&#x27;xxxxxxxxxxxxx&#x27;</span>  </span><br><span class="line"><span class="comment"># Defining the bot&#x27;s personality using adjectives  </span></span><br><span class="line">BOT_PERSONALITY = <span class="string">&#x27;&#x27;</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 2a. Function that gets the response from OpenAI&#x27;s chatbot  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">openAI</span>(<span class="params">prompt</span>):  </span><br><span class="line">    <span class="comment"># Make the request to the OpenAI API  </span></span><br><span class="line">    response = requests.post(  </span><br><span class="line">        <span class="string">&#x27;https://api.openai.com/v1/completions&#x27;</span>,  </span><br><span class="line">        headers=&#123;<span class="string">&#x27;Authorization&#x27;</span>: <span class="string">f&#x27;Bearer <span class="subst">&#123;API_KEY&#125;</span>&#x27;</span>&#125;,  </span><br><span class="line">        json=&#123;<span class="string">&#x27;model&#x27;</span>: MODEL, <span class="string">&#x27;prompt&#x27;</span>: prompt, <span class="string">&#x27;temperature&#x27;</span>: <span class="number">0.4</span>, <span class="string">&#x27;max_tokens&#x27;</span>: <span class="number">4000</span>&#125;  </span><br><span class="line">    )  </span><br><span class="line">  </span><br><span class="line">    result = response.json()  </span><br><span class="line">    <span class="built_in">print</span>(result)  </span><br><span class="line">    final_result = <span class="string">&#x27;&#x27;</span>.join(choice[<span class="string">&#x27;text&#x27;</span>] <span class="keyword">for</span> choice <span class="keyword">in</span> result[<span class="string">&#x27;choices&#x27;</span>])  </span><br><span class="line">    <span class="keyword">return</span> final_result  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 2b. Function that gets an Image from OpenAI  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">openAImage</span>(<span class="params">prompt</span>):  </span><br><span class="line">    <span class="comment"># Make the request to the OpenAI API  </span></span><br><span class="line">    resp = requests.post(  </span><br><span class="line">        <span class="string">&#x27;https://api.openai.com/v1/images/generations&#x27;</span>,  </span><br><span class="line">        headers=&#123;<span class="string">&#x27;Authorization&#x27;</span>: <span class="string">f&#x27;Bearer <span class="subst">&#123;API_KEY&#125;</span>&#x27;</span>&#125;,  </span><br><span class="line">        json=&#123;<span class="string">&#x27;prompt&#x27;</span>: prompt, <span class="string">&#x27;n&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;size&#x27;</span>: <span class="string">&#x27;1024x1024&#x27;</span>&#125;  </span><br><span class="line">    )  </span><br><span class="line">    response_text = json.loads(resp.text)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> response_text[<span class="string">&#x27;data&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;url&#x27;</span>]  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 3a. Function that sends a message to a specific telegram group  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">telegram_bot_sendtext</span>(<span class="params">bot_message, chat_id, msg_id</span>):  </span><br><span class="line">    data = &#123;  </span><br><span class="line">        <span class="string">&#x27;chat_id&#x27;</span>: chat_id,  </span><br><span class="line">        <span class="string">&#x27;text&#x27;</span>: bot_message,  </span><br><span class="line">        <span class="string">&#x27;reply_to_message_id&#x27;</span>: msg_id  </span><br><span class="line">    &#125;  </span><br><span class="line">    response = requests.post(  </span><br><span class="line">        <span class="string">&#x27;https://api.telegram.org/bot&#x27;</span> + BOT_TOKEN + <span class="string">&#x27;/sendMessage&#x27;</span>,  </span><br><span class="line">        json=data  </span><br><span class="line">    )  </span><br><span class="line">    <span class="keyword">return</span> response.json()  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 3b. Function that sends an image to a specific telegram group  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">telegram_bot_sendimage</span>(<span class="params">image_url, group_id, msg_id</span>):  </span><br><span class="line">    data = &#123;  </span><br><span class="line">        <span class="string">&#x27;chat_id&#x27;</span>: group_id,  </span><br><span class="line">        <span class="string">&#x27;photo&#x27;</span>: image_url,  </span><br><span class="line">        <span class="string">&#x27;reply_to_message_id&#x27;</span>: msg_id  </span><br><span class="line">    &#125;  </span><br><span class="line">    url = <span class="string">&#x27;https://api.telegram.org/bot&#x27;</span> + BOT_TOKEN + <span class="string">&#x27;/sendPhoto&#x27;</span>  </span><br><span class="line">  </span><br><span class="line">    response = requests.post(url, data=data)  </span><br><span class="line">    <span class="keyword">return</span> response.json()  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 4. Function that retrieves the latest requests from users in a Telegram group,  </span></span><br><span class="line"><span class="comment"># generates a response using OpenAI, and sends the response back to the group.  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Chatbot</span>():  </span><br><span class="line">    <span class="comment"># Retrieve last ID message from text file for ChatGPT update  </span></span><br><span class="line">    cwd = os.getcwd()  </span><br><span class="line">    filename = cwd + <span class="string">&#x27;/chatgpt.txt&#x27;</span>  </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(filename):  </span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">            f.write(<span class="string">&quot;1&quot;</span>)  </span><br><span class="line">    <span class="keyword">else</span>:  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;File Exists&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename) <span class="keyword">as</span> f:  </span><br><span class="line">        last_update = f.read()  </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># Check for new messages in Telegram group  </span></span><br><span class="line">    url = <span class="string">f&#x27;https://api.telegram.org/bot<span class="subst">&#123;BOT_TOKEN&#125;</span>/getUpdates?offset=<span class="subst">&#123;last_update&#125;</span>&#x27;</span>  </span><br><span class="line">    response = requests.get(url)  </span><br><span class="line">    data = json.loads(response.content)  </span><br><span class="line">    <span class="keyword">for</span> result <span class="keyword">in</span> data[<span class="string">&#x27;result&#x27;</span>]:  </span><br><span class="line">        <span class="keyword">try</span>:  </span><br><span class="line">            <span class="comment"># Checking for new message  </span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">float</span>(result[<span class="string">&#x27;update_id&#x27;</span>]) &gt; <span class="built_in">float</span>(last_update):  </span><br><span class="line">                <span class="comment"># Checking for new messages that did not come from chatGPT  </span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> result[<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;from&#x27;</span>][<span class="string">&#x27;is_bot&#x27;</span>]:  </span><br><span class="line">                    last_update = <span class="built_in">str</span>(<span class="built_in">int</span>(result[<span class="string">&#x27;update_id&#x27;</span>]))  </span><br><span class="line">  </span><br><span class="line">                    <span class="comment"># Retrieving message ID of the sender of the request  </span></span><br><span class="line">                    msg_id = <span class="built_in">str</span>(<span class="built_in">int</span>(result[<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;message_id&#x27;</span>]))  </span><br><span class="line">  </span><br><span class="line">                    <span class="comment"># Retrieving the chat ID  </span></span><br><span class="line">                    chat_id = <span class="built_in">str</span>(result[<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;chat&#x27;</span>][<span class="string">&#x27;id&#x27;</span>])  </span><br><span class="line">  </span><br><span class="line">                    <span class="comment"># Checking if user wants an image  </span></span><br><span class="line">                    <span class="keyword">if</span> <span class="string">&#x27;/img&#x27;</span> <span class="keyword">in</span> result[<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;text&#x27;</span>]:  </span><br><span class="line">                        prompt = result[<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;text&#x27;</span>].replace(<span class="string">&quot;/img&quot;</span>, <span class="string">&quot;&quot;</span>)  </span><br><span class="line">                        bot_response = openAImage(prompt)  </span><br><span class="line">                        <span class="built_in">print</span>(telegram_bot_sendimage(bot_response, chat_id, msg_id))  </span><br><span class="line">                    <span class="comment"># Checking that user mentionned chatbot&#x27;s username in message  </span></span><br><span class="line">                    <span class="keyword">if</span> <span class="string">&#x27;@chatGpt_dandelion_bot&#x27;</span> <span class="keyword">in</span> result[<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;text&#x27;</span>] \  </span><br><span class="line">                            <span class="keyword">or</span> <span class="string">&#x27;/ask&#x27;</span> <span class="keyword">in</span> result[<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;text&#x27;</span>]:  </span><br><span class="line">                        prompt = result[<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;text&#x27;</span>].replace(<span class="string">&quot;@chatGpt_dandelion_bot&quot;</span>, <span class="string">&quot;&quot;</span>)  </span><br><span class="line">                        <span class="comment"># Calling OpenAI API using the bot&#x27;s personality  </span></span><br><span class="line">                        bot_response = openAI(<span class="string">f&quot;<span class="subst">&#123;BOT_PERSONALITY&#125;</span><span class="subst">&#123;prompt&#125;</span>&quot;</span>)  </span><br><span class="line">                        <span class="comment"># Sending back response to telegram group  </span></span><br><span class="line">                        <span class="built_in">print</span>(telegram_bot_sendtext(bot_response, chat_id, msg_id))  </span><br><span class="line">                    <span class="comment"># Verifying that the user is responding to the ChatGPT bot  </span></span><br><span class="line">                    <span class="keyword">if</span> <span class="string">&#x27;reply_to_message&#x27;</span> <span class="keyword">in</span> result[<span class="string">&#x27;message&#x27;</span>]:  </span><br><span class="line">                        <span class="keyword">if</span> result[<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;reply_to_message&#x27;</span>][<span class="string">&#x27;from&#x27;</span>][<span class="string">&#x27;is_bot&#x27;</span>]:  </span><br><span class="line">                            prompt = result[<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;text&#x27;</span>]  </span><br><span class="line">                            bot_response = openAI(<span class="string">f&quot;<span class="subst">&#123;BOT_PERSONALITY&#125;</span><span class="subst">&#123;prompt&#125;</span>&quot;</span>)  </span><br><span class="line">                            <span class="built_in">print</span>(telegram_bot_sendtext(bot_response, chat_id, msg_id))  </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:  </span><br><span class="line">            <span class="built_in">print</span>(e)  </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># Updating file with last update ID  </span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">        f.write(last_update)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;done&quot;</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 5 Running a check every 5 seconds to check for new messages  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():  </span><br><span class="line">    timertime = <span class="number">5</span>  </span><br><span class="line">    Chatbot()  </span><br><span class="line">    <span class="comment"># 5 sec timer  </span></span><br><span class="line">    threading.Timer(timertime, main).start()  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Run the main function  </span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> chatgpt </tag>
            
            <tag> gpt </tag>
            
            <tag> telegram </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>curl æ£€æµ‹ä»£ç†çš„å¯ç”¨æ€§ä»¥åŠå»¶è¿Ÿ</title>
      <link href="/2023/02/20/curl%20%E6%A3%80%E6%B5%8B%E4%BB%A3%E7%90%86%E7%9A%84%E5%8F%AF%E7%94%A8%E6%80%A7%E4%BB%A5%E5%8F%8A%E5%BB%B6%E8%BF%9F/"/>
      <url>/2023/02/20/curl%20%E6%A3%80%E6%B5%8B%E4%BB%A3%E7%90%86%E7%9A%84%E5%8F%AF%E7%94%A8%E6%80%A7%E4%BB%A5%E5%8F%8A%E5%BB%B6%E8%BF%9F/</url>
      
        <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>åœ¨åŠå…¬ç½‘çš„ä»£ç†ç¿»å¢™çš„è¿‡ç¨‹ä¸­ï¼Œç»å¸¸æ²¡åŠæ³•ç¬¬ä¸€æ—¶é—´çŸ¥é“ä»£ç†å¤±æ•ˆäº†ï¼Œå› ä¸ºæˆ‘ä»¬è‡ªèº«ä¸æ˜¯é«˜ç”¨çš„ç”¨æˆ·ï¼Œæ¯æ¬¡æŒ‚äº†éƒ½éœ€è¦å‘˜å·¥æ¥åé¦ˆï¼Œä½“æ„Ÿéå¸¸çš„ä¸å¥½ï¼Œå› æ­¤æƒ³ç€å¯ä»¥é€šè¿‡<code>zabbix</code>å¦‚æœæŠŠå½“å‰çš„å»¶è¿Ÿã€å¯ç”¨æ€§æ£€æµ‹èµ·æ¥</p><span id="more"></span><h1 id="é€šè¿‡Curl-æ£€æµ‹Googleçš„å»¶è¿Ÿ"><a href="#é€šè¿‡Curl-æ£€æµ‹Googleçš„å»¶è¿Ÿ" class="headerlink" title="é€šè¿‡Curl æ£€æµ‹Googleçš„å»¶è¿Ÿ"></a>é€šè¿‡Curl æ£€æµ‹Googleçš„å»¶è¿Ÿ</h1><p>è¿™é‡Œä¸ºå•¥æ˜¯curlè€Œä¸æ˜¯pingï¼Œå› ä¸ºé»˜è®¤pingäº‹ä¸æ”¯æŒä»£ç†çš„ï¼Œç„¶è€Œcurlä¹Ÿå¯ä»¥åšåˆ°çœŸæ­£çš„æ˜¯å¦å¯ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o /dev/null -x socks5h://127.0.0.1:12126 -s --connect-timeout 5 -w %&#123;time_starttransfer&#125;<span class="string">&quot;\n&quot;</span> <span class="variable">$1</span></span><br></pre></td></tr></table></figure><p><code>socks5h</code>çš„åœ°å€éœ€è¦æ”¹æˆä½ çš„ä»£ç†åœ°å€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–å½“å‰ä»£ç†çš„å¯ç”¨æ€§</span></span><br><span class="line">```bash</span><br><span class="line">url=<span class="variable">$1</span></span><br><span class="line">result=($(curl -x socks5h://localhost:12126 -I -s --connect-timeout 5 <span class="variable">$&#123;url&#125;</span> | <span class="built_in">head</span> -1 | <span class="built_in">tr</span> <span class="string">&quot;\r&quot;</span> <span class="string">&quot;\n&quot;</span>))</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;result[1]&#125;</span>&quot;</span> == <span class="variable">$2</span> -a <span class="string">&quot;<span class="variable">$&#123;result[2]&#125;</span>&quot;</span> == <span class="string">&#x27;OK&#x27;</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> 1</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h1 id="zabbixæ“ä½œè„šæœ¬"><a href="#zabbixæ“ä½œè„šæœ¬" class="headerlink" title="zabbixæ“ä½œè„šæœ¬"></a>zabbixæ“ä½œè„šæœ¬</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å»¶è¿Ÿ</span></span><br><span class="line">UserParameter=googleTime[*],/etc/zabbix/script/googleTime.sh <span class="variable">$1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ç”¨</span></span><br><span class="line">UserParameter=googleCheck[*],/etc/zabbix/script/googleCheck.sh <span class="variable">$1</span> <span class="variable">$2</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> zabbix </tag>
            
            <tag> curl </tag>
            
            <tag> ä»£ç† </tag>
            
            <tag> æ£€æµ‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°å½•ä¸€æ¬¡åŠå…¬ç½‘å…¨çƒåŒ–çš„æ”¹é€ è®¡åˆ’</title>
      <link href="/2023/02/17/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E5%8A%9E%E5%85%AC%E7%BD%91Panabit%E5%85%A8%E7%90%83%E5%8C%96%E7%9A%84%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/"/>
      <url>/2023/02/17/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E5%8A%9E%E5%85%AC%E7%BD%91Panabit%E5%85%A8%E7%90%83%E5%8C%96%E7%9A%84%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/</url>
      
        <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>åŠå…¬ç½‘æ¯æ¬¡å»æµ·å¤–æ‰¾èµ„æ–™éƒ½éœ€è¦é‡æ–°è¿æ¥VPNï¼Œæˆ–è€…è‡ªå·±è¿æ¥è‡ªå·±ä¹°çš„å°é£æœºä¹‹ç±»çš„æ‰å¯ä»¥ã€‚ä½†æ˜¯è¿™ç§åœ¨äº’è”ç½‘å…¬å¸å†…çš„è¯ï¼Œéå¸¸çš„ä¸å‹å¥½ï¼›ä¸ºå…¬å¸å·¥ä½œè¿˜è¦è‡ªå·±èŠ±é’±ä¹°å°é£æœºï½</p><p>ä¹‹å‰å°è¯•è¿‡ä¸‹é¢è¿™ç§æ–¹å¼ï¼š<br>æ–°å¢ä¸€å°æµ·å¤–çš„æœºå™¨ï¼ˆæ–°åŠ å¡ã€é¦™æ¸¯ï¼‰æ­å»ºSS&#x2F;v2ray&#x2F;trojanä¹‹ç±»çš„åè®®ï¼Œç„¶ååŠå…¬ç½‘æ–°å¢ä¸€ä¸ªè½¯è·¯ç”±å»è¿æ¥ï¼Œé€šè¿‡ACLæŠŠéƒ¨åˆ†IPçš„ç”¨æˆ·è·³è½¬è¿‡å»ï¼›<br>ä½†æ˜¯è¿™ç§æ–¹å¼è‡ªå·±å®¶é‡Œç”¨ç”¨è¿˜è¡Œï¼Œå¦‚æœæƒ³è¦åœ¨ä¼ä¸šçš„åŠå…¬ç½‘æ¥ä½¿ç”¨çš„è¯ï¼Œäººä¸€å¤šå°±ä¸è¡Œï¼Œå› ä¸ºæ‰€æœ‰äººéƒ½ä»è¿™ä¸ªIPå‡ºå»äº†ï¼Œè€Œä¸”æ¯æ¬¡éƒ½éœ€è¦å‘½ä»¤è¡Œå»æ“ä½œACLå¢åŠ ç”¨æˆ·ï¼Œéå¸¸çš„éº»çƒ¦ï¼›</p><span id="more"></span><h1 id="åè¯ä»‹ç»"><a href="#åè¯ä»‹ç»" class="headerlink" title="åè¯ä»‹ç»"></a>åè¯ä»‹ç»</h1><table><thead><tr><th>åè¯</th><th>ä»‹ç»</th></tr></thead><tbody><tr><td>Panabit</td><td>Panabitæ˜¯å›½å†…X86å¹³å°å•æ¿å¤„ç†èƒ½åŠ›æœ€é«˜ï¼ˆåŒå‘40Gï¼‰ã€åœ¨è¿è¥å•†å’Œé«˜æ ¡ç­‰è¡Œä¸šæ¡ˆä¾‹è¿‡åƒï¼ˆXè¿è¥å•†åƒå…†ä»¥ä¸Šè§„æ ¼å…±è®¡400ä½™å°å·²æ™®éè¿ç»­ç¨³å®šè¿è¡Œè‡³ç¬¬7å¹´ï¼‰ï¼Œå®æ—¶å¯¹è¶…è¿‡3TBçš„ç½‘ç»œå¸¦å®½è¿›è¡ŒDPIè¯†åˆ«ä¸ä¼˜åŒ–æœåŠ¡ã€å¹¶é’ˆå¯¹ä¸­å°ä¼ä¸šæä¾›å…è´¹ç‰ˆæœ¬ï¼ˆè½¯ä»¶å½¢æ€ï¼‰ï¼Œæ˜¯ä»¥DPIä¸ºæ ¸å¿ƒä¼˜åŠ¿å¹¶å‘å±•èµ·æ¥çš„ä¸“ä¸šã€ä¸Šçº¿æ•ˆæœå¥½ã€æ€§ä»·æ¯”é«˜çš„æ–°ä¸€ä»£åº”ç”¨ç½‘å…³ã€‚è¿›å…¥2014å¹´ï¼Œå®é™…æ”¯æŒå›½å†…åº”ç”¨åè®®è¶…è¿‡800ç§ï¼Œå¹¶å·²é›†æˆè·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€è®¤è¯ã€ä¸€æ‹–Næ£€æµ‹ã€ç§»åŠ¨ç»ˆç«¯è¯†åˆ«ã€DNSç®¡æ§ã€HTTPç®¡æ§ã€æ—¥å¿—å®¡è®¡ç­‰å®ç”¨åŠŸèƒ½äºä¸€ä½“ã€‚</td></tr></tbody></table><h1 id="Panabit-çš„-Iwan"><a href="#Panabit-çš„-Iwan" class="headerlink" title="Panabit çš„ Iwan"></a>Panabit çš„ Iwan</h1><p>ä¸ºäº†è§£å†³å‰é¢çš„è¿™ç§æ–¹å¼ï¼Œå†³å®šæµ‹è¯•ä½¿ç”¨ Panabit çš„ Iwan çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ Panabit çš„ <code>SD-WAN</code>ï¼›</p><ul><li>é‡è¿é€Ÿåº¦å¾ˆå¿«ï¼š<br>Â  Â  Â  Â  æ¯”L2TPçš„è¦å¿«ä¸€ä¸ªæ•°é‡çº§ï¼ŒL2TPè¦é‡è¿ï¼Œéœ€è¦æœ‰å‡ åæ¬¡äº¤äº’ï¼Œè€Œæˆ‘ä»¬åªéœ€è¦ä¸€æ¬¡å³å¯  </li><li>å®¢æˆ·ç«¯ä¸å—åº•å±‚æ‰¿è½½çº¿è·¯IPå˜åŒ–å½±å“ï¼š<br>Â  Â  Â  Â  å½“åº•å±‚æ‰¿è½½çº¿è·¯ï¼ˆæ¯”å¦‚PPPOEæ‹¨å·çº¿è·¯ï¼‰çš„IPåœ°å€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¸ä¼šå½±å“iWANéš§é“ï¼ŒiWANéš§é“ä¸ä¼šä¸­æ–­ï¼Œä¿è¯é€šä¿¡æ­£å¸¸è¿›è¡Œï¼›<br>Â  Â  Â  Â  å› ä¸ºå¾ˆå¤šç”¨æˆ·æ˜¯é€šè¿‡PPPOEæ‹¨å·çº¿è·¯å‡ºå»çš„ï¼ŒPPPOEæ‹¨å·çº¿è·¯é‡æ‹¨æ—¶ä¸€èˆ¬ä¼šæ”¹å˜IPåœ°å€ï¼Œå¦‚æœç”¨L2TPçš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªL2TPä¼šè¯å°±è¦é‡å»ºï¼›<br>Â  Â  Â  Â  è€Œç”¨iWANçš„è¯ï¼Œç°æœ‰çš„ä¼šè¯å¯ä»¥ç…§å¸¸ä½¿ç”¨ï¼Œä¸éœ€è¦åšä»»ä½•æ”¹å˜ï¼›  </li><li>ä¼ è¾“æ•ˆç‡é«˜ï¼š<br>Â  Â  Â  Â  iWANçš„åŒ…å¤´å¾ˆå°ï¼Œåªæœ‰8ä¸ªå­—èŠ‚ï¼Œè€Œä¸”åœ¨åç»­ç‰ˆæœ¬é‡Œï¼Œæˆ‘ä»¬ä¼šå‹ç¼©IPæŠ¥æ–‡å¤´ï¼Œè¿™æ ·å¯ä»¥ç»§ç»­å‡å°‘é¢å¤–æŠ¥æ–‡å¤´çš„å¤§å°ï¼Œæ‰€ä»¥èƒ½å¤§å¹…åº¦æå‡ä¼ è¾“æ•ˆç‡ï¼›<br>Â  Â  Â  Â  å¦‚æœç”¨å›½é™…çº¿è·¯çš„è¯ï¼ŒèŠ‚çœä¸‹æ¥çš„æµé‡è´¹ç”¨éƒ½æ˜¯å¾ˆå¯è§‚çš„ï¼›  </li><li>æŠ—å¹²æ‰°ï¼š<br>Â  Â  Â  Â  ä¸åƒL2TPï¼Œä¸­é—´äººå¯ä»¥ç›´æ¥å‘åŒ…TERMINATEï¼ŒiWANæ§åˆ¶å‘½ä»¤æœ‰å®Œæ•´æ€§æ£€æŸ¥ï¼Œå¯ä»¥é¿å…ä¸­é—´äººæ”»å‡»ã€‚</li></ul><h1 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h1><h2 id="1ã€æ­å»ºpanabit"><a href="#1ã€æ­å»ºpanabit" class="headerlink" title="1ã€æ­å»ºpanabit"></a>1ã€æ­å»ºpanabit</h2><p>è®°å¾—æœåŠ¡å™¨ç”³è¯·2Hçš„ï¼Œ1Héœ€è¦éœ€æ”¹æ ¸å¿ƒï¼Œéå¸¸éº»çƒ¦<br>ä¸‹è½½Linuxç³»ç»Ÿæ–‡ä»¶ï¼šæ–‡æœ«<br>ä¸Šä¼ æ–‡ä»¶åˆ°rootæ ¹ç›®å½•ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar -xzf PanabitFREE_SUIr2p3_20220413_Linux3.tar.gz</span><br><span class="line"><span class="built_in">cd</span> PanabitFREE_SUIr2p3_20220413_Linux3</span><br><span class="line"><span class="comment"># è¾“å…¥ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…</span></span><br><span class="line">./ipeinstall</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹<code>/etc/PG.conf</code>æ–‡ä»¶<br>å› ä¸ºæ˜¯å•ç½‘å£ï¼Œæ‰€ä»¥æ•°æ®å£å’Œç®¡ç†å£éƒ½éœ€è¦é…ç½®æˆeth0ï¼Œåé¢ä¸è¦åŠ ä»»ä½•ä¸œè¥¿</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DATA_PORTS ä¿®æ”¹æˆï¼šDATA_PORTS=<span class="string">&quot;eth0&quot;</span></span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹ç«¯å£"><a href="#ä¿®æ”¹ç«¯å£" class="headerlink" title="ä¿®æ”¹ç«¯å£"></a>ä¿®æ”¹ç«¯å£</h3><h4 id="ä¸Šä¼ æ–‡ä»¶ï¼Œä¿®æ”¹é…ç½®"><a href="#ä¸Šä¼ æ–‡ä»¶ï¼Œä¿®æ”¹é…ç½®" class="headerlink" title="ä¸Šä¼ æ–‡ä»¶ï¼Œä¿®æ”¹é…ç½®"></a>ä¸Šä¼ æ–‡ä»¶ï¼Œä¿®æ”¹é…ç½®</h4><p>éœ€è¦ä¸Šä¼ ä¸€ä¸ªjoskmcæ–‡ä»¶ï¼ˆæ–‡ä»¶åœ¨æ–‡æœ«ï¼‰<br>åœ¨<code>/etc/PG.conf</code>ä¸­æ–°å¢ä¸€ä¸‹ä¸€è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTTPS_PORT=2194</span><br></pre></td></tr></table></figure><h4 id="æ‰§è¡Œjoskmc"><a href="#æ‰§è¡Œjoskmc" class="headerlink" title="æ‰§è¡Œjoskmc"></a>æ‰§è¡Œjoskmc</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/root/joskmc tcpÂ 2194</span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹ï¼š-etc-rc-localï¼Œå¢åŠ ä¸€ä¸‹ä¸‰è¡Œ"><a href="#ä¿®æ”¹ï¼š-etc-rc-localï¼Œå¢åŠ ä¸€ä¸‹ä¸‰è¡Œ" class="headerlink" title="ä¿®æ”¹ï¼š/etc/rc.localï¼Œå¢åŠ ä¸€ä¸‹ä¸‰è¡Œ"></a>ä¿®æ”¹ï¼š<code>/etc/rc.local</code>ï¼Œå¢åŠ ä¸€ä¸‹ä¸‰è¡Œ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sleep</span>Â 10</span><br><span class="line">/root/joskmc tcpÂ 2194</span><br></pre></td></tr></table></figure><h2 id="2ã€è¿›è¡Œéš§é“é…ç½®ï¼ˆæµ·å¤–ï¼‰"><a href="#2ã€è¿›è¡Œéš§é“é…ç½®ï¼ˆæµ·å¤–ï¼‰" class="headerlink" title="2ã€è¿›è¡Œéš§é“é…ç½®ï¼ˆæµ·å¤–ï¼‰"></a>2ã€è¿›è¡Œéš§é“é…ç½®ï¼ˆæµ·å¤–ï¼‰</h2><h3 id="1-ã€ç™»å½•WEBé¡µé¢ï¼Œä¿®æ”¹ç½‘å¡æ–¹å‘"><a href="#1-ã€ç™»å½•WEBé¡µé¢ï¼Œä¿®æ”¹ç½‘å¡æ–¹å‘" class="headerlink" title="(1)ã€ç™»å½•WEBé¡µé¢ï¼Œä¿®æ”¹ç½‘å¡æ–¹å‘"></a>(1)ã€ç™»å½•WEBé¡µé¢ï¼Œä¿®æ”¹ç½‘å¡æ–¹å‘</h3><p>é»˜è®¤è´¦å·å¯†ç ï¼šadmin&#x2F;panabit<br>ç³»ç»Ÿæ¦‚å†µ â†’ ç½‘ç»œæ¥å£ï¼šeth0ï¼Œä¿®æ”¹æˆå¯¹å¤–ï¼Œåªæœ‰å¯¹å¤–æ‰å¯ä»¥åˆ›å»ºWANçº¿è·¯<br><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/20230217103308.png"/></p><h3 id="2-ã€åˆ›å»ºWANçº¿è·¯"><a href="#2-ã€åˆ›å»ºWANçº¿è·¯" class="headerlink" title="(2)ã€åˆ›å»ºWANçº¿è·¯"></a>(2)ã€åˆ›å»ºWANçº¿è·¯</h3><p>åº”ç”¨è·¯ç”± â†’ æ¥å£çº¿è·¯ï¼š<br>éœ€è¦æ³¨æ„ï¼ŒMacåœ°å€å¿…é¡»å…‹éš†<br><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/202302171033490.png"/></p><h3 id="3-ã€åˆ›å»ºIWANè¿æ¥è´¦å·"><a href="#3-ã€åˆ›å»ºIWANè¿æ¥è´¦å·" class="headerlink" title="(3)ã€åˆ›å»ºIWANè¿æ¥è´¦å·"></a>(3)ã€åˆ›å»ºIWANè¿æ¥è´¦å·</h3><p>å¯¹è±¡ç®¡ç† â†’ è´¦å·ç®¡ç† â†’ ç»„ç»‡æ¶æ„ï¼š<br>åœ°å€èŒƒå›´ï¼šè¿™ä¸€å—å¯ä»¥è‡ªå·±å®šä¸€ä¸ªå†…ç½‘çš„IPæ®µå°±å¯ä»¥ï¼Œä¸è¦å†²çªå°±å¥½<br><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/20230217103417.png"/><br>åœ°å€èŒƒå›´éœ€è¦æŠŠç½‘å…³åœ°å€ç•™å‡ºæ¥ï¼ï¼ï¼ï¼ï¼<br><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/20230217103432.png"/><br>å¯¹è±¡ç®¡ç† â†’ è´¦å·ç®¡ç† â†’ æœ¬åœ°è´¦å·ï¼š<br>å¤„ç†ç”¨æˆ·ç»„éœ€è¦é€‰æ‹©å‰é¢åˆ›å»ºçš„ç”¨æˆ·ç»„ï¼Œå…¶ä»–çš„æ ¹æ®å®é™…æƒ…å†µå¡«å†™<br><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/20230217103454.png"/></p><h3 id="4-ã€åˆ›å»ºiWANæœåŠ¡"><a href="#4-ã€åˆ›å»ºiWANæœåŠ¡" class="headerlink" title="(4)ã€åˆ›å»ºiWANæœåŠ¡"></a>(4)ã€åˆ›å»ºiWANæœåŠ¡</h3><p>åº”ç”¨è·¯ç”± â†’ iWANæœåŠ¡ â†’ æœåŠ¡åˆ—è¡¨ï¼š<br>æ³¨æ„ï¼šæœåŠ¡å™¨ç½‘å…³åœ°å€è¦å’Œä½ å‰é¢è®¾ç½®çš„åœ°å€èŒƒå›´è¦åœ¨ä¸€å—ï¼Œå¹¶ä¸”éœ€è¦æ’é™¤è¿™ä¸ªåœ°å€çš„ä¸‹å‘<br><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/20230217103517.png"/><br>åº”ç”¨è·¯ç”± â†’ iWANæœåŠ¡ â†’ æœåŠ¡æ˜ å°„ï¼š<br>æ ¹æ®é…ç½®æƒ…å†µé€‰æ‹©å³å¯<br>iWANä½¿ç”¨çš„æ˜¯UDPè¿æ¥ï¼Œå› æ­¤ç«¯å£éœ€è¦å¼€æ”¾UDP<br><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/20230217103531.png"/></p><h3 id="5-ã€åˆ›å»ºç­–ç•¥è·¯ç”±"><a href="#5-ã€åˆ›å»ºç­–ç•¥è·¯ç”±" class="headerlink" title="(5)ã€åˆ›å»ºç­–ç•¥è·¯ç”±"></a>(5)ã€åˆ›å»ºç­–ç•¥è·¯ç”±</h3><p>åº”ç”¨è·¯ç”± â†’ ç­–ç•¥è·¯ç”±ï¼šéœ€è¦æ·»åŠ ä¸€æ¡å›ç¨‹çš„å…¨ç¨‹è·¯ç”±ï¼Œè¦ä¸ç„¶DNSç‰µå¼•ã€FQéƒ½ä¼šå¤±è´¥<br>è¿™é‡Œé€‰æ‹©iWANçš„çº¿è·¯<br><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/20230217103546.png"/></p><h2 id="3ã€å®¢æˆ·ç«¯é…ç½®ï¼ˆåŠå…¬ç½‘ï¼‰"><a href="#3ã€å®¢æˆ·ç«¯é…ç½®ï¼ˆåŠå…¬ç½‘ï¼‰" class="headerlink" title="3ã€å®¢æˆ·ç«¯é…ç½®ï¼ˆåŠå…¬ç½‘ï¼‰"></a>3ã€å®¢æˆ·ç«¯é…ç½®ï¼ˆåŠå…¬ç½‘ï¼‰</h2><h3 id="1-ã€æ–°å»ºWANçº¿è·¯"><a href="#1-ã€æ–°å»ºWANçº¿è·¯" class="headerlink" title="(1)ã€æ–°å»ºWANçº¿è·¯"></a>(1)ã€æ–°å»ºWANçº¿è·¯</h3><p>åº”ç”¨è·¯ç”± â†’ æ¥å£çº¿è·¯ â†’ WANçº¿è·¯ï¼šæŒ‰ç…§ä¿¡æ¯æç¤ºå¡«å†™å³å¯å®ŒæˆiWANçº¿è·¯é…ç½®<br>æ³¨æ„ï¼šå¿…é¡»æœ‰ä¸€ä¸ªå¤–ç½‘çš„ç½‘å¡ï¼Œå¹¶ä¸”æœ€å¥½æŠŠåŠ å¯†å¼€èµ·æ¥<br><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/20230217103622.png"/><br><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/20230217103634.png"/></p><h3 id="2-ã€è®¾ç½®DNSç‰µå¼•"><a href="#2-ã€è®¾ç½®DNSç‰µå¼•" class="headerlink" title="(2)ã€è®¾ç½®DNSç‰µå¼•"></a>(2)ã€è®¾ç½®DNSç‰µå¼•</h3><p>åº”ç”¨è·¯ç”± â†’ DNSç®¡æ§ï¼šæµ·å¤–åŸŸåæ˜¯ä¸€ä¸ªåŸŸåç¾¤ç»„ï¼Œå¯ä»¥è‡ªå·±ä¿®æ”¹<br>ä¸»è¦è§£å†³DNSæ±¡æŸ“é—®é¢˜ï¼Œè¦ä¸ç„¶å¯èƒ½éƒ¨åˆ†ç½‘ç«™ä¼šæ— æ³•è®¿é—®<br>è¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆæ³¨æ„çš„ç‚¹ï¼Œå°±æ˜¯ä½ çš„DNSï¼Œè®¿é—®DNSçš„é“¾è·¯å¿…é¡»ç»è¿‡PAï¼Œå¦åˆ™ç‰µå¼•ä¸ä¼šç”Ÿæ•ˆ<br><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/20230217103653.png"/></p><h3 id="3-ã€è®¾ç½®ç­–ç•¥è·¯ç”±"><a href="#3-ã€è®¾ç½®ç­–ç•¥è·¯ç”±" class="headerlink" title="(3)ã€è®¾ç½®ç­–ç•¥è·¯ç”±"></a>(3)ã€è®¾ç½®ç­–ç•¥è·¯ç”±</h3><p>åº”ç”¨è·¯ç”± â†’ ç­–ç•¥è·¯ç”±ï¼šæˆ‘è¿™è¾¹ç›´æ¥æ‹¿äº†é£è¿çš„609æµ·å¤–åˆ†æµIPæ®µè¿›è¡Œåˆ†æµï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±ä¿®æ”¹ï¼ˆæ–‡æœ«ä¸‹è½½ï¼‰<br>ä¸»è¦ä¸ºäº†åªæœ‰éœ€è¦æµ·å¤–çš„æ‰å‡ºå»ï¼Œä¸èƒ½æŠŠæ‰€æœ‰çš„æµé‡å…¨éƒ¨å¯¼å‡ºå»<br><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/20230217103713.png"/></p><h1 id="é™„ä»¶"><a href="#é™„ä»¶" class="headerlink" title="é™„ä»¶"></a>é™„ä»¶</h1><p>169IPæ®µï¼š <a href="https://www.123pan.com/s/cRk7Vv-frSsH">https://www.123pan.com/s/cRk7Vv-frSsH</a> æå–ç :NzAF<br>Linuxæ“ä½œç³»ç»Ÿï¼š <a href="https://www.123pan.com/s/cRk7Vv-arSsH">https://www.123pan.com/s/cRk7Vv-arSsH</a> æå–ç :A5MC<br>joskmcï¼š <a href="https://www.123pan.com/s/cRk7Vv-BrSsH">https://www.123pan.com/s/cRk7Vv-BrSsH</a> æå–ç :kTu9</p>]]></content>
      
      
      
        <tags>
            
            <tag> åŠå…¬ç½‘ </tag>
            
            <tag> å…¨çƒåŒ– </tag>
            
            <tag> å…¨çƒåŠå…¬ </tag>
            
            <tag> å›½é™…åŒ– </tag>
            
            <tag> Panabit </tag>
            
            <tag> iwan </tag>
            
            <tag> sd-wan </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ss-tproxy é€æ˜ä»£ç†çš„è®¾ç½®æ–¹æ³•</title>
      <link href="/2023/02/16/ssTproxyTransparentAgent/"/>
      <url>/2023/02/16/ssTproxyTransparentAgent/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="ä¸€ã€ä»‹ç»"><a href="#ä¸€ã€ä»‹ç»" class="headerlink" title="ä¸€ã€ä»‹ç»"></a>ä¸€ã€ä»‹ç»</h1><h2 id="1ã€ä»€ä¹ˆæ˜¯é€æ˜ä»£ç†"><a href="#1ã€ä»€ä¹ˆæ˜¯é€æ˜ä»£ç†" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯é€æ˜ä»£ç†"></a>1ã€ä»€ä¹ˆæ˜¯é€æ˜ä»£ç†</h2><p>åœ¨æ­£å‘ä»£ç†ä¸­ï¼Œä¸€ä¸ªè½¯ä»¶å¦‚æœæƒ³èµ° client çš„ä»£ç†æœåŠ¡ï¼Œæˆ‘ä»¬å¿…é¡»æ˜¾å¼é…ç½®è¯¥è½¯ä»¶ï¼Œå¯¹è¯¥è½¯ä»¶æ¥è¯´ï¼Œæœ‰æ²¡æœ‰èµ°ä»£ç†æ˜¯å¾ˆæ˜ç¡®çš„ï¼Œå¤§å®¶éƒ½â€œå¿ƒçŸ¥è‚šæ˜â€ã€‚è€Œé€æ˜ä»£ç†åˆ™ä¸æ­£å‘ä»£ç†ç›¸åï¼Œå½“æˆ‘ä»¬è®¾ç½®å¥½åˆé€‚çš„é˜²ç«å¢™è§„åˆ™ï¼ˆä»…ä»¥ Linux çš„ iptables ä¸ºä¾‹ï¼‰ï¼Œæˆ‘ä»¬å°†ä¸å†éœ€è¦æ˜¾å¼é…ç½®è¿™äº›è½¯ä»¶æ¥è®©å…¶ç»è¿‡ä»£ç†æˆ–è€…ä¸ç»è¿‡ä»£ç†ï¼ˆç›´è¿ï¼‰ï¼Œå› ä¸ºè¿™äº›è½¯ä»¶å‘å‡ºçš„æµé‡ä¼šè‡ªåŠ¨è¢« iptables è§„åˆ™æ‰€å¤„ç†ï¼Œé‚£äº›æˆ‘ä»¬è®¤ä¸ºéœ€è¦ä»£ç†çš„æµé‡ï¼Œä¼šè¢«é€šè¿‡åˆé€‚çš„æ–¹æ³•å‘é€åˆ° client è¿›ç¨‹ï¼Œè€Œé‚£äº›æˆ‘ä»¬ä¸éœ€è¦ä»£ç†çš„æµé‡ï¼Œåˆ™ç›´æ¥æ”¾è¡Œï¼ˆç›´è¿ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹å¯¹äºæˆ‘ä»¬ä½¿ç”¨çš„è½¯ä»¶æ¥è¯´æ˜¯å®Œå…¨é€æ˜çš„ï¼Œè½¯ä»¶è‡ªèº«å¯¹å…¶ä¸€æ— æ‰€çŸ¥ã€‚è¿™å°±å«åšÂ <strong>é€æ˜ä»£ç†</strong>ã€‚æ³¨æ„ï¼Œæ‰€è°“é€æ˜æ˜¯å¯¹æˆ‘ä»¬ä½¿ç”¨çš„è½¯ä»¶é€æ˜ï¼Œè€Œéå¯¹ clientã€server æˆ–ç›®æ ‡ç½‘ç«™é€æ˜ï¼Œç†è§£è¿™ä¸€ç‚¹éå¸¸é‡è¦ã€‚</p><span id="more"></span><h2 id="2ã€é€æ˜ä»£ç†çš„å·¥ä½œåŸç†"><a href="#2ã€é€æ˜ä»£ç†çš„å·¥ä½œåŸç†" class="headerlink" title="2ã€é€æ˜ä»£ç†çš„å·¥ä½œåŸç†"></a>2ã€é€æ˜ä»£ç†çš„å·¥ä½œåŸç†</h2><p>åœ¨æ­£å‘ä»£ç†ä¸­ï¼ŒæœŸæœ›ä½¿ç”¨ä»£ç†çš„è½¯ä»¶ä¼šé€šè¿‡ httpã€socks5 åè®®ä¸ client è¿›ç¨‹è¿›è¡Œäº¤äº’ï¼Œä»¥æ­¤å®Œæˆä»£ç†æ“ä½œã€‚è€Œåœ¨é€æ˜ä»£ç†ä¸­ï¼Œæˆ‘ä»¬çš„è½¯ä»¶å‘å‡ºçš„æµé‡æ˜¯å®Œå…¨æ­£å¸¸çš„æµé‡ï¼Œå¹¶æ²¡æœ‰åƒæ­£å‘ä»£ç†é‚£æ ·ï¼Œä½¿ç”¨ httpã€socks5 ç­‰ä¸“ç”¨åè®®ï¼Œè¿™äº›æµé‡ç»è¿‡ iptables è§„åˆ™çš„å¤„ç†åï¼Œä¼šè¢«é€šè¿‡â€œåˆé€‚çš„æ–¹æ³•â€å‘é€ç»™ client è¿›ç¨‹ï¼ˆå½“ç„¶æ˜¯æŒ‡é‚£äº›æˆ‘ä»¬è®¤ä¸ºéœ€è¦èµ°ä»£ç†çš„æµé‡ï¼‰ã€‚æ³¨æ„ï¼Œæ­¤æ—¶ client è¿›ç¨‹æ¥æ”¶åˆ°ä¸å†æ˜¯ httpã€socks5 åè®®æ•°æ®ï¼Œè€Œæ˜¯ç»è¿‡ iptables å¤„ç†çš„â€œé€æ˜ä»£ç†æ•°æ®â€ï¼Œâ€œé€æ˜ä»£ç†æ•°æ®â€ä»æœ¬è´¨ä¸Šæ¥è¯´ä¸æ­£å¸¸æ•°æ®æ²¡æœ‰åŒºåˆ«ï¼Œåªæ˜¯å¤šäº†ä¸€äº›â€œå…ƒæ•°æ®â€åœ¨é‡Œé¢ï¼Œä½¿å¾— client è¿›ç¨‹å¯ä»¥é€šè¿‡ netfilter æˆ–æ“ä½œç³»ç»Ÿæä¾›çš„ API æ¥å£æ¥è·å–è¿™äº›å…ƒæ•°æ®ï¼ˆå…ƒæ•°æ®å…¶å®å°±æ˜¯åŸå§‹ç›®çš„åœ°å€å’ŒåŸå§‹ç›®çš„ç«¯å£ï¼‰ã€‚é‚£ä¹ˆè¿™ä¸ªâ€œåˆé€‚çš„æ–¹æ³•â€æ˜¯ä»€ä¹ˆï¼Ÿç›®å‰æ¥è¯´æœ‰ä¸¤ç§ï¼š</p><ul><li>REDIRECTï¼šåªæ”¯æŒ TCP åè®®çš„é€æ˜ä»£ç†ã€‚</li><li>TPROXYï¼šæ”¯æŒ TCP å’Œ UDP åè®®çš„é€æ˜ä»£ç†ã€‚</li></ul><p>å› æ­¤ï¼Œå¯¹äº TCP é€æ˜ä»£ç†ï¼Œæœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼Œä¸€ç§æ˜¯ REDIRECTï¼Œä¸€ç§æ˜¯ TPROXYï¼›è€Œå¯¹äº UDP é€æ˜ä»£ç†ï¼Œåªèƒ½é€šè¿‡ TPROXY æ–¹å¼æ¥å®ç°ã€‚ä¸ºæ–¹ä¾¿å™è¿°ï¼Œæœ¬æ–‡ä»¥Â <strong>çº¯ TPROXY æ¨¡å¼</strong>Â æŒ‡ä»£ TCP å’Œ UDP éƒ½ä½¿ç”¨ TPROXY æ¥å®ç°ï¼Œä»¥Â <strong>REDIRECT + TPROXY æ¨¡å¼</strong>Â æŒ‡ä»£ TCP ä½¿ç”¨ REDIRECT å®ç°ï¼Œè€Œ UDP ä½¿ç”¨ TPROXY æ¥å®ç°ï¼Œæœ‰æ—¶å€™ç®€ç§°Â <strong>REDIRECT æ¨¡å¼</strong>ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸€ä¸ªæ„æ€ã€‚</p><h1 id="äºŒã€Openvpnæµé‡è½¬å‘"><a href="#äºŒã€Openvpnæµé‡è½¬å‘" class="headerlink" title="äºŒã€Openvpnæµé‡è½¬å‘"></a>äºŒã€Openvpnæµé‡è½¬å‘</h1><p>é‡‡ç”¨ï¼š<a href="https://github.com/zfl9/ss-tproxy">https://github.com/zfl9/ss-tproxy</a><br>åŸç†ï¼šopenvpn â†’ iptables â†’Â ss-redir</p><h1 id="ä¸‰ã€éƒ¨ç½²æ–¹å¼"><a href="#ä¸‰ã€éƒ¨ç½²æ–¹å¼" class="headerlink" title="ä¸‰ã€éƒ¨ç½²æ–¹å¼"></a>ä¸‰ã€éƒ¨ç½²æ–¹å¼</h1><h2 id="1ã€ä¾èµ–æ£€æŸ¥"><a href="#1ã€ä¾èµ–æ£€æŸ¥" class="headerlink" title="1ã€ä¾èµ–æ£€æŸ¥"></a>1ã€ä¾èµ–æ£€æŸ¥</h2><p>åœ¨éƒ¨ç½²ä¹‹å‰ï¼Œéœ€è¦æ£€æŸ¥ä¸‹å½“å‰è‡ªå·±çš„æœåŠ¡å™¨ä¾èµ–æ˜¯å¦å®Œæ•´ï¼š<br>ä¾èµ–å®‰è£…åœ°å€ï¼š<a href="https://github.com/zfl9/ss-tproxy/wiki/Linux-%E9%80%8F%E6%98%8E%E4%BB%A3%E7%90%86#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96">https://github.com/zfl9/ss-tproxy/wiki/Linux-%E9%80%8F%E6%98%8E%E4%BB%A3%E7%90%86#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96</a></p><h2 id="2ã€è„šæœ¬å®‰è£…"><a href="#2ã€è„šæœ¬å®‰è£…" class="headerlink" title="2ã€è„šæœ¬å®‰è£…"></a>2ã€è„šæœ¬å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https:``//github.com/zfl9/ss-tproxy</span><br><span class="line"><span class="built_in">cd</span> ss-tproxy</span><br><span class="line"><span class="built_in">chmod</span> +x ss-tproxy</span><br></pre></td></tr></table></figure><h3 id="install-å¯ç”¨çš„æƒ…å†µä¸‹ï¼ˆæ¨èï¼‰"><a href="#install-å¯ç”¨çš„æƒ…å†µä¸‹ï¼ˆæ¨èï¼‰" class="headerlink" title="install å¯ç”¨çš„æƒ…å†µä¸‹ï¼ˆæ¨èï¼‰"></a>install å¯ç”¨çš„æƒ…å†µä¸‹ï¼ˆæ¨èï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">install ss-tproxy /usr/local/bin</span><br><span class="line">install -d /etc/ss-tproxy</span><br><span class="line">install -m`Â `644`Â `ss-tproxy.conf gfwlist* chnroute* ignlist* /etc/ss-tproxy</span><br><span class="line">install -m`Â `644`Â `ss-tproxy.service /etc/systemd/system <span class="comment"># å¯é€‰ï¼Œå®‰è£… service æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><h3 id="install-ä¸å¯ç”¨"><a href="#install-ä¸å¯ç”¨" class="headerlink" title="install ä¸å¯ç”¨"></a>install ä¸å¯ç”¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> -af ss-tproxy /usr/local/bin</span><br><span class="line"><span class="built_in">mkdir</span> -p /etc/ss-tproxy</span><br><span class="line"><span class="built_in">cp</span> -af ss-tproxy.conf gfwlist* chnroute* ignlist* /etc/ss-tproxy</span><br><span class="line"><span class="built_in">cp</span> -af ss-tproxy.service /etc/systemd/system <span class="comment"># å¯é€‰ï¼Œå®‰è£… service æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight shell"><figcaption><span>/etc/ss-tproxy/ss-tproxy.conf >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mode</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">mode=<span class="string">&#x27;global&#x27;</span>  <span class="comment"># global æ¨¡å¼ (ä¸åˆ†æµ)</span></span></span><br><span class="line">mode=&#x27;gfwlist&#x27; # gfwlist æ¨¡å¼ (é»‘åå•)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">mode=<span class="string">&#x27;chnroute&#x27;</span> <span class="comment"># chnroute æ¨¡å¼ (ç™½åå•)</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ipv4/6</span></span><br><span class="line">ipv4=&#x27;true&#x27;     # true:å¯ç”¨ipv4é€æ˜ä»£ç†; false:å…³é—­ipv4é€æ˜ä»£ç†</span><br><span class="line">ipv6=&#x27;false&#x27;    # true:å¯ç”¨ipv6é€æ˜ä»£ç†; false:å…³é—­ipv6é€æ˜ä»£ç†</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">tproxy</span></span><br><span class="line">tproxy=&#x27;false&#x27;  # true:TPROXY+TPROXY; false:REDIRECT+TPROXY</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">tcponly</span></span><br><span class="line">tcponly=&#x27;false&#x27; # true:ä»…ä»£ç†TCPæµé‡; false:ä»£ç†TCPå’ŒUDPæµé‡</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">selfonly</span></span><br><span class="line">selfonly=&#x27;false&#x27; # true:ä»…ä»£ç†æœ¬æœºæµé‡; false:ä»£ç†æœ¬æœºåŠ&quot;å†…ç½‘&quot;æµé‡</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">proxy</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">user/group(<span class="comment">#1,æ¨è) vs svraddr+port(#2), user/groupé€‰å…¶ä¸­ä¸€ä¸ªå¡«å†™(ä¸å»ºè®®éƒ½å¡«)</span></span></span><br><span class="line">proxy_procuser=&#x27;proxy&#x27;   # æœ¬æœºä»£ç†è¿›ç¨‹çš„ user/uidï¼Œç”¨æ¥æ”¾è¡Œæœ¬æœºä»£ç†è¿›ç¨‹ä¼ å‡ºçš„æµé‡</span><br><span class="line">proxy_procgroup=&#x27;&#x27;       # æœ¬æœºä»£ç†è¿›ç¨‹çš„ group/gidï¼Œç”¨æ¥æ”¾è¡Œæœ¬æœºä»£ç†è¿›ç¨‹ä¼ å‡ºçš„æµé‡</span><br><span class="line">proxy_svraddr4=()        # æœåŠ¡å™¨çš„ IPv4 åœ°å€æˆ–åŸŸåï¼Œå…è®¸å¡«å†™å¤šä¸ªæœåŠ¡å™¨åœ°å€ï¼Œç©ºæ ¼éš”å¼€</span><br><span class="line">proxy_svraddr6=()        # æœåŠ¡å™¨çš„ IPv6 åœ°å€æˆ–åŸŸåï¼Œå…è®¸å¡«å†™å¤šä¸ªæœåŠ¡å™¨åœ°å€ï¼Œç©ºæ ¼éš”å¼€</span><br><span class="line">proxy_svrport=&#x27;&#x27;         # æœåŠ¡å™¨çš„ç›‘å¬ç«¯å£ï¼Œå¯å¡«å¤šä¸ªç«¯å£ï¼Œæ ¼å¼åŒ ipts_proxy_dst_port</span><br><span class="line">proxy_tcpport=&#x27;12121&#x27;    # ss/ssr/v2ray ç­‰æœ¬æœºè¿›ç¨‹çš„ TCP ç›‘å¬ç«¯å£ï¼Œè¯¥ç«¯å£æ”¯æŒé€æ˜ä»£ç†</span><br><span class="line">proxy_udpport=&#x27;12121&#x27;    # ss/ssr/v2ray ç­‰æœ¬æœºè¿›ç¨‹çš„ UDP ç›‘å¬ç«¯å£ï¼Œè¯¥ç«¯å£æ”¯æŒé€æ˜ä»£ç†</span><br><span class="line">proxy_startcmd=&#x27;(ss-redir -c /etc/shadowsocks-libev/config.json -u &lt;/dev/null &amp;&gt;&gt;/var/log/ss-redir.log &amp;)&#x27;     # ç”¨äºå¯åŠ¨æœ¬æœºä»£ç†è¿›ç¨‹çš„ shell å‘½ä»¤ï¼Œè¯¥å‘½ä»¤åº”è¯¥èƒ½ç«‹å³æ‰§è¡Œå®Œæ¯•</span><br><span class="line">proxy_stopcmd=&#x27;kill -9 $(pidof ss-redir)&#x27;      # ç”¨äºå…³é—­æœ¬æœºä»£ç†è¿›ç¨‹çš„ shell å‘½ä»¤ï¼Œè¯¥å‘½ä»¤åº”è¯¥èƒ½ç«‹å³æ‰§è¡Œå®Œæ¯•</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dns</span></span><br><span class="line">dns_direct=&#x27;223.5.5.5&#x27;                # æœ¬åœ° IPv4 DNSï¼Œä¸èƒ½æŒ‡å®šç«¯å£ï¼Œä¹Ÿå¯ä»¥å¡«ç»„ç»‡ã€å…¬å¸å†…éƒ¨ DNS</span><br><span class="line">dns_direct6=&#x27;240C::6666&#x27;              # æœ¬åœ° IPv6 DNSï¼Œä¸èƒ½æŒ‡å®šç«¯å£ï¼Œä¹Ÿå¯ä»¥å¡«ç»„ç»‡ã€å…¬å¸å†…éƒ¨ DNS</span><br><span class="line">dns_remote=&#x27;8.8.8.8#53&#x27;               # è¿œç¨‹ IPv4 DNSï¼Œå¿…é¡»æŒ‡å®šç«¯å£ï¼Œæç¤ºï¼šè®¿é—®è¿œç¨‹ DNS ä¼šèµ°ä»£ç†</span><br><span class="line">dns_remote6=&#x27;2001:4860:4860::8888#53&#x27; # è¿œç¨‹ IPv6 DNSï¼Œå¿…é¡»æŒ‡å®šç«¯å£ï¼Œæç¤ºï¼šè®¿é—®è¿œç¨‹ DNS ä¼šèµ°ä»£ç†</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dnsmasq</span></span><br><span class="line">dnsmasq_bind_port=&#x27;53&#x27;                  # dnsmasq æœåŠ¡å™¨ç›‘å¬ç«¯å£ï¼Œè§ README</span><br><span class="line">dnsmasq_cache_size=&#x27;4096&#x27;               # DNS ç¼“å­˜å¤§å°ï¼Œå¤§å°ä¸º 0 è¡¨ç¤ºç¦ç”¨ç¼“å­˜</span><br><span class="line">dnsmasq_cache_time=&#x27;3600&#x27;               # DNS ç¼“å­˜æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ï¼Œæœ€å¤§ 3600 ç§’</span><br><span class="line">dnsmasq_query_maxcnt=&#x27;1024&#x27;             # è®¾ç½®å¹¶å‘ DNS æŸ¥è¯¢çš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º 150</span><br><span class="line">dnsmasq_log_enable=&#x27;false&#x27;              # è®°å½•è¯¦ç»†æ—¥å¿—ï¼Œé™¤éè¿›è¡Œè°ƒè¯•ï¼Œå¦åˆ™ä¸å»ºè®®å¯ç”¨</span><br><span class="line">dnsmasq_log_file=&#x27;/var/log/dnsmasq.log&#x27; # æ—¥å¿—æ–‡ä»¶ï¼Œå¦‚æœä¸æƒ³ä¿å­˜æ—¥å¿—å¯ä»¥æ”¹ä¸º /dev/null</span><br><span class="line">dnsmasq_conf_dir=()                     # `--conf-dir` é€‰é¡¹çš„å‚æ•°ï¼Œå¯ä»¥å¡«å¤šä¸ªï¼Œç©ºæ ¼éš”å¼€</span><br><span class="line">dnsmasq_conf_file=()                    # `--conf-file` é€‰é¡¹çš„å‚æ•°ï¼Œå¯ä»¥å¡«å¤šä¸ªï¼Œç©ºæ ¼éš”å¼€</span><br><span class="line">dnsmasq_conf_string=()                  # è‡ªå®šä¹‰é…ç½®ï¼Œä¸€ä¸ªæ•°ç»„å…ƒç´ å°±æ˜¯ä¸€è¡Œé…ç½®ï¼Œç©ºæ ¼éš”å¼€</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">chinadns</span></span><br><span class="line">chinadns_bind_port=&#x27;65353&#x27;               # chinadns-ng æœåŠ¡å™¨ç›‘å¬ç«¯å£ï¼Œé€šå¸¸ä¸ç”¨æ”¹åŠ¨</span><br><span class="line">chinadns_timeout=&#x27;5&#x27;                     # ç­‰å¾…ä¸Šæ¸¸ DNS è¿”å›å“åº”çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºç§’</span><br><span class="line">chinadns_repeat=&#x27;1&#x27;                      # å‘å¯ä¿¡ DNS å‘é€å‡ æ¬¡ DNS æŸ¥è¯¢è¯·æ±‚ï¼Œé»˜è®¤ä¸º 1</span><br><span class="line">chinadns_fairmode=&#x27;true&#x27;                 # ä½¿ç”¨å…¬å¹³æ¨¡å¼ï¼Œå…·ä½“çœ‹ chinadns-ng çš„ README</span><br><span class="line">chinadns_gfwlist_mode=&#x27;true&#x27;             # gfwlist æ¨¡å¼ï¼ŒåŠ è½½ gfwlist.txt/gfwlist.ext</span><br><span class="line">chinadns_noip_as_chnip=&#x27;false&#x27;           # å¯ç”¨ chinadns-ng çš„ `--noip-as-chnip` é€‰é¡¹</span><br><span class="line">chinadns_verbose=&#x27;false&#x27;                 # è®°å½•è¯¦ç»†æ—¥å¿—ï¼Œé™¤éè¿›è¡Œè°ƒè¯•ï¼Œå¦åˆ™ä¸å»ºè®®å¯ç”¨</span><br><span class="line">chinadns_logfile=&#x27;/var/log/chinadns.log&#x27; # æ—¥å¿—æ–‡ä»¶ï¼Œå¦‚æœä¸æƒ³ä¿å­˜æ—¥å¿—å¯ä»¥æ”¹ä¸º /dev/null</span><br><span class="line">chinadns_privaddr4=()                    # IPv4 ç§æœ‰åœ°å€æ®µï¼Œå¤šä¸ªç”¨ç©ºæ ¼éš”å¼€ï¼Œå…·ä½“è§ README</span><br><span class="line">chinadns_privaddr6=()                    # IPv6 ç§æœ‰åœ°å€æ®µï¼Œå¤šä¸ªç”¨ç©ºæ ¼éš”å¼€ï¼Œå…·ä½“è§ README</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dns2tcp</span></span><br><span class="line">dns2tcp_bind_port=&#x27;65454&#x27;               # dns2tcp è½¬å‘æœåŠ¡å™¨ç›‘å¬ç«¯å£ï¼Œå¦‚æœ‰å†²çªè¯·ä¿®æ”¹</span><br><span class="line">dns2tcp_tcp_syncnt=&#x27;&#x27;                   # dns2tcp çš„ `-s` é€‰é¡¹ï¼Œç•™ç©ºè¡¨ç¤ºä¸è®¾ç½®æ­¤é€‰é¡¹</span><br><span class="line">dns2tcp_tcp_quickack=&#x27;false&#x27;            # dns2tcp çš„ `-a` é€‰é¡¹ï¼Œé€‰é¡¹å–å€¼ä¸ºtrue/false</span><br><span class="line">dns2tcp_tcp_fastopen=&#x27;false&#x27;            # dns2tcp çš„ `-f` é€‰é¡¹ï¼Œé€‰é¡¹å–å€¼ä¸ºtrue/false</span><br><span class="line">dns2tcp_verbose=&#x27;false&#x27;                 # è®°å½•è¯¦ç»†æ—¥å¿—ï¼Œé™¤éè¿›è¡Œè°ƒè¯•ï¼Œå¦åˆ™ä¸å»ºè®®å¯ç”¨</span><br><span class="line">dns2tcp_logfile=&#x27;/var/log/dns2tcp.log&#x27;  # æ—¥å¿—æ–‡ä»¶ï¼Œå¦‚æœä¸æƒ³ä¿å­˜æ—¥å¿—å¯ä»¥æ”¹ä¸º /dev/null</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ipts</span></span><br><span class="line">ipts_if_lo=&#x27;lo&#x27;                 # ç¯å›æ¥å£çš„åç§°ï¼Œåœ¨æ ‡å‡†å‘è¡Œç‰ˆä¸­ï¼Œé€šå¸¸ä¸º loï¼Œå¦‚æœä¸æ˜¯è¯·ä¿®æ”¹</span><br><span class="line">ipts_rt_tab=&#x27;233&#x27;               # iproute2 è·¯ç”±è¡¨åæˆ–è¡¨ IDï¼Œé™¤éäº§ç”Ÿå†²çªï¼Œå¦åˆ™ä¸å»ºè®®æ”¹åŠ¨è¯¥é€‰é¡¹</span><br><span class="line">ipts_rt_mark=&#x27;0x2333&#x27;           # iproute2 ç­–ç•¥è·¯ç”±çš„é˜²ç«å¢™æ ‡è®°ï¼Œé™¤éäº§ç”Ÿå†²çªï¼Œå¦åˆ™ä¸å»ºè®®æ”¹åŠ¨è¯¥é€‰é¡¹</span><br><span class="line">ipts_set_snat=&#x27;true&#x27;           # è®¾ç½® iptables çš„ MASQUERADE è§„åˆ™ï¼Œå¸ƒå°”å€¼ï¼Œ`true/false`ï¼Œè¯¦è§ README</span><br><span class="line">ipts_set_snat6=&#x27;false&#x27;          # è®¾ç½® ip6tables çš„ MASQUERADE è§„åˆ™ï¼Œå¸ƒå°”å€¼ï¼Œ`true/false`ï¼Œè¯¦è§ README</span><br><span class="line">ipts_reddns_onstop=&#x27;true&#x27;       # ss-tproxy stop åï¼Œæ˜¯å¦å°†å…¶å®ƒä¸»æœºå‘è‡³æœ¬æœºçš„ DNS é‡å®šå‘è‡³ç›´è¿ DNSï¼Œè¯¦è§ README</span><br><span class="line">ipts_proxy_dst_port=&#x27;1:65535&#x27;   # é»‘åå• IP çš„å“ªäº›ç«¯å£èµ°ä»£ç†ï¼Œå¤šä¸ªç”¨é€—å·éš”å¼€ï¼Œå†’å·ä¸ºç«¯å£èŒƒå›´(å«è¾¹ç•Œ)ï¼Œè¯¦è§ README</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">opts</span></span><br><span class="line">opts_ss_netstat=&#x27;auto&#x27;                  # auto/ss/netstatï¼Œç”¨å“ªä¸ªç«¯å£æ£€æµ‹å·¥å…·ï¼Œè§ README</span><br><span class="line">opts_ping_cmd_to_use=&#x27;auto&#x27;             # auto/standalone/parameterï¼Œping ç›¸å…³ï¼Œè§ README</span><br><span class="line">opts_hostname_resolver=&#x27;auto&#x27;           # auto/dig/getent/pingï¼Œç”¨å“ªä¸ªè§£æå·¥å…·ï¼Œè§ README</span><br><span class="line">opts_overwrite_resolv=&#x27;false&#x27;           # true/false/ç•™ç©ºï¼Œå¦‚ä½•æ“ä½œ resolv.confï¼Œè§ README</span><br><span class="line">opts_ip_for_check_net=&#x27;223.5.5.5&#x27;       # æ£€æµ‹å¤–ç½‘æ˜¯å¦å¯è®¿é—®çš„ IPï¼Œpingï¼Œç•™ç©ºè¡¨ç¤ºè·³è¿‡æ­¤æ£€æŸ¥</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">file</span></span><br><span class="line">file_gfwlist_txt=&#x27;/etc/ss-tproxy/gfwlist.txt&#x27;      # gfwlist/chnlist æ¨¡å¼é¢„ç½®æ–‡ä»¶</span><br><span class="line">file_gfwlist_ext=&#x27;/etc/ss-tproxy/gfwlist.ext&#x27;      # gfwlist/chnlist æ¨¡å¼æ‰©å±•æ–‡ä»¶</span><br><span class="line">file_ignlist_ext=&#x27;/etc/ss-tproxy/ignlist.ext&#x27;      # global/chnroute æ¨¡å¼æ‰©å±•æ–‡ä»¶</span><br><span class="line">file_chnroute_set=&#x27;/etc/ss-tproxy/chnroute.set&#x27;    # chnroute åœ°å€æ®µæ–‡ä»¶ (iptables)</span><br><span class="line">file_chnroute6_set=&#x27;/etc/ss-tproxy/chnroute6.set&#x27;  # chnroute6 åœ°å€æ®µæ–‡ä»¶ (ip6tables)</span><br><span class="line">file_dnsserver_pid=&#x27;/etc/ss-tproxy/.dnsserver.pid&#x27; # dns æœåŠ¡å™¨è¿›ç¨‹çš„ pid æ–‡ä»¶ (shell)</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸»è¦æ”¾é€šä¸‹å†…ç½‘çš„è®¿é—®ï¼Œç„¶åæŠŠMASQUERADEæå‰å‡ºæ¥ï¼Œè¦ä¸ç„¶tcpçš„è¿æ¥ä¼šå›ä¸æ¥</span></span><br><span class="line">post_start()&#123;</span><br><span class="line">iptables -t nat -I PREROUTING -s 10.207.0.0/16 -d 10.0.0.0/8 -j ACCEPT</span><br><span class="line">iptables -t nat -I SSTP_POSTROUTING -s 10.207.0.0/16 -j MASQUERADE</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">post_stop()&#123;</span><br><span class="line">iptables -t nat -D PREROUTING -s 10.207.0.0/16 -d 10.0.0.0/8 -j ACCEPT</span><br><span class="line">iptables -t nat -D SSTP_POSTROUTING -s 10.207.0.0/16 -j MASQUERADE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹é…ç½®éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œå¦‚æœä¸çŸ¥é“å¦‚ä½•é…ç½®çš„ï¼Œé‚£ä¹ˆå°±æŒ‰ç…§æˆ‘è¿™ä¹ˆé»˜è®¤é…ç½®å³å¯<br>å…·ä½“é…ç½®ä»‹ç»ï¼š<a href="https://github.com/zfl9/ss-tproxy#%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E">https://github.com/zfl9/ss-tproxy#%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E</a><br><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/20230216143840.png"/><br><img src="https://raw.githubusercontent.com/almightyYantao/blog-img/master/20230216142810.png" /></p><h2 id="3ã€è®¾ç½®ss-libevä»£ç†"><a href="#3ã€è®¾ç½®ss-libevä»£ç†" class="headerlink" title="3ã€è®¾ç½®ss-libevä»£ç†"></a>3ã€è®¾ç½®ss-libevä»£ç†</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ–°ç‰ˆæœ¬(v4.``6.1``åŠä»¥ä¸Š)</span></span><br><span class="line"><span class="comment">#ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶ï¼Œè¯·æ‰§è¡Œä¸‹é¢è¿™ä¸¤ä¸ªæ“ä½œ</span></span><br><span class="line"><span class="comment">#``1``.åˆ›å»ºproxyç”¨æˆ·å’Œç»„: useradd -Mr -d/tmp -s/bin/bash proxy</span></span><br><span class="line"><span class="comment">#``2``.æˆäºˆé€æ˜ä»£ç†ç›¸å…³æƒé™: setcap cap_net_bind_service,cap_net_admin+ep /path/to/ss-redir</span></span><br><span class="line"><span class="comment">#&gt;&gt; è‹¥setcapä¸å¯ç”¨ï¼Œå¯ä½¿ç”¨suidæƒé™ä½ï¼Œæ­¤æ—¶éœ€é…ç½®ï¼šproxy_procuser=``&#x27;&#x27;``ã€proxy_procgroup=``&#x27;proxy&#x27;</span></span><br><span class="line"><span class="comment">#&gt;&gt; å°†æ‰€æœ‰è€…(ç»„)æ”¹ä¸ºrootï¼Œå¹¶æˆäºˆsuidæƒé™ï¼šchown root:root /path/to/ss-redir &amp;&amp; chmod`Â `4755`Â `/path/to/ss-redir</span></span><br><span class="line">proxy_procuser=``<span class="string">&#x27;proxy&#x27;</span></span><br><span class="line"><span class="comment">#proxy_startcmd=``&#x27;su proxy -c&quot;(ss-redir -c /etc/ss.json -u -v &lt;/dev/null &amp;&gt;&gt;/tmp/ss-redir.log &amp;)&quot;&#x27;`Â `# -v è¡¨ç¤ºè®°å½•è¯¦ç»†æ—¥å¿—</span></span><br><span class="line">proxy_startcmd=``<span class="string">&#x27;su proxy -c&quot;(ss-redir -c /etc/ss.json -u &lt;/dev/null &amp;&gt;&gt;/tmp/ss-redir.log &amp;)&quot;&#x27;</span>`Â `<span class="comment"># è¿™é‡Œå°±ä¸è®°å½•è¯¦ç»†æ—¥å¿—äº†</span></span><br><span class="line">proxy_stopcmd=``<span class="string">&#x27;kill -9 $(pidof ss-redir)&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="é»‘åå•ã€ç™½åå•è¯´æ˜"><a href="#é»‘åå•ã€ç™½åå•è¯´æ˜" class="headerlink" title="é»‘åå•ã€ç™½åå•è¯´æ˜"></a>é»‘åå•ã€ç™½åå•è¯´æ˜</h2><ul><li>å¯¹äº global æ¨¡å¼ï¼Œç™½åå•æ–‡ä»¶ä¸ºÂ <code>ignlist.ext</code>ï¼Œæ²¡æœ‰é»‘åå•æ–‡ä»¶ï¼Œå› ä¸ºé»˜è®¤éƒ½èµ°ä»£ç†ã€‚</li><li>å¯¹äº gfwlist æ¨¡å¼ï¼Œé»‘åå•æ–‡ä»¶ä¸ºÂ <code>gfwlist.txt/ext</code>ï¼Œæ²¡æœ‰ç™½åå•æ–‡ä»¶ï¼Œå› ä¸ºå…¶å®ƒéƒ½èµ°ç›´è¿ã€‚</li><li>å¯¹äº chnroute æ¨¡å¼ï¼Œç™½åå•æ–‡ä»¶ä¸ºÂ <code>ignlist.ext</code>ï¼Œæ²¡æœ‰é»‘åå•æ–‡ä»¶ï¼Œä½†å…è®¸å¼€å¯æ­¤åŠŸèƒ½ï¼Œè§ä¸‹ã€‚<br>å¦‚æœæƒ³è®© chnroute æ¨¡å¼æ”¯æŒé»‘åå•æ‰©å±•ï¼Œè¯·æ‰“å¼€ chinadns-ng çš„ gfwlist æ¨¡å¼ï¼ˆ<code>chinadns_gfwlist_mode</code>ï¼‰ï¼›å¼€å¯ gfwlist æ¨¡å¼åï¼Œchinadns-ng ä¼šè¯»å–Â <code>gfwlist.txt/ext</code>Â é»‘åå•æ–‡ä»¶ä¸­çš„<strong>åŸŸåæ¨¡å¼</strong>ï¼›å½“ chinadns-ng æ”¶åˆ°åŸŸåè§£æè¯·æ±‚æ—¶ï¼Œä¼šå…ˆæ£€æŸ¥ç»™å®šåŸŸåæ˜¯å¦åœ¨é»‘åå•ä¸­ï¼Œå¦‚æœæ˜¯åˆ™åªå‘å¯ä¿¡ DNS å‘å‡ºè§£æè¯·æ±‚ï¼ˆä¹Ÿå°±æ˜¯Â <code>dns_remote/dns_remote6</code>ï¼‰ï¼Œå› æ­¤è§£æå‡ºæ¥çš„ä¼šæ˜¯å›½å¤– IPï¼ˆä¸ä¸€å®šï¼Œå…·ä½“è¦çœ‹ç»™å®šåŸŸåçš„A&#x2F;AAAAè®°å½•ä»¥åŠå…¶dnsè§£æè®¾å®šï¼‰ï¼Œç„¶åå½“å®¢æˆ·ç«¯è®¿é—®è¯¥ IP æ—¶å°±ä¼šèµ°ä»£ç†å‡ºå»äº†ï¼ˆå¦‚æœè§£æçš„åœ°å€æ˜¯å›½å¤–åœ°å€ï¼‰ã€‚</li></ul><blockquote><p><code>chinadns_gfwlist_mode</code>çš„æœ¬æ„å…¶å®å¹¶ä¸æ˜¯ä¸ºäº†æ”¯æŒâ€™é»‘åå•â€™ï¼Œè€Œæ˜¯ä¸ºäº†æé«˜ chinadns-ng çš„å‡†ç¡®æ€§ï¼Œé™ä½ dns æ±¡æŸ“çš„å¯èƒ½æ€§</p></blockquote><p>å¯åŠ¨åï¼Œss-tproxyä¼šè‡ªåŠ¨å¸®ä½ åšé€æ˜ä»£ç†ï¼Œä¼šè®¾ç½®å¥½iptablesçš„é…ç½®ï¼Œä¸éœ€è¦åœ¨æ‰‹å·¥é…ç½®<br>åŒæ—¶ss-tproxyè¿˜æä¾›å‹¾å­çš„å½¢å¼ï¼Œæ¥å¸®åŠ©è§£å†³åˆ†æµæˆ–è€…å†…ç½‘è®¿é—®çš„ä¸€ä¸ªæ–¹æ¡ˆï¼Œå…·ä½“å‚è€ƒï¼š</p><ul><li><a href="https://github.com/zfl9/ss-tproxy#%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0">https://github.com/zfl9/ss-tproxy#%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0</a></li><li><a href="https://github.com/zfl9/ss-tproxy#%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0%E5%B0%8F%E6%8A%80%E5%B7%A7">https://github.com/zfl9/ss-tproxy#%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0%E5%B0%8F%E6%8A%80%E5%B7%A7</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> ä»£ç† </tag>
            
            <tag> é€æ˜ä»£ç† </tag>
            
            <tag> vpn </tag>
            
            <tag> æµé‡è½¬å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¸…ç†è‡ªå®šä¹‰DHCPä¸‹å‘ï¼Œå¼‚å¸¸æ–­å¼€å¯¼è‡´IPåœ°å€å ç”¨çš„é—®é¢˜</title>
      <link href="/2023/02/16/openvpn/clearOpenvpnInvalidIp/"/>
      <url>/2023/02/16/openvpn/clearOpenvpnInvalidIp/</url>
      
        <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>å› ä¸ºOpenVpnå­˜åœ¨æ–­å¼€é‡è¿çš„æœºåˆ¶ï¼Œå¦‚æœçªç„¶å‡ºç°ç½‘ç»œæŠ–åŠ¨ï¼Œç”¨æˆ·ç«¯æ²¡æœ‰è§¦å‘æ–­å¼€å‘½ä»¤ï¼Œä½†æ˜¯åŒæ—¶åˆè§¦å‘äº†é‡æ–°è¿æ¥çš„å‘½ä»¤ï¼Œè¿™æ—¶å€™VPNè¿™é‡Œå°±ä¼šé‡æ–°ç»™ä¸‹å‘ä¸€ä¸ªæ–°çš„åœ°å€ï¼Œä½†æ˜¯è€çš„åœ°å€ä¸ä¼šå›æ”¶æ‰ï¼Œè¿™ä¸ªä¹Ÿæ˜¯å¾ˆæ—©ä¹‹å‰DHCPè¢«ç”¨å®Œçš„çœŸæ­£åŸå› </p><span id="more"></span><h1 id="å¤„ç†æ–¹å¼"><a href="#å¤„ç†æ–¹å¼" class="headerlink" title="å¤„ç†æ–¹å¼"></a>å¤„ç†æ–¹å¼</h1><p>åœ¨æ¯ä¸€å°openvpnçš„æœºå™¨ä¸Šæ–°å¢ä¸€ä¸ªshellè„šæœ¬åšå®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©ä¸´æ™¨2ç‚¹å¼€å§‹å¾ªç¯éå†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">IFS=$<span class="string">&#x27;\n&#x27;</span> <span class="comment"># ä¿®æ”¹é»˜è®¤åˆ†éš”ç¬¦</span></span><br><span class="line">OLDIFS=<span class="string">&quot;<span class="variable">$IFS</span>&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># æ¸…ç†æ— æ•ˆçš„IPåœ°å€</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">clearIp</span></span>()&#123;</span><br><span class="line">    <span class="comment"># å–å‡ºå½“å‰å·²ç»åˆ†é…ä¸‹å»çš„æ‰€æœ‰IPåœ°å€</span></span><br><span class="line">    result=$(curl -s <span class="string">&quot;åç«¯è·å–å½“å‰ä½¿ç”¨IPçš„æ¥å£åœ°å€&quot;</span>);</span><br><span class="line">    ipList=`<span class="built_in">echo</span> <span class="variable">$result</span> | jq <span class="string">&#x27;.d.result&#x27;</span>`;</span><br><span class="line">    ipListLength=`<span class="built_in">echo</span> <span class="variable">$ipList</span> | jq <span class="string">&#x27;.|length&#x27;</span>`;</span><br><span class="line">    <span class="built_in">date</span>=`<span class="built_in">date</span> <span class="string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span>`</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># å¾ªç¯æ‰€æœ‰çš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> `<span class="built_in">seq</span> 0 <span class="variable">$ipListLength</span>`</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        ip=`<span class="built_in">echo</span> <span class="variable">$ipList</span> | jq -r <span class="string">&quot;.[<span class="variable">$index</span>].ip&quot;</span>`;</span><br><span class="line">        common_name=`<span class="built_in">echo</span> <span class="variable">$ipList</span> | jq -r <span class="string">&quot;.[<span class="variable">$index</span>].user&quot;</span>`</span><br><span class="line">        <span class="comment"># æ‹¿åˆ°å½“å‰çœŸæ­£åœ¨ä½¿ç”¨çš„IPåœ°å€</span></span><br><span class="line">        useIp=`<span class="built_in">cat</span> /var/log/openvpn/status.log | grep CLIENT_LIST | awk <span class="string">&#x27;&#123;if (NR&gt;1)&#123;print $1&#125;&#125;&#x27;</span> | <span class="built_in">cut</span> -d <span class="string">&#x27;,&#x27;</span> -f 4`</span><br><span class="line">        <span class="comment"># å¦‚æœå½“å‰IPå·²ç»ä¸åœ¨ä½¿ç”¨äº†ï¼Œé‚£ä¹ˆå°±éœ€è¦é‡Šæ”¾ï¼Œé˜²æ­¢åæœŸåœ°å€æ± ä¸å¤Ÿç”¨çš„æƒ…å†µ</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;useIp[@]&#125;</span>&quot;</span>  =~ <span class="string">&quot;<span class="variable">$&#123;ip&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;date&#125;</span> | <span class="variable">$&#123;ip&#125;</span> | å½“å‰IPå±äºä½¿ç”¨çŠ¶æ€ï¼Œæ— éœ€é‡Šæ”¾&quot;</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            curl -s <span class="string">&quot;é‡Šæ”¾IPçš„æ¥å£åœ°å€&quot;</span> &gt;&gt; /var/log/openvpn/disconnect.log</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;date&#125;</span> | <span class="variable">$&#123;ip&#125;</span> | <span class="variable">$&#123;common_name&#125;</span> | å½“å‰IPéœ€è¦é‡Šæ”¾&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment"># æ¸…ç†Iptableçš„è§„åˆ™</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">clearIptable</span></span>()&#123;</span><br><span class="line">    iptableResult=($(iptables -L | grep 10.207 | grep ACCEPT | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span>))</span><br><span class="line">    iptableResultCount=($(iptables -L | grep 10.207 | grep ACCEPT | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | <span class="built_in">wc</span> -l))</span><br><span class="line">    <span class="built_in">date</span>=`<span class="built_in">date</span> <span class="string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span>`</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> <span class="variable">$&#123;iptableResult[@]&#125;</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        ip=`<span class="built_in">echo</span> <span class="variable">$item</span> | <span class="built_in">cut</span> -d <span class="string">&#x27;-&#x27;</span> -f 2`</span><br><span class="line">        common_name=`<span class="built_in">echo</span> <span class="variable">$item</span> | <span class="built_in">cut</span> -d <span class="string">&#x27;-&#x27;</span> -f 1`</span><br><span class="line">        ifconfig_pool_remote_ip=<span class="variable">$ip</span></span><br><span class="line">        useIp=`<span class="built_in">cat</span> /var/log/openvpn/status.log | grep CLIENT_LIST | awk <span class="string">&#x27;&#123;if (NR&gt;1)&#123;print $1&#125;&#125;&#x27;</span> | <span class="built_in">cut</span> -d <span class="string">&#x27;,&#x27;</span> -f 4`</span><br><span class="line">        <span class="comment"># å¦‚æœå½“å‰IPå·²ç»ä¸åœ¨ä½¿ç”¨äº†ï¼Œé‚£ä¹ˆå°±éœ€è¦é‡Šæ”¾ï¼Œé˜²æ­¢åæœŸåœ°å€æ± ä¸å¤Ÿç”¨çš„æƒ…å†µ</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;useIp[@]&#125;</span>&quot;</span>  =~ <span class="string">&quot;<span class="variable">$&#123;ip&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;date&#125;</span> | <span class="variable">$&#123;ip&#125;</span> | å½“å‰IPå±äºä½¿ç”¨çŠ¶æ€ï¼Œæ— éœ€é‡Šæ”¾&quot;</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;date&#125;</span> | <span class="variable">$&#123;ifconfig_pool_remote_ip&#125;</span> | <span class="variable">$&#123;common_name&#125;</span> | å½“å‰IPéœ€è¦é‡Šæ”¾&quot;</span></span><br><span class="line">            /sbin/iptables -D FORWARD -s <span class="variable">$ifconfig_pool_remote_ip</span> -m <span class="built_in">set</span> --match-set <span class="variable">$&#123;common_name&#125;</span>-<span class="variable">$&#123;ifconfig_pool_remote_ip&#125;</span> dst -j ACCEPT</span><br><span class="line">            /sbin/iptables -D FORWARD -s <span class="variable">$ifconfig_pool_remote_ip</span> -m <span class="built_in">set</span> --match-set <span class="variable">$&#123;common_name&#125;</span>-<span class="variable">$&#123;ifconfig_pool_remote_ip&#125;</span>-drop dst -j DROP</span><br><span class="line">            /sbin/iptables -D FORWARD -s <span class="variable">$ifconfig_pool_remote_ip</span> -j DROP</span><br><span class="line">            /sbin/ipset destroy <span class="variable">$&#123;common_name&#125;</span>-<span class="variable">$&#123;ifconfig_pool_remote_ip&#125;</span></span><br><span class="line">            /sbin/ipset destroy <span class="variable">$&#123;common_name&#125;</span>-<span class="variable">$&#123;ifconfig_pool_remote_ip&#125;</span>-drop</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">clearIp()</span><br><span class="line">clearIptable()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> openvpn </tag>
            
            <tag> dhcp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>openvpnåŠ¨æ€ä¸‹å‘æƒé™</title>
      <link href="/2022/12/14/openvpn/openvpn-dynamic-route-permissions/"/>
      <url>/2022/12/14/openvpn/openvpn-dynamic-route-permissions/</url>
      
        <content type="html"><![CDATA[<h2 id="é¦–å…ˆäº†è§£æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦åŠ¨æ€ä¸‹å‘"><a href="#é¦–å…ˆäº†è§£æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦åŠ¨æ€ä¸‹å‘" class="headerlink" title="é¦–å…ˆäº†è§£æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦åŠ¨æ€ä¸‹å‘"></a>é¦–å…ˆäº†è§£æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦åŠ¨æ€ä¸‹å‘</h2><ul><li>å¼€æºçš„openvpnå¹¶ä¸æ”¯æŒæƒé™ç®¡ç†ï¼Œå¤§éƒ¨åˆ†åœ¨åšæƒé™ç®¡ç†çš„æ—¶å€™ä½¿ç”¨çš„éƒ½æ˜¯æ ¹æ®æ¥æºIPæˆ–IPæ®µé€šè¿‡iptables&#x2F;äº¤æ¢æœºæ¥è¿›è¡Œæƒé™æ§åˆ¶</li><li>æƒé™æ§åˆ¶å¤ªå¹¿äº†ï¼Œæ ¹æœ¬æ— æ³•å¾ˆå¥½çš„å»åšç®¡ç†åå°çš„é…ç½®ï¼Œç‰¹åˆ«æ˜¯éœ€è¦ç”¨æˆ·ç»„æ¥è¿›è¡ŒåŒºåˆ†çš„æ—¶å€™ï¼Œé‚£å°±æ›´å›°éš¾äº†<span id="more"></span></li></ul><h2 id="æƒé™ä¸‹å‘çš„é€»è¾‘"><a href="#æƒé™ä¸‹å‘çš„é€»è¾‘" class="headerlink" title="æƒé™ä¸‹å‘çš„é€»è¾‘"></a>æƒé™ä¸‹å‘çš„é€»è¾‘</h2><img  src=http://www.plantuml.com/plantuml/svg/Kr3WAiaioKbLo2z8pIiho7knVzwplgNFb-nwrjB_TFO-hkTJLZphsAwWQmTJOFMoOTQB_UrFMzSytpiHeXegmmMbTUrWIf_iw7xQFz4puEcS3K_dDhpVq_DYtRxdUzSzxLhnhA7nsTpcbpCd83H1RB9wkgxdMSS4YC40><h2 id="ç”¨åˆ°çš„æŠ€æœ¯"><a href="#ç”¨åˆ°çš„æŠ€æœ¯" class="headerlink" title="ç”¨åˆ°çš„æŠ€æœ¯"></a>ç”¨åˆ°çš„æŠ€æœ¯</h2><ul><li>ipset</li><li>iptables</li></ul><h2 id="ä¸»è¦è„šæœ¬å†…å®¹"><a href="#ä¸»è¦è„šæœ¬å†…å®¹" class="headerlink" title="ä¸»è¦è„šæœ¬å†…å®¹"></a>ä¸»è¦è„šæœ¬å†…å®¹</h2><h3 id="è¿æ¥è„šæœ¬"><a href="#è¿æ¥è„šæœ¬" class="headerlink" title="è¿æ¥è„šæœ¬"></a>è¿æ¥è„šæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/sbin/ipset create <span class="variable">$&#123;common_name&#125;</span>-<span class="variable">$&#123;common_ip&#125;</span> <span class="built_in">hash</span>:ip</span><br><span class="line">/sbin/ipset create <span class="variable">$&#123;common_name&#125;</span>-<span class="variable">$&#123;common_ip&#125;</span>-drop <span class="built_in">hash</span>:ip</span><br><span class="line"><span class="comment"># è¿™é‡Œæ˜¯åŠ¨æ€å»ä½ çš„åç«¯è·å–å‡ºæ¥çš„å…è®¸è®¿é—®çš„åˆ—è¡¨ï¼Œæ¥å£è‡ªå·±å»å®ç°</span></span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> `<span class="built_in">seq</span> 0 <span class="variable">$permissionsAcceptLength</span>`; <span class="keyword">do</span></span><br><span class="line">    /sbin/ipset add <span class="variable">$&#123;common_name&#125;</span>-<span class="variable">$&#123;common_ip&#125;</span> <span class="variable">$&#123;permissionsAccept[$index]//\&quot;/&#125;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> `<span class="built_in">seq</span> 0 <span class="variable">$permissionsDropLength</span>`; <span class="keyword">do</span></span><br><span class="line">    /sbin/ipset add <span class="variable">$&#123;common_name&#125;</span>-<span class="variable">$&#123;common_ip&#125;</span>-drop <span class="variable">$&#123;permissionsDrop[$index]//\&quot;/&#125;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment"># è®¾ç½®iptables</span></span><br><span class="line">/sbin/iptables -A FORWARD -s <span class="variable">$common_ip</span> -m <span class="built_in">set</span> --match-set <span class="variable">$&#123;common_name&#125;</span>-<span class="variable">$&#123;common_ip&#125;</span> dst -j ACCEPT</span><br><span class="line">/sbin/iptables -A FORWARD -s <span class="variable">$common_ip</span> -m <span class="built_in">set</span> --match-set <span class="variable">$&#123;common_name&#125;</span>-<span class="variable">$&#123;common_ip&#125;</span>-drop dst -j DROP</span><br><span class="line">/sbin/iptables -A FORWARD -s <span class="variable">$common_ip</span> -j DROP</span><br></pre></td></tr></table></figure><h3 id="æ–­å¼€è„šæœ¬"><a href="#æ–­å¼€è„šæœ¬" class="headerlink" title="æ–­å¼€è„šæœ¬"></a>æ–­å¼€è„šæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/sbin/iptables -D FORWARD -s <span class="variable">$ifconfig_pool_remote_ip</span> -m <span class="built_in">set</span> --match-set <span class="variable">$&#123;common_name&#125;</span>-<span class="variable">$&#123;ifconfig_pool_remote_ip&#125;</span> dst -j ACCEPT</span><br><span class="line">/sbin/iptables -D FORWARD -s <span class="variable">$ifconfig_pool_remote_ip</span> -m <span class="built_in">set</span> --match-set <span class="variable">$&#123;common_name&#125;</span>-<span class="variable">$&#123;ifconfig_pool_remote_ip&#125;</span>-drop dst -j DROP</span><br><span class="line">/sbin/iptables -D FORWARD -s <span class="variable">$ifconfig_pool_remote_ip</span> -j DROP</span><br><span class="line">/sbin/ipset destroy <span class="variable">$&#123;common_name&#125;</span>-<span class="variable">$&#123;ifconfig_pool_remote_ip&#125;</span></span><br><span class="line">/sbin/ipset destroy <span class="variable">$&#123;common_name&#125;</span>-<span class="variable">$&#123;ifconfig_pool_remote_ip&#125;</span>-drop</span><br></pre></td></tr></table></figure><h2 id="å¦‚æœåœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­å‡ºç°è„šæœ¬æƒé™ä¸è¶³"><a href="#å¦‚æœåœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­å‡ºç°è„šæœ¬æƒé™ä¸è¶³" class="headerlink" title="å¦‚æœåœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­å‡ºç°è„šæœ¬æƒé™ä¸è¶³"></a>å¦‚æœåœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­å‡ºç°è„šæœ¬æƒé™ä¸è¶³</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 766 connect.sh disconnect.sh</span><br><span class="line"><span class="built_in">chmod</span> a+x connect.sh disconnect.sh</span><br><span class="line"><span class="built_in">chmod</span> +s connect.sh disconnect.sh</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> openvpn </tag>
            
            <tag> æƒé™ </tag>
            
            <tag> åŠ¨æ€ä¸‹å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zabbix è­¦æŠ¥æ¨é€è‡³ä¼ä¸šå¾®ä¿¡ï¼ˆå›¾æ–‡ç‰ˆï¼‰</title>
      <link href="/2022/12/13/zabbix/zabbix-wecom/"/>
      <url>/2022/12/13/zabbix/zabbix-wecom/</url>
      
        <content type="html"><![CDATA[<h2 id="æ–°å¢Pythonè„šæœ¬"><a href="#æ–°å¢Pythonè„šæœ¬" class="headerlink" title="æ–°å¢Pythonè„šæœ¬"></a>æ–°å¢Pythonè„šæœ¬</h2><span id="more"></span><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"> </span><br><span class="line">url = <span class="string">&#x27;http://10.1.1.59/zabbix/api_jsonrpc.php&#x27;</span></span><br><span class="line">headers = &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json-rpc&#x27;</span>&#125;</span><br><span class="line">graph_path = <span class="string">&#x27;/data/zabbix/images/&#x27;</span>  <span class="comment"># å®šä¹‰å›¾ç‰‡å­˜å‚¨è·¯å¾„</span></span><br><span class="line">graph_url = <span class="string">&#x27;http://10.1.1.59/zabbix/chart.php&#x27;</span>  <span class="comment"># å®šä¹‰å›¾è¡¨çš„url</span></span><br><span class="line">loginurl = <span class="string">&quot;http://10.1.1.59/zabbix/index.php&quot;</span>  <span class="comment"># å®šä¹‰ç™»å½•çš„url</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uploadImg</span>(<span class="params">path,accessToken</span>):</span><br><span class="line">    <span class="comment">#img_url = &quot;https://qyapi.weixin.qq.com/cgi-bin/webhook/upload_media?key=&quot; + key + &quot;&amp;type=file&quot;</span></span><br><span class="line">    img_url = <span class="string">&quot;https://qyapi.weixin.qq.com/cgi-bin/media/uploadimg?access_token=&quot;</span>+accessToken</span><br><span class="line">    files = &#123;<span class="string">&#x27;media&#x27;</span>: <span class="built_in">open</span>(path, <span class="string">&#x27;rb&#x27;</span>)&#125;</span><br><span class="line">    r = requests.post(img_url, files=files)</span><br><span class="line">    re = json.loads(r.text)</span><br><span class="line">    <span class="built_in">print</span>(re)</span><br><span class="line">    <span class="keyword">return</span> re[<span class="string">&#x27;url&#x27;</span>]</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_itemid</span>(<span class="params">message</span>):</span><br><span class="line">    <span class="comment">#print(message)</span></span><br><span class="line">    itemid = re.search(<span class="string">r&#x27;ITEMID:(\d+)&#x27;</span>, message).group(<span class="number">1</span>)</span><br><span class="line">    <span class="comment">#itemid = 1</span></span><br><span class="line">    <span class="keyword">return</span> itemid</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_imgUrl</span>(<span class="params">itemid</span>):</span><br><span class="line">    session = requests.Session()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        loginheaders = &#123;</span><br><span class="line">            <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;10.1.1.59&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># å®šä¹‰è¯·æ±‚æ¶ˆæ¯å¤´</span></span><br><span class="line"> </span><br><span class="line">        payload = &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&#x27;yantao&#x27;</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="string">&#x27;xxxxxxx&#x27;</span>,</span><br><span class="line">            <span class="string">&quot;autologin&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;enter&quot;</span>: <span class="string">&quot;Sign in&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># å®šä¹‰ä¼ å…¥çš„data</span></span><br><span class="line">        login = session.post(url=loginurl, headers=loginheaders, data=payload)</span><br><span class="line">        <span class="built_in">print</span>(login)</span><br><span class="line">        graph_params = &#123;</span><br><span class="line">            <span class="string">&quot;from&quot;</span>: <span class="string">&quot;now-10m&quot;</span>,</span><br><span class="line">            <span class="string">&quot;to&quot;</span>: <span class="string">&quot;now&quot;</span>,</span><br><span class="line">            <span class="string">&quot;itemids&quot;</span>: itemid,</span><br><span class="line">            <span class="string">&quot;width&quot;</span>: <span class="string">&quot;400&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># å®šä¹‰è·å–å›¾ç‰‡çš„å‚æ•°</span></span><br><span class="line">        graph_req = session.get(url=graph_url, params=graph_params)</span><br><span class="line">        <span class="comment"># å‘é€getè¯·æ±‚è·å–å›¾ç‰‡æ•°æ®</span></span><br><span class="line">        time_tag = time.strftime(<span class="string">&quot;%Y%m%d%H%M%S&quot;</span>, time.localtime())</span><br><span class="line">        graph_name = <span class="string">&#x27;baojing_&#x27;</span> + time_tag + <span class="string">&#x27;.png&#x27;</span></span><br><span class="line">        <span class="comment"># ç”¨æŠ¥è­¦æ—¶é—´æ¥ä½œä¸ºå›¾ç‰‡åè¿›è¡Œä¿å­˜</span></span><br><span class="line">        graph_name = os.path.join(graph_path, graph_name)</span><br><span class="line">        <span class="comment"># ä½¿ç”¨ç»å¯¹è·¯å¾„ä¿å­˜å›¾ç‰‡</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(graph_name, <span class="string">&#x27;wb&#x27;</span>, ) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(graph_req.content)</span><br><span class="line">            <span class="comment"># å°†è·å–åˆ°çš„å›¾ç‰‡æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­å»</span></span><br><span class="line">        <span class="keyword">return</span> graph_name</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getAccessToken</span>():</span><br><span class="line">    api_url = <span class="string">&quot;https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=corpid&amp;corpsecret=corpsecret&quot;</span></span><br><span class="line">    content = requests.get(api_url)</span><br><span class="line">    <span class="comment">#print(content.json())</span></span><br><span class="line">    <span class="keyword">return</span> content.json().get(<span class="string">&quot;access_token&quot;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getImgUrl</span>(<span class="params">mediaId,accessToken</span>):</span><br><span class="line">    api_url = <span class="string">&quot;https://qyapi.weixin.qq.com/cgi-bin/media/get?access_token=&quot;</span>+accessToken+<span class="string">&quot;&amp;media_id=&quot;</span>+mediaId</span><br><span class="line">    content = requests.get(api_url)</span><br><span class="line">    <span class="built_in">print</span>(mediaId)</span><br><span class="line">    <span class="built_in">print</span>(content.json())</span><br><span class="line">    <span class="keyword">return</span> content.json().get(<span class="string">&quot;url&quot;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_message</span>(<span class="params">imgUrl,title,desc,openUrl,key</span>):</span><br><span class="line">    <span class="comment"># å‘é€æ¶ˆæ¯</span></span><br><span class="line">    url = <span class="string">&quot;https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=&quot;</span> + key</span><br><span class="line">    <span class="comment"># message = title  # sys.argv[3]</span></span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&quot;msgtype&quot;</span>: <span class="string">&quot;template_card&quot;</span>,</span><br><span class="line">        <span class="string">&quot;template_card&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;card_type&quot;</span>: <span class="string">&quot;news_notice&quot;</span>,</span><br><span class="line">            <span class="string">&quot;source&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;desc&quot;</span>: <span class="string">&quot;Zabbixç½‘ç»œè­¦æŠ¥&quot;</span>,</span><br><span class="line">                <span class="string">&quot;desc_color&quot;</span>: <span class="number">0</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;main_title&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;title&quot;</span>:<span class="string">&quot;Zabbixç½‘ç»œè­¦æŠ¥&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;quote_area&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;type&quot;</span>:<span class="number">0</span>,</span><br><span class="line">                <span class="string">&quot;quote_text&quot;</span>:desc</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;card_image&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;url&quot;</span>: imgUrl</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;card_action&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;url&quot;</span>: openUrl,</span><br><span class="line">                <span class="string">&quot;appid&quot;</span>: <span class="string">&quot;APPID&quot;</span>,</span><br><span class="line">                <span class="string">&quot;pagepath&quot;</span>: <span class="string">&quot;PAGEPATH&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    req = requests.post(url, data=json.dumps(params))</span><br><span class="line">    <span class="built_in">print</span>(req.json())</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    message = sys.argv[<span class="number">1</span>]</span><br><span class="line">    <span class="built_in">print</span>(message)</span><br><span class="line">    itemid = get_itemid(message)</span><br><span class="line">    imgpath = get_imgUrl(itemid)</span><br><span class="line">    accessToken = getAccessToken();</span><br><span class="line">    imgUrl = uploadImg(imgpath,accessToken)</span><br><span class="line">    <span class="comment">#print(itemid)</span></span><br><span class="line">    <span class="comment">#print(imgpath)</span></span><br><span class="line">    <span class="built_in">print</span>(imgUrl)</span><br><span class="line">    send_message(imgUrl,sys.argv[<span class="number">2</span>],sys.argv[<span class="number">3</span>],imgUrl,sys.argv[<span class="number">4</span>])</span><br><span class="line">    <span class="comment">#accessToken = getAccessToken()</span></span><br></pre></td></tr></table></figure><h2 id="æ–°å¢SHè„šæœ¬"><a href="#æ–°å¢SHè„šæœ¬" class="headerlink" title="æ–°å¢SHè„šæœ¬"></a>æ–°å¢SHè„šæœ¬</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">echo $1 &gt;&gt; /data/zabbix/log.log</span><br><span class="line">python /usr/lib/zabbix/alertscripts/wxcom.py $1 $2 $3 $4</span><br></pre></td></tr></table></figure><p>æŠŠä¸¤ä¸ªæ–‡ä»¶éƒ½æ”¾åˆ°è¿™ä¸ªç›®å½•ä¸‹ï¼š&#x2F;usr&#x2F;lib&#x2F;zabbix&#x2F;alertscripts&#x2F;</p><h2 id="é…ç½®åª’ä»‹"><a href="#é…ç½®åª’ä»‹" class="headerlink" title="é…ç½®åª’ä»‹"></a>é…ç½®åª’ä»‹</h2>]]></content>
      
      
      
        <tags>
            
            <tag> zabbix </tag>
            
            <tag> ä¼ä¸šå¾®ä¿¡ </tag>
            
            <tag> æŠ¥è­¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®‰è£…&amp;ç ´è§£Openvpn Access Server</title>
      <link href="/2022/12/13/openvpn/openvpn-access-server/"/>
      <url>/2022/12/13/openvpn/openvpn-access-server/</url>
      
        <content type="html"><![CDATA[<h2 id="åœ¨çº¿å®‰è£…ï¼ˆéœ€è¦ç¿»å¢™ï¼‰"><a href="#åœ¨çº¿å®‰è£…ï¼ˆéœ€è¦ç¿»å¢™ï¼‰" class="headerlink" title="åœ¨çº¿å®‰è£…ï¼ˆéœ€è¦ç¿»å¢™ï¼‰"></a>åœ¨çº¿å®‰è£…ï¼ˆéœ€è¦ç¿»å¢™ï¼‰</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install https://as-repository.openvpn.net/as-repo-centos7.rpm</span><br><span class="line">yum -y install openvpn-as</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="ç®¡ç†å‘˜ç™»å½•"><a href="#ç®¡ç†å‘˜ç™»å½•" class="headerlink" title="ç®¡ç†å‘˜ç™»å½•"></a>ç®¡ç†å‘˜ç™»å½•</h2><p>é¦–å…ˆéœ€è¦ä¿®æ”¹ç®¡ç†å‘˜å¯†ç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd openvpn</span><br></pre></td></tr></table></figure><p>è¾“å…¥ä¹‹åå¯ä»¥ç™»å½•ç®¡ç†å‘˜é¡µé¢äº†ã€‚</p><p>å¦‚æœå¯†ç ä¸€ç›´é”™è¯¯çš„è¯ï¼Œè¯´æ˜ä¿®æ”¹å¤±è´¥äº†ï¼Œå¯ä»¥æŸ¥çœ‹ä¸‹åŸæ¥çš„å¯†ç æ˜¯ä»€ä¹ˆ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/local/openvpn_as/init.log</span><br></pre></td></tr></table></figure><p>ç™»å½•åç‚¹å‡»User Managementâ€“&gt;User Permissions æ·»åŠ ç”¨æˆ·</p><h2 id="ç ´è§£ç”¨æˆ·æ•°"><a href="#ç ´è§£ç”¨æˆ·æ•°" class="headerlink" title="ç ´è§£ç”¨æˆ·æ•°"></a>ç ´è§£ç”¨æˆ·æ•°</h2><ul><li>ä¸»è¦æ“ä½œçš„æ–‡ä»¶æ˜¯ä¸€ä¸ªåå«Â <code>pyovpn-2.0-pyx.x.egg</code>Â çš„æ–‡ä»¶ï¼Œä»¥æˆ‘äº†è§£çš„æƒ…å†µæ¥çœ‹ï¼Œä»Â <code>2.5.0</code>Â åˆ°Â <code>2.9.x</code>Â æ–‡ä»¶åä¸€ç›´éƒ½æ˜¯è¿™ä¸ªï¼Œåªæ˜¯ä¸åŒç‰ˆæœ¬é‡Œé¢çš„å†…å®¹ä¸ä¸€æ ·.</li><li>è¿™ä¸ªæ–‡ä»¶æœ‰ç‚¹ç±»ä¼¼Â <code>Java</code>Â å½“ä¸­çš„Â <code>jar</code>Â åº“æ–‡ä»¶ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªÂ <code>zip</code>Â å‹ç¼©æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«äº†ä¸€äº›Â <code>Python</code>Â çš„å­—èŠ‚ç æ–‡ä»¶.</li><li>ç ´è§£çš„åŸç†å¤§æ¦‚æ˜¯åœ¨Â <code>Python</code>Â ä¸­é‡‡ç”¨ç±»ä¼¼Â <code>Java</code>Â åŠ¨æ€ä»£ç†çš„æŠ€æœ¯ï¼Œå°†åŸæœ¬è¯»å–ç”¨æˆ·å±æ€§çš„è°ƒç”¨è¿”å›å€¼æ‹¦æˆªï¼Œä¿®æ”¹ç”¨æˆ·é™åˆ¶æ•°é‡å†è¿”å›.</li></ul><h3 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h3><p><code>2.9.0</code> ä»¥ä¸‹ç‰ˆæœ¬ç ´è§£çš„ç›®æ ‡æ–‡ä»¶æ˜¯ <code>/pyovpn/lic/uprop.pyo</code>, <code>2.9.0</code> åŠä»¥ä¸Šæ˜¯ <code>/pyovpn/lic/uprop.pyc</code>; æŒ‰ç…§ç½‘ä¸Šæµè¡Œçš„ç ´è§£æ–¹æ³•ï¼ŒæŠŠè¿™ä¸ªæ–‡ä»¶è§£å‹å‡ºæ¥å¹¶æ”¹åä¸º <code>uprop2.pyo</code> æˆ– <code>uprop2.pyc</code>, ç„¶åæ–°å»ºä¸€ä¸ª <code>uprop.py</code> æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹:</p><p><code>**2.9.0**</code><strong>ä»¥ä¸‹ç‰ˆæœ¬å†…å®¹:</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import uprop2</span><br><span class="line">old_figure = None</span><br><span class="line"></span><br><span class="line">def new_figure(self, licdict):</span><br><span class="line">    ret = old_figure(self, licdict)</span><br><span class="line">    ret[&#x27;concurrent_connections&#x27;] = 1024</span><br><span class="line">    return ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for x in dir(uprop2):</span><br><span class="line">    if x[:2] == &#x27;__&#x27;:</span><br><span class="line">        continue</span><br><span class="line">    if x == &#x27;UsageProperties&#x27;:</span><br><span class="line">        exec(&#x27;old_figure = uprop2.UsageProperties.figure&#x27;)</span><br><span class="line">        exec(&#x27;uprop2.UsageProperties.figure = new_figure&#x27;)</span><br><span class="line">    exec(&#x27;%s = uprop2.%s&#x27; % (x, x))</span><br></pre></td></tr></table></figure><p><code>**2.9.0**</code><strong>åŠä»¥ä¸Šç‰ˆæœ¬å†…å®¹:</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">from pyovpn.lic import uprop2</span><br><span class="line">old_figure = None</span><br><span class="line"></span><br><span class="line">def new_figure(self, licdict):</span><br><span class="line">    ret = old_figure(self, licdict)</span><br><span class="line">    ret[&#x27;concurrent_connections&#x27;] = 1024</span><br><span class="line">    return ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for x in dir(uprop2):</span><br><span class="line">    if x[:2] == &#x27;__&#x27;:</span><br><span class="line">        continue</span><br><span class="line">    if x == &#x27;UsageProperties&#x27;:</span><br><span class="line">        exec(&#x27;old_figure = uprop2.UsageProperties.figure&#x27;)</span><br><span class="line">        exec(&#x27;uprop2.UsageProperties.figure = new_figure&#x27;)</span><br><span class="line">    exec(&#x27;%s = uprop2.%s&#x27; % (x, x))</span><br></pre></td></tr></table></figure><p>å†å°†ä¸Šé¢çš„Â <code>uprop.py</code>Â ç¼–è¯‘ä¸ºåº“æ–‡ä»¶Â <code>uprop.pyo</code>Â æˆ–Â <code>uprop.pyc</code>:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">&lt;2.9.0</span></span><br><span class="line">python2 -O -m compileall uprop.py</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">&gt;=2.9.0</span></span><br><span class="line">python3 -O -m compileall uprop.py &amp;&amp; mv __pycache__/uprop.cpython-37.opt-1.pyc uprop.pyc</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„Â <code>uprop.cpython-37.opt-1.pyc</code>Â æ–‡ä»¶åä¼šéšç€Â <code>python</code>Â ç‰ˆæœ¬å˜åŒ–è€Œå˜åŒ–.</p></blockquote><p>ç°åœ¨æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªæ”¹æ–‡ä»¶åçš„æ–‡ä»¶ <code>uprop2.pyo</code> æˆ– <code>uprop2.pyc</code>, å’Œä¸€ä¸ªç¼–è¯‘å‡ºæ¥çš„ <code>uprop.pyo</code> æˆ– <code>uprop.pyc</code>; æŠŠè¿™ä¸¤ä¸ªæ–‡ä»¶å‹ç¼©åˆ° <code>pyovpn-2.0-pyx.x.egg</code> çš„ <code>/pyovpn/lic/</code> ç›®å½•ä¸‹ï¼Œç„¶åå»æœåŠ¡å™¨æ›¿æ¢ç›®æ ‡æ–‡ä»¶ï¼Œé‡å¯æœåŠ¡å°± OK äº†.</p><h2 id="æ‰€æœ‰çš„æ“ä½œå‘½ä»¤"><a href="#æ‰€æœ‰çš„æ“ä½œå‘½ä»¤" class="headerlink" title="æ‰€æœ‰çš„æ“ä½œå‘½ä»¤"></a>æ‰€æœ‰çš„æ“ä½œå‘½ä»¤</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŠŠæ“ä½œçš„æ–‡ä»¶å¤åˆ¶å‡ºæ¥åˆ°å¦å¤–çš„ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢æ“ä½œ</span></span><br><span class="line">cd /usr/local/openvpn_as/lib/python &amp; mkdir pojie &amp; cp python/pyovpn-2.0-py3.6.egg ./pojie &amp; cd pojie/</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ”¹ä¸€ä¸ªæ–‡ä»¶åï¼Œé˜²æ­¢åé¢æ‰“åŒ…çš„æ—¶å€™æŠŠæºæ–‡ä»¶è¦†ç›–äº†</span></span><br><span class="line">mv pyovpn-2.0-py3.6.egg pyovpn-2.0-py3.6.egg.bak &amp; unzip pyovpn-2.0-py3.6.egg.bak</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥åˆ°éœ€è¦ä¿®æ”¹çš„ç›®å½•</span></span><br><span class="line">cd pyovpn/lic</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¤åˆ¶æºæ–‡ä»¶æ”¹å</span></span><br><span class="line">mv uprop.pyc uprop2.pyc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ–°å¢ä¸€ä¸ªpyæ–‡ä»¶ï¼Œç„¶åæŠŠæ–‡ä»¶å†…å®¹å¤åˆ¶è¿›å»ï¼Œå¹¶ä¿å­˜</span></span><br><span class="line">vi uprop.py</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é€€åˆ° pojie æ–‡ä»¶å¤¹ï¼Œè¿›è¡Œæ‰“åŒ…</span></span><br><span class="line">zip -r pyovpn-2.0-py3.6.egg EGG-INFO/ common/ pyovpn/</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¤åˆ¶æ–‡ä»¶åˆ°è¿è¡Œç›®å½•ï¼Œè¦†ç›–</span></span><br><span class="line">cp pyovpn-2.0-py3.6.egg /usr/local/openvpn_as/lib/python</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é‡å¯æœåŠ¡</span></span><br><span class="line">systemctl restart openvpnas</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 2.9.0 </tag>
            
            <tag> openvpn </tag>
            
            <tag> openvpn access server </tag>
            
            <tag> ç ´è§£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é€šè¿‡ Haproxy å®ç° Shadowshadows è´Ÿè½½å‡è¡¡</title>
      <link href="/2022/12/13/haproxy-load/"/>
      <url>/2022/12/13/haproxy-load/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>ç¼ºç‚¹ï¼šæ‰€æœ‰çš„SSçš„åŠ å¯†æ–¹å¼å’Œå¯†ç å¿…é¡»ä¸€è‡´<br>ä»‹ç»ï¼šHAProxyæ˜¯ä¸€ä¸ªä½¿ç”¨Cè¯­è¨€ç¼–å†™çš„è‡ªç”±åŠå¼€æ”¾åŸå§‹ç è½¯ä»¶ï¼Œå…¶æä¾›é«˜å¯ç”¨æ€§ã€è´Ÿè½½å‡è¡¡ï¼Œä»¥åŠåŸºäºTCPå’ŒHTTPçš„åº”ç”¨ç¨‹åºä»£ç†ã€‚</p><span id="more"></span><h2 id="å®‰è£…Haproxy"><a href="#å®‰è£…Haproxy" class="headerlink" title="å®‰è£…Haproxy"></a>å®‰è£…Haproxy</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install haproxy</span><br></pre></td></tr></table></figure><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">global</span><br><span class="line">    chroot  /var/lib/haproxy</span><br><span class="line">    pidfile /var/run/haproxy.pid</span><br><span class="line">    user    haproxy</span><br><span class="line">    group   haproxy</span><br><span class="line">defaults</span><br><span class="line">    mode    tcp                         #æœåŠ¡å™¨é»˜è®¤çš„å·¥ä½œæ¨¡å¼</span><br><span class="line">    balance roundrobin                  #æœåŠ¡å™¨é»˜è®¤ä½¿ç”¨çš„å‡è¡¡æ¨¡å¼</span><br><span class="line">    retries 3                           #ä¸‰æ¬¡è¿æ¥å¤±è´¥è¡¨ç¤ºæœåŠ¡å™¨ä¸å¯ç”¨</span><br><span class="line">    maxconn 5000                        #æœ€å¤§è¿æ¥æ•°</span><br><span class="line">    timeout connect 500ms               #è¿æ¥è¶…æ—¶</span><br><span class="line">    timeout client  3s                  #å®¢æˆ·ç«¯è¶…æ—¶</span><br><span class="line">    timeout server  3s                  #æœåŠ¡å™¨è¶…æ—¶</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">listen WebPanel</span><br><span class="line">    mode    http                        #è¿™é‡Œä½¿ç”¨HTTPæ¨¡å¼</span><br><span class="line">    bind    10.1.1.58:9595               #WEBæœåŠ¡ç«¯å£</span><br><span class="line">    stats   refresh 5s                  #è‡ªåŠ¨åˆ·æ–°æ—¶é—´</span><br><span class="line">    stats   uri  /                      #WEBç®¡ç†åœ°å€</span><br><span class="line">    stats   auth admin:xxxx         #è´¦å·å¯†ç </span><br><span class="line">    stats   hide-version                #éšè—ç‰ˆæœ¬</span><br><span class="line">    stats   admin if TRUE               #éªŒè¯é€šè¿‡åˆ™èµ‹äºˆç®¡ç†æƒ</span><br><span class="line"></span><br><span class="line">frontend shadowsocks-in</span><br><span class="line">    bind *:50001</span><br><span class="line">    default_backend servers</span><br><span class="line"></span><br><span class="line">backend servers</span><br><span class="line">    mode tcp</span><br><span class="line">    balance roundrobin</span><br><span class="line">    # option external-check</span><br><span class="line">    option tcp-check</span><br><span class="line">    # external-check command &quot;/etc/haproxy/haproxy-shadowsocks-checker.py&quot;</span><br><span class="line"></span><br><span class="line">    server ss1 43.156.100.84:2195 check inter 500 rise 2 fall 4 weight 100   #SS/SSRæœåŠ¡å™¨åœ°å€ä¸ç«¯å£</span><br><span class="line">    server ss2 42.157.192.42:10108 check inter 500 rise 2 fall 4 weight 100</span><br></pre></td></tr></table></figure><p><code>server</code>ï¼šåé¢é¦–å…ˆè·Ÿåå­—ï¼Œåå­—éšä¾¿èµ·å‘—ï¼Œè‡ªå·±èƒ½å¤ŸåŒºåˆ†å°±è¡Œã€‚ç´§æ¥ç€è·ŸSSçš„å…¬ç½‘IP+ç«¯å£ï¼Œç«¯å£ä¹Ÿå°±æ˜¯SS&#x2F;SSRçš„ç«¯å£ã€‚<br><code>check</code>ï¼šæ˜¯æ£€æµ‹çš„æ„æ€ï¼Œè¿™æ®µé…ç½®å¾ˆé‡è¦<br><code>inter</code>ï¼šå•ä½æ¯«ç§’ï¼Œæˆ‘é…ç½®çš„500ï¼Œå³500æ¯«ç§’æ£€æµ‹ä¸€æ¬¡ç›®æ ‡æœåŠ¡å™¨ã€‚<br><code>rise2</code>ï¼šè®¾å®šå¥åº·çŠ¶æ€æ£€æŸ¥ä¸­ï¼ŒæŸç¦»çº¿çš„æœåŠ¡å™¨ä»ç¦»çº¿çŠ¶æ€è½¬æ¢è‡³æ­£å¸¸çŠ¶æ€éœ€è¦æˆåŠŸæ£€æŸ¥çš„æ¬¡æ•°ï¼Œè¿™é‡Œæˆ‘è®¾ç½®çš„2æ¬¡ã€‚<br><code>fall4</code>ï¼šç¡®è®¤æœåŠ¡å™¨ä»æ­£å¸¸çŠ¶æ€è½¬æ¢ä¸ºä¸å¯ç”¨çŠ¶æ€éœ€è¦æ£€æŸ¥çš„æ¬¡æ•°ï¼Œè¿™é‡Œæ˜¯4æ¬¡ã€‚<br><code>weight</code>ï¼šæƒé‡ï¼Œå€¼è¶Šå¤§ä»£è¡¨è¿™å°æœºå™¨å·¥ä½œçš„æœºä¼šè¶Šå¤šï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€å°çº¿è·¯è¾ƒå¥½çš„æœºå™¨çš„æƒé‡è®¾ç½®é«˜ä¸€äº›ã€‚<br><code>balance</code>ï¼šè´Ÿè½½å‡è¡¡æ–¹å¼</p><ul><li>roundrobinï¼šåŸºäºæƒé‡è¿›è¡Œè½®å«ï¼Œåœ¨æœåŠ¡å™¨çš„å¤„ç†æ—¶é—´ä¿æŒå‡åŒ€åˆ†å¸ƒæ—¶ï¼Œè¿™æ˜¯æœ€å¹³è¡¡ã€æœ€å…¬å¹³çš„ç®—æ³•ã€‚æ­¤ç®—æ³•æ˜¯åŠ¨æ€çš„ï¼Œè¿™è¡¨ç¤ºå…¶æƒé‡å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œè°ƒæ•´ï¼Œä¸è¿‡ï¼Œåœ¨è®¾è®¡ä¸Šï¼Œæ¯ä¸ªåç«¯æœåŠ¡å™¨ä»…èƒ½æœ€å¤šæ¥å—4128ä¸ªè¿æ¥ï¼›</li><li>static-rrï¼šåŸºäºæƒé‡è¿›è¡Œè½®å«ï¼Œä¸roundrobinç±»ä¼¼ï¼Œä½†æ˜¯ä¸ºé™æ€æ–¹æ³•ï¼Œåœ¨è¿è¡Œæ—¶è°ƒæ•´å…¶æœåŠ¡å™¨æƒé‡ä¸ä¼šç”Ÿæ•ˆï¼›ä¸è¿‡ï¼Œå…¶åœ¨åç«¯æœåŠ¡å™¨è¿æ¥æ•°ä¸Šæ²¡æœ‰é™åˆ¶ï¼›</li><li>leastconnï¼šæ–°çš„è¿æ¥è¯·æ±‚è¢«æ´¾å‘è‡³å…·æœ‰æœ€å°‘è¿æ¥æ•°ç›®çš„åç«¯æœåŠ¡å™¨ï¼›åœ¨æœ‰ç€è¾ƒé•¿æ—¶é—´ä¼šè¯çš„åœºæ™¯ä¸­æ¨èä½¿ç”¨æ­¤ç®—æ³•ï¼Œå¦‚LDAPã€SQLç­‰ï¼Œå…¶å¹¶ä¸å¤ªé€‚ç”¨äºè¾ƒçŸ­ä¼šè¯çš„åº”ç”¨å±‚åè®®ï¼Œå¦‚HTTPï¼›æ­¤ç®—æ³•æ˜¯åŠ¨æ€çš„ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶è°ƒæ•´å…¶æƒé‡ï¼›</li><li>sourceï¼šå°†è¯·æ±‚çš„æºåœ°å€è¿›è¡Œhashè¿ç®—ï¼Œå¹¶ç”±åç«¯æœåŠ¡å™¨çš„æƒé‡æ€»æ•°ç›¸é™¤åæ´¾å‘è‡³æŸåŒ¹é…çš„æœåŠ¡å™¨ï¼›è¿™å¯ä»¥ä½¿å¾—åŒä¸€ä¸ªå®¢æˆ·ç«¯IPçš„è¯·æ±‚å§‹ç»ˆè¢«æ´¾å‘è‡³æŸç‰¹å®šçš„æœåŠ¡å™¨ï¼›ä¸è¿‡ï¼Œå½“æœåŠ¡å™¨æƒé‡æ€»æ•°å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¦‚æŸæœåŠ¡å™¨å®•æœºæˆ–æ·»åŠ äº†æ–°çš„æœåŠ¡å™¨ï¼Œè®¸å¤šå®¢æˆ·ç«¯çš„è¯·æ±‚å¯èƒ½ä¼šè¢«æ´¾å‘è‡³ä¸æ­¤å‰è¯·æ±‚ä¸åŒçš„æœåŠ¡å™¨ï¼›å¸¸ç”¨äº è´Ÿè½½å‡è¡¡æ— cookieåŠŸèƒ½çš„åŸºäºTCPçš„åè®®ï¼›å…¶é»˜è®¤ä¸ºé™æ€ï¼Œä¸è¿‡ä¹Ÿå¯ä»¥ä½¿ç”¨hash-typeä¿®æ”¹æ­¤ç‰¹æ€§ï¼›</li></ul><h2 id="ä¿®æ”¹Shadowsocksé…ç½®"><a href="#ä¿®æ”¹Shadowsocksé…ç½®" class="headerlink" title="ä¿®æ”¹Shadowsocksé…ç½®"></a>ä¿®æ”¹Shadowsocksé…ç½®</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;server&quot;:&quot;127.0.0.1&quot;, # è¿™é‡Œæ”¹æˆHaproxyçš„åœ°å€</span><br><span class="line">    &quot;server_port&quot;:50001, # è¿™é‡Œæ”¹æˆHaproxyç›‘å¬çš„ç«¯å£</span><br><span class="line">    &quot;local_port&quot;:1080, # è¿™é‡Œæœ¬åœ°ç›‘å¬ç«¯å£</span><br><span class="line">    &quot;password&quot;:&quot;qunheadmin&quot;,</span><br><span class="line">    &quot;timeout&quot;:60,</span><br><span class="line">    &quot;method&quot;:&quot;aes-256-gcm&quot;,</span><br><span class="line">    &quot;mode&quot;:&quot;tcp_and_udp&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>openvpn-authï¼ˆæ”¯æŒä¼ä¸šå¾®ä¿¡è®¤è¯&amp;LDAPï¼‰</title>
      <link href="/2022/12/13/openvpn/openvpn-auth/"/>
      <url>/2022/12/13/openvpn/openvpn-auth/</url>
      
        <content type="html"><![CDATA[<h2 id="æ–¹æ¡ˆä»‹ç»"><a href="#æ–¹æ¡ˆä»‹ç»" class="headerlink" title="æ–¹æ¡ˆä»‹ç»"></a>æ–¹æ¡ˆä»‹ç»</h2><h3 id="æ—¶åºå›¾"><a href="#æ—¶åºå›¾" class="headerlink" title="æ—¶åºå›¾"></a>æ—¶åºå›¾</h3><img src="/2022/12/13/openvpn/openvpn-auth/image2022-12-12_20-11-38.png" class="" alt="openvpn-auth æ—¶åºå›¾"><span id="more"></span><h2 id="å…¶ä¸­æœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦ä¿®æ”¹"><a href="#å…¶ä¸­æœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦ä¿®æ”¹" class="headerlink" title="å…¶ä¸­æœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦ä¿®æ”¹"></a>å…¶ä¸­æœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦ä¿®æ”¹</h2><ul><li><code>corpid</code>: ä¼ä¸šå¾®ä¿¡çš„ä¼ä¸šID</li><li><code>corpsecret</code>: æ‹¥æœ‰é€šè®¯å½•çš„ä¼ä¸šå¾®ä¿¡çš„Secret</li></ul><h2 id="ä»£ç å¦‚ä¸‹"><a href="#ä»£ç å¦‚ä¸‹" class="headerlink" title="ä»£ç å¦‚ä¸‹"></a>ä»£ç å¦‚ä¸‹</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> auth</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="string">&quot;strconv&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/tidwall/gjson&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetAccessToken</span><span class="params">()</span></span> <span class="type">string</span> &#123;</span><br><span class="line"><span class="keyword">return</span> GetWecomToken()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä»ä¼ä¸šå¾®ä¿¡è·å–Token</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetWecomToken</span><span class="params">()</span></span> <span class="type">string</span> &#123;</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªè¯·æ±‚</span></span><br><span class="line">req, err := http.NewRequest(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=corpid&amp;corpsecret=corpsecret&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Println(<span class="string">&quot;NewRquest:&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">client := &amp;http.Client&#123;&#125;</span><br><span class="line"><span class="comment">//è®¾ç½®è¯·æ±‚å¤´</span></span><br><span class="line">req.Header.Set(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json; charset=utf-8&quot;</span>)</span><br><span class="line"><span class="comment">//å‘é€è¯·æ±‚</span></span><br><span class="line">resp, err := client.Do(req)</span><br><span class="line"><span class="comment">//å…³é—­è¯·æ±‚</span></span><br><span class="line"><span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line">body, err := ioutil.ReadAll(resp.Body)</span><br><span class="line">access_token := gjson.Get(<span class="type">string</span>(body), <span class="string">&quot;access_token&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> access_token.Str</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è·å–å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WeComAuth</span><span class="params">(userId <span class="type">string</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªè¯·æ±‚</span></span><br><span class="line">req, err := http.NewRequest(<span class="string">&quot;GET&quot;</span>, <span class="string">`https://qyapi.weixin.qq.com/cgi-bin/user/get?access_token=`</span>+GetAccessToken()+<span class="string">`&amp;userid=`</span>+userId, <span class="literal">nil</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Println(<span class="string">&quot;NewRquest:&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">client := &amp;http.Client&#123;&#125;</span><br><span class="line"><span class="comment">//è®¾ç½®è¯·æ±‚å¤´</span></span><br><span class="line">req.Header.Set(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json; charset=utf-8&quot;</span>)</span><br><span class="line"><span class="comment">//å‘é€è¯·æ±‚</span></span><br><span class="line">resp, err := client.Do(req)</span><br><span class="line"><span class="comment">//å…³é—­è¯·æ±‚</span></span><br><span class="line"><span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line">body, err := ioutil.ReadAll(resp.Body)</span><br><span class="line">errcode := gjson.Get(<span class="type">string</span>(body), <span class="string">&quot;errcode&quot;</span>)</span><br><span class="line"><span class="type">int</span>, err := strconv.Atoi(errcode.Str)</span><br><span class="line"><span class="keyword">return</span> <span class="type">int</span> == <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h2><p>ä¿®æ”¹<code>/etc/openvpn/server.conf</code>çš„éªŒè¯æ–¹å¼ï¼Œå¯ä»¥å§å…¶ä»–çš„éªŒè¯å»æ‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auth-user-pass-verify /etc/openvpn/openvpn-wecom-password via-file</span><br></pre></td></tr></table></figure><h2 id="åŠ è§£å¯†æ–¹å¼"><a href="#åŠ è§£å¯†æ–¹å¼" class="headerlink" title="åŠ è§£å¯†æ–¹å¼"></a>åŠ è§£å¯†æ–¹å¼</h2><p>å› ä¸ºç”¨åˆ°äº†å®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„æ—¶å€™çš„åŠ å¯†æ–¹å¼ï¼Œå› æ­¤ä¸¤è¾¹çš„åŠ å¯†æ–¹å¼å¿…é¡»ä¸€è‡´</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> util</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;bytes&quot;</span></span><br><span class="line">basicAES <span class="string">&quot;crypto/aes&quot;</span></span><br><span class="line"><span class="string">&quot;crypto/cipher&quot;</span></span><br><span class="line"><span class="string">&quot;encoding/base64&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">type</span> Aes <span class="keyword">struct</span> &#123;</span><br><span class="line">securityKey []<span class="type">byte</span></span><br><span class="line">iv          []<span class="type">byte</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * constructor</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AesTool</span><span class="params">()</span></span> *Aes &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;Aes&#123;[]<span class="type">byte</span>(<span class="string">&quot;123&quot;</span>), []<span class="type">byte</span>(<span class="string">&quot;123&quot;</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠ å¯†</span></span><br><span class="line"><span class="comment"> * @param string $plainText æ˜æ–‡</span></span><br><span class="line"><span class="comment"> * @return bool|string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a Aes)</span></span> Encrypt(plainText <span class="type">string</span>) (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">block, err := basicAES.NewCipher(a.securityKey)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line">&#125;</span><br><span class="line">plainTextByte := []<span class="type">byte</span>(plainText)</span><br><span class="line">blockSize := block.BlockSize()</span><br><span class="line">plainTextByte = AddPKCS7Padding(plainTextByte, blockSize)</span><br><span class="line">cipherText := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="built_in">len</span>(plainTextByte))</span><br><span class="line">mode := cipher.NewCBCEncrypter(block, a.iv)</span><br><span class="line">mode.CryptBlocks(cipherText, plainTextByte)</span><br><span class="line"><span class="keyword">return</span> base64.StdEncoding.EncodeToString(cipherText), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è§£å¯†</span></span><br><span class="line"><span class="comment"> * @param string $cipherText å¯†æ–‡</span></span><br><span class="line"><span class="comment"> * @return bool|string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a Aes)</span></span> Decrypt(cipherText <span class="type">string</span>) (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">block, err := basicAES.NewCipher(a.securityKey)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line">&#125;</span><br><span class="line">cipherDecodeText, decodeErr := base64.StdEncoding.DecodeString(cipherText)</span><br><span class="line"><span class="keyword">if</span> decodeErr != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, decodeErr</span><br><span class="line">&#125;</span><br><span class="line">mode := cipher.NewCBCDecrypter(block, a.iv)</span><br><span class="line">originCipherText := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="built_in">len</span>(cipherDecodeText))</span><br><span class="line">mode.CryptBlocks(originCipherText, cipherDecodeText)</span><br><span class="line">originCipherText = StripPKSC7Padding(originCipherText)</span><br><span class="line"><span class="keyword">return</span> <span class="type">string</span>(originCipherText), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¡«å……ç®—æ³•</span></span><br><span class="line"><span class="comment"> * @param string $source</span></span><br><span class="line"><span class="comment"> * @return string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AddPKCS7Padding</span><span class="params">(ciphertext []<span class="type">byte</span>, blockSize <span class="type">int</span>)</span></span> []<span class="type">byte</span> &#123;</span><br><span class="line">padding := blockSize - <span class="built_in">len</span>(ciphertext)%blockSize</span><br><span class="line">paddingText := bytes.Repeat([]<span class="type">byte</span>&#123;<span class="type">byte</span>(padding)&#125;, padding)</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">append</span>(ciphertext, paddingText...)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç§»å»å¡«å……ç®—æ³•</span></span><br><span class="line"><span class="comment"> * @param string $source</span></span><br><span class="line"><span class="comment"> * @return string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">StripPKSC7Padding</span><span class="params">(cipherText []<span class="type">byte</span>)</span></span> []<span class="type">byte</span> &#123;</span><br><span class="line">length := <span class="built_in">len</span>(cipherText)</span><br><span class="line">unpadding := <span class="type">int</span>(cipherText[length<span class="number">-1</span>])</span><br><span class="line"><span class="keyword">return</span> cipherText[:(length - unpadding)]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> openvpn </tag>
            
            <tag> openvpn-auth </tag>
            
            <tag> wecom </tag>
            
            <tag> ä¼ä¸šå¾®ä¿¡ </tag>
            
            <tag> è®¤è¯ </tag>
            
            <tag> ldap </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
